!function(e,t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=t(require("jquery")):t(e.jQuery)}(this,function(e){"use strict";e.extendext=function(){var t,n,r,i,o,s,a=arguments[0]||{},l=1,u=arguments.length,c=!1,p="default";for("boolean"==typeof a&&(c=a,a=arguments[l++]||{}),"string"==typeof a&&(p=a.toLowerCase(),"concat"!==p&&"replace"!==p&&"extend"!==p&&(p="default"),a=arguments[l++]||{}),"object"==typeof a||e.isFunction(a)||(a={}),l===u&&(a=this,l--);l<u;l++)if(null!==(t=arguments[l]))if(e.isArray(t)&&"default"!==p)switch(s=a&&e.isArray(a)?a:[],p){case"concat":a=s.concat(e.extend(c,[],t));break;case"replace":a=e.extend(c,[],t);break;case"extend":t.forEach(function(t,n){if("object"==typeof t){var r=e.isArray(t)?[]:{};s[n]=e.extendext(c,p,s[n]||r,t)}else-1===s.indexOf(t)&&s.push(t)}),a=s}else for(n in t)r=a[n],i=t[n],a!==i&&(c&&i&&(e.isPlainObject(i)||(o=e.isArray(i)))?(o?(o=!1,s=r&&e.isArray(r)?r:[]):s=r&&e.isPlainObject(r)?r:{},a[n]=e.extendext(c,p,s,i)):void 0!==i&&(a[n]=i));return a}}),function(e,t){"function"==typeof define&&define.amd?define(["jquery","dot/doT","jquery-extendext"],t):"object"==typeof module&&module.exports?module.exports=t(require("jquery"),require("dot/doT"),require("jquery-extendext")):t(e.jQuery,e.doT)}(this,function(e,t){"use strict";function n(){this.root=null,this.$=e(this)}function r(e,t,n){var r,i,s=o.selectors;r=t.closest(s.rule_container),r.length&&(i="moveAfter"),i||(r=t.closest(s.group_header),r.length&&(r=t.closest(s.group_container),i="moveAtBegin")),i||(r=t.closest(s.group_container),r.length&&(i="moveAtEnd")),i&&(e[i](n.getModel(r)),n&&e instanceof u&&n.setRuleInputValue(e,e.value))}function i(e){var t=e.match(/(question_mark|numbered|named)(?:\((.)\))?/);return t||(t=[null,"question_mark",void 0]),t}var o=function(r,i){r[0].queryBuilder=this,this.$el=r,this.settings=e.extendext(!0,"replace",{},o.DEFAULTS,i),this.model=new n,this.status={id:null,generated_id:!1,group_id:0,rule_id:0,has_optgroup:!1,has_operator_optgroup:!1},this.filters=this.settings.filters,this.icons=this.settings.icons,this.operators=this.settings.operators,this.templates=this.settings.templates,this.plugins=this.settings.plugins,this.lang=null,void 0===o.regional.en&&s.error("Config",'"i18n/en.js" not loaded.'),this.lang=e.extendext(!0,"replace",{},o.regional.en,o.regional[this.settings.lang_code],this.settings.lang),!1===this.settings.allow_groups?this.settings.allow_groups=0:!0===this.settings.allow_groups&&(this.settings.allow_groups=-1),Object.keys(this.templates).forEach(function(e){this.templates[e]||(this.templates[e]=o.templates[e]),"string"==typeof this.templates[e]&&(this.templates[e]=t.template(this.templates[e]))},this),this.$el.attr("id")||(this.$el.attr("id","qb_"+Math.floor(99999*Math.random())),this.status.generated_id=!0),this.status.id=this.$el.attr("id"),this.$el.addClass("query-builder form-inline"),this.filters=this.checkFilters(this.filters),this.operators=this.checkOperators(this.operators),this.bindEvents(),this.initPlugins()};e.extend(o.prototype,{trigger:function(t){var n=new e.Event(this._tojQueryEvent(t),{builder:this});return this.$el.triggerHandler(n,Array.prototype.slice.call(arguments,1)),n},change:function(t,n){var r=new e.Event(this._tojQueryEvent(t,!0),{builder:this,value:n});return this.$el.triggerHandler(r,Array.prototype.slice.call(arguments,2)),r.value},on:function(e,t){return this.$el.on(this._tojQueryEvent(e),t),this},off:function(e,t){return this.$el.off(this._tojQueryEvent(e),t),this},once:function(e,t){return this.$el.one(this._tojQueryEvent(e),t),this},_tojQueryEvent:function(e,t){return e.split(" ").map(function(e){return e+".queryBuilder"+(t?".filter":"")}).join(" ")}}),o.types={string:"string",integer:"number",double:"number",date:"datetime",time:"datetime",datetime:"datetime",boolean:"boolean"},o.inputs=["text","number","textarea","radio","checkbox","select"],o.modifiable_options=["display_errors","allow_groups","allow_empty","default_condition","default_filter"],o.selectors={group_container:".rules-group-container",rule_container:".rule-container",filter_container:".rule-filter-container",operator_container:".rule-operator-container",value_container:".rule-value-container",error_container:".error-container",condition_container:".rules-group-header .group-conditions",rule_header:".rule-header",group_header:".rules-group-header",group_actions:".group-actions",rule_actions:".rule-actions",rules_list:".rules-group-body>.rules-list",group_condition:".rules-group-header [name$=_cond]",rule_filter:".rule-filter-container [name$=_filter]",rule_operator:".rule-operator-container [name$=_operator]",rule_value:".rule-value-container [name*=_value_]",add_rule:"[data-add=rule]",delete_rule:"[data-delete=rule]",add_group:"[data-add=group]",delete_group:"[data-delete=group]"},o.templates={},o.regional={},o.OPERATORS={equal:{type:"equal",nb_inputs:1,multiple:!1,apply_to:["string","number","datetime","boolean"]},not_equal:{type:"not_equal",nb_inputs:1,multiple:!1,apply_to:["string","number","datetime","boolean"]},in:{type:"in",nb_inputs:1,multiple:!0,apply_to:["string","number","datetime"]},not_in:{type:"not_in",nb_inputs:1,multiple:!0,apply_to:["string","number","datetime"]},less:{type:"less",nb_inputs:1,multiple:!1,apply_to:["number","datetime"]},less_or_equal:{type:"less_or_equal",nb_inputs:1,multiple:!1,apply_to:["number","datetime"]},greater:{type:"greater",nb_inputs:1,multiple:!1,apply_to:["number","datetime"]},greater_or_equal:{type:"greater_or_equal",nb_inputs:1,multiple:!1,apply_to:["number","datetime"]},between:{type:"between",nb_inputs:2,multiple:!1,apply_to:["number","datetime"]},not_between:{type:"not_between",nb_inputs:2,multiple:!1,apply_to:["number","datetime"]},begins_with:{type:"begins_with",nb_inputs:1,multiple:!1,apply_to:["string"]},not_begins_with:{type:"not_begins_with",nb_inputs:1,multiple:!1,apply_to:["string"]},contains:{type:"contains",nb_inputs:1,multiple:!1,apply_to:["string"]},not_contains:{type:"not_contains",nb_inputs:1,multiple:!1,apply_to:["string"]},ends_with:{type:"ends_with",nb_inputs:1,multiple:!1,apply_to:["string"]},not_ends_with:{type:"not_ends_with",nb_inputs:1,multiple:!1,apply_to:["string"]},is_empty:{type:"is_empty",nb_inputs:0,multiple:!1,apply_to:["string"]},is_not_empty:{type:"is_not_empty",nb_inputs:0,multiple:!1,apply_to:["string"]},is_null:{type:"is_null",nb_inputs:0,multiple:!1,apply_to:["string","number","datetime","boolean"]},is_not_null:{type:"is_not_null",nb_inputs:0,multiple:!1,apply_to:["string","number","datetime","boolean"]}},o.DEFAULTS={filters:[],plugins:[],sort_filters:!1,display_errors:!0,allow_groups:-1,allow_empty:!1,conditions:["AND","OR"],default_condition:"AND",inputs_separator:" , ",select_placeholder:"------",display_empty_filter:!0,default_filter:null,optgroups:{},default_rule_flags:{filter_readonly:!1,operator_readonly:!1,value_readonly:!1,no_delete:!1},default_group_flags:{condition_readonly:!1,no_add_rule:!1,no_add_group:!1,no_delete:!1},templates:{group:null,rule:null,filterSelect:null,operatorSelect:null,ruleValueSelect:null},lang_code:"en",lang:{},operators:["equal","not_equal","in","not_in","less","less_or_equal","greater","greater_or_equal","between","not_between","begins_with","not_begins_with","contains","not_contains","ends_with","not_ends_with","is_empty","is_not_empty","is_null","is_not_null"],icons:{add_group:"glyphicon glyphicon-plus-sign",add_rule:"glyphicon glyphicon-plus",remove_group:"glyphicon glyphicon-remove",remove_rule:"glyphicon glyphicon-remove",error:"glyphicon glyphicon-warning-sign"}},o.plugins={},o.defaults=function(t){if("object"!=typeof t)return"string"==typeof t?"object"==typeof o.DEFAULTS[t]?e.extend(!0,{},o.DEFAULTS[t]):o.DEFAULTS[t]:e.extend(!0,{},o.DEFAULTS);e.extendext(!0,"replace",o.DEFAULTS,t)},o.define=function(e,t,n){o.plugins[e]={fct:t,def:n||{}}},o.extend=function(t){e.extend(o.prototype,t)},o.prototype.initPlugins=function(){if(this.plugins){if(e.isArray(this.plugins)){var t={};this.plugins.forEach(function(e){t[e]=null}),this.plugins=t}Object.keys(this.plugins).forEach(function(t){t in o.plugins?(this.plugins[t]=e.extend(!0,{},o.plugins[t].def,this.plugins[t]||{}),o.plugins[t].fct.call(this,this.plugins[t])):s.error("Config",'Unable to find plugin "{0}"',t)},this)}},o.prototype.getPluginOptions=function(e,t){var n;if(this.plugins&&this.plugins[e]?n=this.plugins[e]:o.plugins[e]&&(n=o.plugins[e].def),n)return t?n[t]:n;s.error("Config",'Unable to find plugin "{0}"',e)},o.prototype.init=function(e){this.trigger("afterInit"),e?(this.setRules(e),delete this.settings.rules):this.setRoot(!0)},o.prototype.checkFilters=function(e){var t=[];if(e&&0!==e.length||s.error("Config","Missing filters list"),e.forEach(function(e,n){switch(e.id||s.error("Config","Missing filter {0} id",n),-1!=t.indexOf(e.id)&&s.error("Config",'Filter "{0}" already defined',e.id),t.push(e.id),e.type?o.types[e.type]||s.error("Config",'Invalid type "{0}"',e.type):e.type="string",e.input?"function"!=typeof e.input&&-1==o.inputs.indexOf(e.input)&&s.error("Config",'Invalid input "{0}"',e.input):e.input="number"===o.types[e.type]?"number":"text",e.operators&&e.operators.forEach(function(e){"string"!=typeof e&&s.error("Config","Filter operators must be global operators types (string)")}),e.field||(e.field=e.id),e.label||(e.label=e.field),e.optgroup?(this.status.has_optgroup=!0,this.settings.optgroups[e.optgroup]||(this.settings.optgroups[e.optgroup]=e.optgroup)):e.optgroup=null,e.input){case"radio":case"checkbox":(!e.values||e.values.length<1)&&s.error("Config",'Missing filter "{0}" values',e.id);break;case"select":var r=[];e.has_optgroup=!1,s.iterateOptions(e.values,function(t,n,i){r.push({value:t,label:n,optgroup:i||null}),i&&(e.has_optgroup=!0,this.settings.optgroups[i]||(this.settings.optgroups[i]=i))}.bind(this)),e.has_optgroup?e.values=s.groupSort(r,"optgroup"):e.values=r,e.placeholder&&(void 0===e.placeholder_value&&(e.placeholder_value=-1),e.values.forEach(function(t){t.value==e.placeholder_value&&s.error("Config",'Placeholder of filter "{0}" overlaps with one of its values',e.id)}))}},this),this.settings.sort_filters)if("function"==typeof this.settings.sort_filters)e.sort(this.settings.sort_filters);else{var n=this;e.sort(function(e,t){return n.translate(e.label).localeCompare(n.translate(t.label))})}return this.status.has_optgroup&&(e=s.groupSort(e,"optgroup")),e},o.prototype.checkOperators=function(t){var n=[];return t.forEach(function(r,i){"string"==typeof r?(o.OPERATORS[r]||s.error("Config",'Unknown operator "{0}"',r),t[i]=r=e.extendext(!0,"replace",{},o.OPERATORS[r])):(r.type||s.error("Config",'Missing "type" for operator {0}',i),o.OPERATORS[r.type]&&(t[i]=r=e.extendext(!0,"replace",{},o.OPERATORS[r.type],r)),void 0!==r.nb_inputs&&void 0!==r.apply_to||s.error("Config",'Missing "nb_inputs" and/or "apply_to" for operator "{0}"',r.type)),-1!=n.indexOf(r.type)&&s.error("Config",'Operator "{0}" already defined',r.type),n.push(r.type),r.optgroup?(this.status.has_operator_optgroup=!0,this.settings.optgroups[r.optgroup]||(this.settings.optgroups[r.optgroup]=r.optgroup)):r.optgroup=null},this),this.status.has_operator_optgroup&&(t=s.groupSort(t,"optgroup")),t},o.prototype.bindEvents=function(){var t=this,n=o.selectors;this.$el.on("change.queryBuilder",n.group_condition,function(){if(e(this).is(":checked")){var r=e(this).closest(n.group_container);t.getModel(r).condition=e(this).val()}}),this.$el.on("change.queryBuilder",n.rule_filter,function(){var r=e(this).closest(n.rule_container);t.getModel(r).filter=t.getFilterById(e(this).val())}),this.$el.on("change.queryBuilder",n.rule_operator,function(){var r=e(this).closest(n.rule_container);t.getModel(r).operator=t.getOperatorByType(e(this).val())}),this.$el.on("click.queryBuilder",n.add_rule,function(){var r=e(this).closest(n.group_container);t.addRule(t.getModel(r))}),this.$el.on("click.queryBuilder",n.delete_rule,function(){var r=e(this).closest(n.rule_container);t.deleteRule(t.getModel(r))}),0!==this.settings.allow_groups&&(this.$el.on("click.queryBuilder",n.add_group,function(){var r=e(this).closest(n.group_container);t.addGroup(t.getModel(r))}),this.$el.on("click.queryBuilder",n.delete_group,function(){var r=e(this).closest(n.group_container);t.deleteGroup(t.getModel(r))})),this.model.on({drop:function(e,n){n.$el.remove(),t.refreshGroupsConditions()},add:function(e,n,r,i){0===i?r.$el.prependTo(n.$el.find(">"+o.selectors.rules_list)):r.$el.insertAfter(n.rules[i-1].$el),t.refreshGroupsConditions()},move:function(e,n,r,i){n.$el.detach(),0===i?n.$el.prependTo(r.$el.find(">"+o.selectors.rules_list)):n.$el.insertAfter(r.rules[i-1].$el),t.refreshGroupsConditions()},update:function(e,n,r,i,o){if(n instanceof u)switch(r){case"error":t.updateError(n);break;case"flags":t.applyRuleFlags(n);break;case"filter":t.updateRuleFilter(n,o);break;case"operator":t.updateRuleOperator(n,o);break;case"value":t.updateRuleValue(n,o)}else switch(r){case"error":t.updateError(n);break;case"flags":t.applyGroupFlags(n);break;case"condition":t.updateGroupCondition(n,o)}}})},o.prototype.setRoot=function(t,n,r){t=void 0===t||!0===t;var i=this.nextGroupId(),o=e(this.getGroupTemplate(i,1));return this.$el.append(o),this.model.root=new l(null,o),this.model.root.model=this.model,this.model.root.data=n,this.model.root.flags=e.extend({},this.settings.default_group_flags,r),this.model.root.condition=this.settings.default_condition,this.trigger("afterAddGroup",this.model.root),t&&this.addRule(this.model.root),this.model.root},o.prototype.addGroup=function(t,n,r,i){n=void 0===n||!0===n;var o=t.level+1;if(this.trigger("beforeAddGroup",t,n,o).isDefaultPrevented())return null;var s=this.nextGroupId(),a=e(this.getGroupTemplate(s,o)),l=t.addGroup(a);return l.data=r,l.flags=e.extend({},this.settings.default_group_flags,i),l.condition=this.settings.default_condition,this.trigger("afterAddGroup",l),this.trigger("rulesChanged"),n&&this.addRule(l),l},o.prototype.deleteGroup=function(e){if(e.isRoot())return!1;if(this.trigger("beforeDeleteGroup",e).isDefaultPrevented())return!1;var t=!0;return e.each("reverse",function(e){t&=this.deleteRule(e)},function(e){t&=this.deleteGroup(e)},this),t&&(e.drop(),this.trigger("afterDeleteGroup"),this.trigger("rulesChanged")),t},o.prototype.updateGroupCondition=function(t,n){t.$el.find(">"+o.selectors.group_condition).each(function(){var n=e(this);n.prop("checked",n.val()===t.condition),n.parent().toggleClass("active",n.val()===t.condition)}),this.trigger("afterUpdateGroupCondition",t,n),this.trigger("rulesChanged")},o.prototype.refreshGroupsConditions=function(){!function e(t){(!t.flags||t.flags&&!t.flags.condition_readonly)&&t.$el.find(">"+o.selectors.group_condition).prop("disabled",t.rules.length<=1).parent().toggleClass("disabled",t.rules.length<=1),t.each(null,function(t){e(t)},this)}(this.model.root)},o.prototype.addRule=function(t,n,r){if(this.trigger("beforeAddRule",t).isDefaultPrevented())return null;var i=this.nextRuleId(),o=e(this.getRuleTemplate(i)),s=t.addRule(o);return s.data=n,s.flags=e.extend({},this.settings.default_rule_flags,r),this.trigger("afterAddRule",s),this.trigger("rulesChanged"),this.createRuleFilters(s),!this.settings.default_filter&&this.settings.display_empty_filter||(s.filter=this.change("getDefaultFilter",this.getFilterById(this.settings.default_filter||this.filters[0].id),s)),s},o.prototype.deleteRule=function(e){return!e.flags.no_delete&&(!this.trigger("beforeDeleteRule",e).isDefaultPrevented()&&(e.drop(),this.trigger("afterDeleteRule"),this.trigger("rulesChanged"),!0))},o.prototype.createRuleFilters=function(t){var n=this.change("getRuleFilters",this.filters,t),r=e(this.getRuleFilterSelect(t,n));t.$el.find(o.selectors.filter_container).html(r),this.trigger("afterCreateRuleFilters",t),this.applyRuleFlags(t)},o.prototype.createRuleOperators=function(t){var n=t.$el.find(o.selectors.operator_container).empty();if(t.filter){var r=this.getOperators(t.filter),i=e(this.getRuleOperatorSelect(t,r));n.html(i),t.filter.default_operator?t.__.operator=this.getOperatorByType(t.filter.default_operator):t.__.operator=r[0],t.$el.find(o.selectors.rule_operator).val(t.operator.type),this.trigger("afterCreateRuleOperators",t,r),this.applyRuleFlags(t)}},o.prototype.createRuleInput=function(t){var n=t.$el.find(o.selectors.value_container).empty();if(t.__.value=void 0,t.filter&&t.operator&&0!==t.operator.nb_inputs){for(var r=this,i=e(),s=t.filter,a=0;a<t.operator.nb_inputs;a++){var l=e(this.getRuleInput(t,a));a>0&&n.append(this.settings.inputs_separator),n.append(l),i=i.add(l)}n.css("display",""),i.on("change "+(s.input_event||""),function(){t._updating_input||(t._updating_value=!0,t.value=r.getRuleInputValue(t),t._updating_value=!1)}),s.plugin&&i[s.plugin](s.plugin_config||{}),this.trigger("afterCreateRuleInput",t),void 0!==s.default_value?t.value=s.default_value:(t._updating_value=!0,t.value=r.getRuleInputValue(t),t._updating_value=!1),this.applyRuleFlags(t)}},o.prototype.updateRuleFilter=function(e,t){this.createRuleOperators(e),this.createRuleInput(e),e.$el.find(o.selectors.rule_filter).val(e.filter?e.filter.id:"-1"),t&&e.filter&&t.id!==e.filter.id&&(e.data=void 0),this.trigger("afterUpdateRuleFilter",e,t),this.trigger("rulesChanged")},o.prototype.updateRuleOperator=function(e,t){var n=e.$el.find(o.selectors.value_container);e.operator&&0!==e.operator.nb_inputs?(n.css("display",""),!n.is(":empty")&&t&&e.operator.nb_inputs===t.nb_inputs&&e.operator.optgroup===t.optgroup||this.createRuleInput(e)):(n.hide(),e.__.value=void 0),e.operator&&(e.$el.find(o.selectors.rule_operator).val(e.operator.type),e.__.value=this.getRuleInputValue(e)),this.trigger("afterUpdateRuleOperator",e,t),this.trigger("rulesChanged")},o.prototype.updateRuleValue=function(e,t){e._updating_value||this.setRuleInputValue(e,e.value),this.trigger("afterUpdateRuleValue",e,t),this.trigger("rulesChanged")},o.prototype.applyRuleFlags=function(e){var t=e.flags,n=o.selectors;e.$el.find(n.rule_filter).prop("disabled",t.filter_readonly),e.$el.find(n.rule_operator).prop("disabled",t.operator_readonly),e.$el.find(n.rule_value).prop("disabled",t.value_readonly),t.no_delete&&e.$el.find(n.delete_rule).remove(),this.trigger("afterApplyRuleFlags",e)},o.prototype.applyGroupFlags=function(e){var t=e.flags,n=o.selectors;e.$el.find(">"+n.group_condition).prop("disabled",t.condition_readonly).parent().toggleClass("readonly",t.condition_readonly),t.no_add_rule&&e.$el.find(n.add_rule).remove(),t.no_add_group&&e.$el.find(n.add_group).remove(),t.no_delete&&e.$el.find(n.delete_group).remove(),this.trigger("afterApplyGroupFlags",e)},o.prototype.clearErrors=function(e){(e=e||this.model.root)&&(e.error=null,e instanceof l&&e.each(function(e){e.error=null},function(e){this.clearErrors(e)},this))},o.prototype.updateError=function(e){if(this.settings.display_errors)if(null===e.error)e.$el.removeClass("has-error");else{var t=this.translate("errors",e.error[0]);t=s.fmt(t,e.error.slice(1)),t=this.change("displayError",t,e.error,e),e.$el.addClass("has-error").find(o.selectors.error_container).eq(0).attr("title",t)}},o.prototype.triggerValidationError=function(t,n,r){e.isArray(n)||(n=[n]),this.trigger("validationError",t,n,r).isDefaultPrevented()||(t.error=n)},o.prototype.destroy=function(){this.trigger("beforeDestroy"),this.status.generated_id&&this.$el.removeAttr("id"),this.clear(),this.model=null,this.$el.off(".queryBuilder").removeClass("query-builder").removeData("queryBuilder"),delete this.$el[0].queryBuilder},o.prototype.reset=function(){this.trigger("beforeReset").isDefaultPrevented()||(this.status.group_id=1,this.status.rule_id=0,this.model.root.empty(),this.model.root.data=void 0,this.model.root.flags=e.extend({},this.settings.default_group_flags),this.model.root.condition=this.settings.default_condition,this.addRule(this.model.root),this.trigger("afterReset"),this.trigger("rulesChanged"))},o.prototype.clear=function(){this.trigger("beforeClear").isDefaultPrevented()||(this.status.group_id=0,this.status.rule_id=0,this.model.root&&(this.model.root.drop(),this.model.root=null),this.trigger("afterClear"),this.trigger("rulesChanged"))},o.prototype.setOptions=function(t){e.each(t,function(e,t){-1!==o.modifiable_options.indexOf(e)&&(this.settings[e]=t)}.bind(this))},o.prototype.getModel=function(t){return t?t instanceof a?t:e(t).data("queryBuilderModel"):this.model.root},o.prototype.validate=function(t){t=e.extend({skip_empty:!1},t),this.clearErrors();var n=this,r=function e(r){var i=0,o=0;return r.each(function(e){if(e.filter||!t.skip_empty){if(!e.filter)return n.triggerValidationError(e,"no_filter",null),void o++;if(!e.operator)return n.triggerValidationError(e,"no_operator",null),void o++;if(0!==e.operator.nb_inputs){var r=n.validateValue(e,e.value);if(!0!==r)return n.triggerValidationError(e,r,e.value),void o++}i++}},function(t){var n=e(t);!0===n?i++:!1===n&&o++}),!(o>0)&&(0===i&&!r.isRoot()&&t.skip_empty?null:!!(0!==i||n.settings.allow_empty&&r.isRoot())||(n.triggerValidationError(r,"empty_group",null),!1))}(this.model.root);return this.change("validate",r)},o.prototype.getRules=function(t){t=e.extend({get_flags:!1,allow_invalid:!1,skip_empty:!1},t);var n=this.validate(t);if(!n&&!t.allow_invalid)return null;var r=this,i=function n(i){var o={condition:i.condition,rules:[]};if(i.data&&(o.data=e.extendext(!0,"replace",{},i.data)),t.get_flags){var s=r.getGroupFlags(i.flags,"all"===t.get_flags);e.isEmptyObject(s)||(o.flags=s)}return i.each(function(n){if(n.filter||!t.skip_empty){var i=null;n.operator&&0===n.operator.nb_inputs||(i=n.value);var s={id:n.filter?n.filter.id:null,field:n.filter?n.filter.field:null,type:n.filter?n.filter.type:null,input:n.filter?n.filter.input:null,operator:n.operator?n.operator.type:null,value:i};if((n.filter&&n.filter.data||n.data)&&(s.data=e.extendext(!0,"replace",{},n.filter.data,n.data)),t.get_flags){var a=r.getRuleFlags(n.flags,"all"===t.get_flags);e.isEmptyObject(a)||(s.flags=a)}o.rules.push(r.change("ruleToJson",s,n))}},function(e){var r=n(e);0===r.rules.length&&t.skip_empty||o.rules.push(r)},this),r.change("groupToJson",o,i)}(this.model.root);return i.valid=n,this.change("getRules",i)},o.prototype.setRules=function(t,n){n=e.extend({allow_invalid:!1},n),e.isArray(t)&&(t={condition:this.settings.default_condition,rules:t}),t&&t.rules&&(0!==t.rules.length||this.settings.allow_empty)||s.error("RulesParse","Incorrect data object passed"),this.clear(),this.setRoot(!1,t.data,this.parseGroupFlags(t)),t=this.change("setRules",t,n);var r=this;!function e(t,i){null!==i&&(void 0===t.condition?t.condition=r.settings.default_condition:-1==r.settings.conditions.indexOf(t.condition)&&(s.error(!n.allow_invalid,"UndefinedCondition",'Invalid condition "{0}"',t.condition),t.condition=r.settings.default_condition),i.condition=t.condition,t.rules.forEach(function(t){var o;if(void 0!==t.rules)if(-1!==r.settings.allow_groups&&r.settings.allow_groups<i.level)s.error(!n.allow_invalid,"RulesParse","No more than {0} groups are allowed",r.settings.allow_groups),r.reset();else{if(null===(o=r.addGroup(i,!1,t.data,r.parseGroupFlags(t))))return;e(t,o)}else{if(t.empty||(void 0===t.id&&(s.error(!n.allow_invalid,"RulesParse","Missing rule field id"),t.empty=!0),void 0===t.operator&&(t.operator="equal")),null===(o=r.addRule(i,t.data,r.parseRuleFlags(t))))return;t.empty||(o.filter=r.getFilterById(t.id,!n.allow_invalid)),o.filter&&(o.operator=r.getOperatorByType(t.operator,!n.allow_invalid),o.operator||(o.operator=r.getOperators(o.filter)[0])),o.operator&&0!==o.operator.nb_inputs&&(void 0!==t.value?o.value=t.value:void 0!==o.filter.default_value&&(o.value=o.filter.default_value)),r.change("jsonToRule",o,t)!=o&&s.error("RulesParse","Plugin tried to change rule reference")}}),r.change("jsonToGroup",i,t)!=i&&s.error("RulesParse","Plugin tried to change group reference"))}(t,this.model.root),this.trigger("afterSetRules")},o.prototype.validateValue=function(e,t){var n=e.filter.validation||{},r=!0;return r=n.callback?n.callback.call(this,t,e):this._validateValue(e,t),this.change("validateValue",r,t,e)},o.prototype._validateValue=function(t,n){var r,i,a=t.filter,l=t.operator,u=a.validation||{},c=!0;1===t.operator.nb_inputs&&(n=[n]);for(var p=0;p<l.nb_inputs;p++){if(!l.multiple&&e.isArray(n[p])&&n[p].length>1){c=["operator_not_multiple",l.type,this.translate("operators",l.type)];break}switch(a.input){case"radio":if(void 0===n[p]||0===n[p].length){u.allow_empty_value||(c=["radio_empty"]);break}break;case"checkbox":if(void 0===n[p]||0===n[p].length){u.allow_empty_value||(c=["checkbox_empty"]);break}break;case"select":if(void 0===n[p]||0===n[p].length||a.placeholder&&n[p]==a.placeholder_value){u.allow_empty_value||(c=["select_empty"]);break}break;default:i=e.isArray(n[p])?n[p]:[n[p]];for(var d=0;d<i.length;d++){switch(o.types[a.type]){case"string":if(void 0===i[d]||0===i[d].length){u.allow_empty_value||(c=["string_empty"]);break}if(void 0!==u.min&&i[d].length<parseInt(u.min)){c=[this.getValidationMessage(u,"min","string_exceed_min_length"),u.min];break}if(void 0!==u.max&&i[d].length>parseInt(u.max)){c=[this.getValidationMessage(u,"max","string_exceed_max_length"),u.max];break}if(u.format&&("string"==typeof u.format&&(u.format=new RegExp(u.format)),!u.format.test(i[d]))){c=[this.getValidationMessage(u,"format","string_invalid_format"),u.format];break}break;case"number":if(void 0===i[d]||0===i[d].length){u.allow_empty_value||(c=["number_nan"]);break}if(isNaN(i[d])){c=["number_nan"];break}if("integer"==a.type){if(parseInt(i[d])!=i[d]){c=["number_not_integer"];break}}else if(parseFloat(i[d])!=i[d]){c=["number_not_double"];break}if(void 0!==u.min&&i[d]<parseFloat(u.min)){c=[this.getValidationMessage(u,"min","number_exceed_min"),u.min];break}if(void 0!==u.max&&i[d]>parseFloat(u.max)){c=[this.getValidationMessage(u,"max","number_exceed_max"),u.max];break}if(void 0!==u.step&&"any"!==u.step){var h=(i[d]/u.step).toPrecision(14);if(parseInt(h)!=h){c=[this.getValidationMessage(u,"step","number_wrong_step"),u.step];break}}break;case"datetime":if(void 0===i[d]||0===i[d].length){u.allow_empty_value||(c=["datetime_empty"]);break}if(u.format){"moment"in window||s.error("MissingLibrary","MomentJS is required for Date/Time validation. Get it here http://momentjs.com");var f=moment(i[d],u.format);if(!f.isValid()){c=[this.getValidationMessage(u,"format","datetime_invalid"),u.format];break}if(u.min&&f<moment(u.min,u.format)){c=[this.getValidationMessage(u,"min","datetime_exceed_min"),u.min];break}if(u.max&&f>moment(u.max,u.format)){c=[this.getValidationMessage(u,"max","datetime_exceed_max"),u.max];break}}break;case"boolean":if(void 0===i[d]||0===i[d].length){u.allow_empty_value||(c=["boolean_not_valid"]);break}if("true"!==(r=(""+i[d]).trim().toLowerCase())&&"false"!==r&&"1"!==r&&"0"!==r&&1!==i[d]&&0!==i[d]){c=["boolean_not_valid"];break}}if(!0!==c)break}}if(!0!==c)break}if(("between"===t.operator.type||"not_between"===t.operator.type)&&2===n.length)switch(o.types[a.type]){case"number":n[0]>n[1]&&(c=["number_between_invalid",n[0],n[1]]);break;case"datetime":u.format&&("moment"in window||s.error("MissingLibrary","MomentJS is required for Date/Time validation. Get it here http://momentjs.com"),moment(n[0],u.format).isAfter(moment(n[1],u.format))&&(c=["datetime_between_invalid",n[0],n[1]]))}return c},o.prototype.nextGroupId=function(){return this.status.id+"_group_"+this.status.group_id++},o.prototype.nextRuleId=function(){return this.status.id+"_rule_"+this.status.rule_id++},o.prototype.getOperators=function(e){"string"==typeof e&&(e=this.getFilterById(e));for(var t=[],n=0,r=this.operators.length;n<r;n++){if(e.operators){if(-1==e.operators.indexOf(this.operators[n].type))continue}else if(-1==this.operators[n].apply_to.indexOf(o.types[e.type]))continue;t.push(this.operators[n])}return e.operators&&t.sort(function(t,n){return e.operators.indexOf(t.type)-e.operators.indexOf(n.type)}),this.change("getOperators",t,e)},o.prototype.getFilterById=function(e,t){if("-1"==e)return null;for(var n=0,r=this.filters.length;n<r;n++)if(this.filters[n].id==e)return this.filters[n];return s.error(!1!==t,"UndefinedFilter",'Undefined filter "{0}"',e),null},o.prototype.getOperatorByType=function(e,t){if("-1"==e)return null;for(var n=0,r=this.operators.length;n<r;n++)if(this.operators[n].type==e)return this.operators[n];return s.error(!1!==t,"UndefinedOperator",'Undefined operator "{0}"',e),null},o.prototype.getRuleInputValue=function(t){var n=t.filter,r=t.operator,i=[];if(n.valueGetter)i=n.valueGetter.call(this,t);else{for(var a=t.$el.find(o.selectors.value_container),l=0;l<r.nb_inputs;l++){var u,c=s.escapeElementId(t.id+"_value_"+l);switch(n.input){case"radio":i.push(a.find("[name="+c+"]:checked").val());break;case"checkbox":u=[],a.find("[name="+c+"]:checked").each(function(){u.push(e(this).val())}),i.push(u);break;case"select":n.multiple?(u=[],a.find("[name="+c+"] option:selected").each(function(){u.push(e(this).val())}),i.push(u)):i.push(a.find("[name="+c+"] option:selected").val());break;default:i.push(a.find("[name="+c+"]").val())}}i=i.map(function(t){return r.multiple&&n.value_separator&&"string"==typeof t&&(t=t.split(n.value_separator)),e.isArray(t)?t.map(function(e){return s.changeType(e,n.type)}):s.changeType(t,n.type)}),1===r.nb_inputs&&(i=i[0]),n.valueParser&&(i=n.valueParser.call(this,t,i))}return this.change("getRuleValue",i,t)},o.prototype.setRuleInputValue=function(t,n){var r=t.filter,i=t.operator;if(r&&i){if(t._updating_input=!0,r.valueSetter)r.valueSetter.call(this,t,n);else{var a=t.$el.find(o.selectors.value_container);1==i.nb_inputs&&(n=[n]);for(var l=0;l<i.nb_inputs;l++){var u=s.escapeElementId(t.id+"_value_"+l);switch(r.input){case"radio":a.find("[name="+u+'][value="'+n[l]+'"]').prop("checked",!0).trigger("change");break;case"checkbox":e.isArray(n[l])||(n[l]=[n[l]]),n[l].forEach(function(e){a.find("[name="+u+'][value="'+e+'"]').prop("checked",!0).trigger("change")});break;default:i.multiple&&r.value_separator&&e.isArray(n[l])&&(n[l]=n[l].join(r.value_separator)),a.find("[name="+u+"]").val(n[l]).trigger("change")}}}t._updating_input=!1}},o.prototype.parseRuleFlags=function(t){var n=e.extend({},this.settings.default_rule_flags);return t.readonly&&e.extend(n,{filter_readonly:!0,operator_readonly:!0,value_readonly:!0,no_delete:!0}),t.flags&&e.extend(n,t.flags),this.change("parseRuleFlags",n,t)},o.prototype.getRuleFlags=function(t,n){if(n)return e.extend({},t);var r={};return e.each(this.settings.default_rule_flags,function(e,n){t[e]!==n&&(r[e]=t[e])}),r},o.prototype.parseGroupFlags=function(t){var n=e.extend({},this.settings.default_group_flags);return t.readonly&&e.extend(n,{condition_readonly:!0,no_add_rule:!0,no_add_group:!0,no_delete:!0}),t.flags&&e.extend(n,t.flags),this.change("parseGroupFlags",n,t)},o.prototype.getGroupFlags=function(t,n){if(n)return e.extend({},t);var r={};return e.each(this.settings.default_group_flags,function(e,n){t[e]!==n&&(r[e]=t[e])}),r},o.prototype.translate=function(e,t){t||(t=e,e=void 0);var n;return n="object"==typeof t?t[this.settings.lang_code]||t.en:(e?this.lang[e]:this.lang)[t]||t,this.change("translate",n,t,e)},o.prototype.getValidationMessage=function(e,t,n){return e.messages&&e.messages[t]||n},
o.templates.group='<div id="{{= it.group_id }}" class="rules-group-container">   <div class="rules-group-header">     <div class="btn-group pull-right group-actions">       <button type="button" class="btn btn-xs btn-success" data-add="rule">         <i class="{{= it.icons.add_rule }}"></i> {{= it.translate("add_rule") }}       </button>       {{? it.settings.allow_groups===-1 || it.settings.allow_groups>=it.level }}         <button type="button" class="btn btn-xs btn-success" data-add="group">           <i class="{{= it.icons.add_group }}"></i> {{= it.translate("add_group") }}         </button>       {{?}}       {{? it.level>1 }}         <button type="button" class="btn btn-xs btn-danger" data-delete="group">           <i class="{{= it.icons.remove_group }}"></i> {{= it.translate("delete_group") }}         </button>       {{?}}     </div>     <div class="btn-group group-conditions">       {{~ it.conditions: condition }}         <label class="btn btn-xs btn-primary">           <input type="radio" name="{{= it.group_id }}_cond" value="{{= condition }}"> {{= it.translate("conditions", condition) }}         </label>       {{~}}     </div>     {{? it.settings.display_errors }}       <div class="error-container"><i class="{{= it.icons.error }}"></i></div>     {{?}}   </div>   <div class=rules-group-body>     <div class=rules-list></div>   </div> </div>',o.templates.rule='<div id="{{= it.rule_id }}" class="rule-container">   <div class="rule-header">     <div class="btn-group pull-right rule-actions">       <button type="button" class="btn btn-xs btn-danger" data-delete="rule">         <i class="{{= it.icons.remove_rule }}"></i> {{= it.translate("delete_rule") }}       </button>     </div>   </div>   {{? it.settings.display_errors }}     <div class="error-container"><i class="{{= it.icons.error }}"></i></div>   {{?}}   <div class="rule-filter-container"></div>   <div class="rule-operator-container"></div>   <div class="rule-value-container"></div> </div>',o.templates.filterSelect='{{ var optgroup = null; }} <select class="form-control" name="{{= it.rule.id }}_filter">   {{? it.settings.display_empty_filter }}     <option value="-1">{{= it.settings.select_placeholder }}</option>   {{?}}   {{~ it.filters: filter }}     {{? optgroup !== filter.optgroup }}       {{? optgroup !== null }}</optgroup>{{?}}       {{? (optgroup = filter.optgroup) !== null }}         <optgroup label="{{= it.translate(it.settings.optgroups[optgroup]) }}">       {{?}}     {{?}}     <option value="{{= filter.id }}" {{? filter.icon}}data-icon="{{= filter.icon}}"{{?}}>{{= it.translate(filter.label) }}</option>   {{~}}   {{? optgroup !== null }}</optgroup>{{?}} </select>',o.templates.operatorSelect='{{? it.operators.length === 1 }} <span> {{= it.translate("operators", it.operators[0].type) }} </span> {{?}} {{ var optgroup = null; }} <select class="form-control {{? it.operators.length === 1 }}hide{{?}}" name="{{= it.rule.id }}_operator">   {{~ it.operators: operator }}     {{? optgroup !== operator.optgroup }}       {{? optgroup !== null }}</optgroup>{{?}}       {{? (optgroup = operator.optgroup) !== null }}         <optgroup label="{{= it.translate(it.settings.optgroups[optgroup]) }}">       {{?}}     {{?}}     <option value="{{= operator.type }}" {{? operator.icon}}data-icon="{{= operator.icon}}"{{?}}>{{= it.translate("operators", operator.type) }}</option>   {{~}}   {{? optgroup !== null }}</optgroup>{{?}} </select>',o.templates.ruleValueSelect='{{ var optgroup = null; }} <select class="form-control" name="{{= it.name }}" {{? it.rule.filter.multiple }}multiple{{?}}>   {{? it.rule.filter.placeholder }}     <option value="{{= it.rule.filter.placeholder_value }}" disabled selected>{{= it.rule.filter.placeholder }}</option>   {{?}}   {{~ it.rule.filter.values: entry }}     {{? optgroup !== entry.optgroup }}       {{? optgroup !== null }}</optgroup>{{?}}       {{? (optgroup = entry.optgroup) !== null }}         <optgroup label="{{= it.translate(it.settings.optgroups[optgroup]) }}">       {{?}}     {{?}}     <option value="{{= entry.value }}">{{= entry.label }}</option>   {{~}}   {{? optgroup !== null }}</optgroup>{{?}} </select>',o.prototype.getGroupTemplate=function(e,t){var n=this.templates.group({builder:this,group_id:e,level:t,conditions:this.settings.conditions,icons:this.icons,settings:this.settings,translate:this.translate.bind(this)});return this.change("getGroupTemplate",n,t)},o.prototype.getRuleTemplate=function(e){var t=this.templates.rule({builder:this,rule_id:e,icons:this.icons,settings:this.settings,translate:this.translate.bind(this)});return this.change("getRuleTemplate",t)},o.prototype.getRuleFilterSelect=function(e,t){var n=this.templates.filterSelect({builder:this,rule:e,filters:t,icons:this.icons,settings:this.settings,translate:this.translate.bind(this)});return this.change("getRuleFilterSelect",n,e,t)},o.prototype.getRuleOperatorSelect=function(e,t){var n=this.templates.operatorSelect({builder:this,rule:e,operators:t,icons:this.icons,settings:this.settings,translate:this.translate.bind(this)});return this.change("getRuleOperatorSelect",n,e,t)},o.prototype.getRuleValueSelect=function(e,t){var n=this.templates.ruleValueSelect({builder:this,name:e,rule:t,icons:this.icons,settings:this.settings,translate:this.translate.bind(this)});return this.change("getRuleValueSelect",n,e,t)},o.prototype.getRuleInput=function(e,t){var n=e.filter,r=e.filter.validation||{},i=e.id+"_value_"+t,o=n.vertical?" class=block":"",a="";if("function"==typeof n.input)a=n.input.call(this,e,i);else switch(n.input){case"radio":case"checkbox":s.iterateOptions(n.values,function(e,t){a+="<label"+o+'><input type="'+n.input+'" name="'+i+'" value="'+e+'"> '+t+"</label> "});break;case"select":a=this.getRuleValueSelect(i,e);break;case"textarea":a+='<textarea class="form-control" name="'+i+'"',n.size&&(a+=' cols="'+n.size+'"'),n.rows&&(a+=' rows="'+n.rows+'"'),void 0!==r.min&&(a+=' minlength="'+r.min+'"'),void 0!==r.max&&(a+=' maxlength="'+r.max+'"'),n.placeholder&&(a+=' placeholder="'+n.placeholder+'"'),a+="></textarea>";break;case"number":a+='<input class="form-control" type="number" name="'+i+'"',void 0!==r.step&&(a+=' step="'+r.step+'"'),void 0!==r.min&&(a+=' min="'+r.min+'"'),void 0!==r.max&&(a+=' max="'+r.max+'"'),n.placeholder&&(a+=' placeholder="'+n.placeholder+'"'),n.size&&(a+=' size="'+n.size+'"'),a+=">";break;default:a+='<input class="form-control" type="text" name="'+i+'"',n.placeholder&&(a+=' placeholder="'+n.placeholder+'"'),"string"===n.type&&void 0!==r.min&&(a+=' minlength="'+r.min+'"'),"string"===n.type&&void 0!==r.max&&(a+=' maxlength="'+r.max+'"'),n.size&&(a+=' size="'+n.size+'"'),a+=">"}return this.change("getRuleInput",a,e,i)};var s={};o.utils=s,s.iterateOptions=function(t,n){t&&(e.isArray(t)?t.forEach(function(t){e.isPlainObject(t)?"value"in t?n(t.value,t.label||t.value,t.optgroup):e.each(t,function(e,t){return n(e,t),!1}):n(t,t)}):e.each(t,function(e,t){n(e,t)}))},s.fmt=function(e,t){return Array.isArray(t)||(t=Array.prototype.slice.call(arguments,1)),e.replace(/{([0-9]+)}/g,function(e,n){return t[parseInt(n)]})},s.error=function(){var e=0,t="boolean"!=typeof arguments[e]||arguments[e++],n=arguments[e++],r=arguments[e++],i=Array.isArray(arguments[e])?arguments[e]:Array.prototype.slice.call(arguments,e);if(t){var o=new Error(s.fmt(r,i));throw o.name=n+"Error",o.args=i,o}console.error(n+"Error: "+s.fmt(r,i))},s.changeType=function(e,t){if(""!==e&&void 0!==e)switch(t){case"integer":return"string"!=typeof e||/^-?\d+$/.test(e)?parseInt(e):e;case"double":return"string"!=typeof e||/^-?\d+\.?\d*$/.test(e)?parseFloat(e):e;case"boolean":return"string"!=typeof e||/^(0|1|true|false){1}$/i.test(e)?!0===e||1===e||"true"===e.toLowerCase()||"1"===e:e;default:return e}},s.escapeString=function(e){return"string"!=typeof e?e:e.replace(/[\0\n\r\b\\\'\"]/g,function(e){switch(e){case"\0":return"\\0";case"\n":return"\\n";case"\r":return"\\r";case"\b":return"\\b";default:return"\\"+e}}).replace(/\t/g,"\\t").replace(/\x1a/g,"\\Z")},s.escapeRegExp=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},s.escapeElementId=function(e){return e?e.replace(/(\\)?([:.\[\],])/g,function(e,t,n){return t?e:"\\"+n}):e},s.groupSort=function(e,t){var n=[],r=[];return e.forEach(function(e){var i;e[t]?(i=n.lastIndexOf(e[t]),-1==i?i=n.length:i++):i=n.length,n.splice(i,0,e[t]),r.splice(i,0,e)}),r},s.defineModelProperties=function(t,n){n.forEach(function(n){Object.defineProperty(t.prototype,n,{enumerable:!0,get:function(){return this.__[n]},set:function(t){var r=null!==this.__[n]&&"object"==typeof this.__[n]?e.extend({},this.__[n]):this.__[n];this.__[n]=t,null!==this.model&&this.model.trigger("update",this,n,t,r)}})})},e.extend(n.prototype,{trigger:function(t){var n=new e.Event(t);return this.$.triggerHandler(n,Array.prototype.slice.call(arguments,1)),n},on:function(){return this.$.on.apply(this.$,Array.prototype.slice.call(arguments)),this},off:function(){return this.$.off.apply(this.$,Array.prototype.slice.call(arguments)),this},once:function(){return this.$.one.apply(this.$,Array.prototype.slice.call(arguments)),this}});var a=function(e,t){if(!(this instanceof a))return new a(e,t);Object.defineProperty(this,"__",{value:{}}),t.data("queryBuilderModel",this),this.__.level=1,this.__.error=null,this.__.flags={},this.__.data=void 0,this.$el=t,this.id=t[0].id,this.model=null,this.parent=e};s.defineModelProperties(a,["level","error","data","flags"]),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){return this.__.parent},set:function(e){this.__.parent=e,this.level=null===e?1:e.level+1,this.model=null===e?null:e.model}}),a.prototype.isRoot=function(){return 1===this.level},a.prototype.getPos=function(){return this.isRoot()?-1:this.parent.getNodePos(this)},a.prototype.drop=function(){var e=this.model;this.parent&&this.parent.removeNode(this),this.$el.removeData("queryBuilderModel"),null!==e&&e.trigger("drop",this)},a.prototype.moveAfter=function(e){this.isRoot()||this.move(e.parent,e.getPos()+1)},a.prototype.moveAtBegin=function(e){this.isRoot()||(void 0===e&&(e=this.parent),this.move(e,0))},a.prototype.moveAtEnd=function(e){this.isRoot()||(void 0===e&&(e=this.parent),this.move(e,0===e.length()?0:e.length()-1))},a.prototype.move=function(e,t){this.isRoot()||("number"==typeof e&&(t=e,e=this.parent),this.parent.removeNode(this),e.insertNode(this,t,!1),null!==this.model&&this.model.trigger("move",this,e,t))};var l=function(e,t){if(!(this instanceof l))return new l(e,t);a.call(this,e,t),this.rules=[],this.__.condition=null};l.prototype=Object.create(a.prototype),l.prototype.constructor=l,s.defineModelProperties(l,["condition"]),l.prototype.empty=function(){this.each("reverse",function(e){e.drop()},function(e){e.drop()})},l.prototype.drop=function(){this.empty(),a.prototype.drop.call(this)},l.prototype.length=function(){return this.rules.length},l.prototype.insertNode=function(e,t,n){return void 0===t&&(t=this.length()),this.rules.splice(t,0,e),e.parent=this,n&&null!==this.model&&this.model.trigger("add",this,e,t),e},l.prototype.addGroup=function(e,t){return this.insertNode(new l(this,e),t,!0)},l.prototype.addRule=function(e,t){return this.insertNode(new u(this,e),t,!0)},l.prototype.removeNode=function(e){var t=this.getNodePos(e);-1!==t&&(e.parent=null,this.rules.splice(t,1))},l.prototype.getNodePos=function(e){return this.rules.indexOf(e)},l.prototype.each=function(e,t,n,r){"boolean"!=typeof e&&"string"!=typeof e&&(r=n,n=t,t=e,e=!1),r=void 0===r?null:r;for(var i=e?this.rules.length-1:0,o=e?0:this.rules.length-1,s=e?-1:1,a=!1;function(){return e?i>=o:i<=o}()&&(this.rules[i]instanceof l?n&&(a=!1===n.call(r,this.rules[i])):t&&(a=!1===t.call(r,this.rules[i])),!a);i+=s);return!a},l.prototype.contains=function(e,t){return-1!==this.getNodePos(e)||!!t&&!this.each(function(){return!0},function(t){return!t.contains(e,!0)})};var u=function(e,t){if(!(this instanceof u))return new u(e,t);a.call(this,e,t),this._updating_value=!1,this._updating_input=!1,this.__.filter=null,this.__.operator=null,this.__.value=void 0};return u.prototype=Object.create(a.prototype),u.prototype.constructor=u,s.defineModelProperties(u,["filter","operator","value"]),u.prototype.isRoot=function(){return!1},o.Group=l,o.Rule=u,e.fn.queryBuilder=function(e){0===this.length&&s.error("Config","No target defined"),this.length>1&&s.error("Config","Unable to initialize on multiple target");var t=this.data("queryBuilder"),n="object"==typeof e&&e||{};if(!t&&"destroy"==e)return this;if(!t){var r=new o(this,n);this.data("queryBuilder",r),r.init(n.rules)}return"string"==typeof e?t[e].apply(t,Array.prototype.slice.call(arguments,1)):this},e.fn.queryBuilder.constructor=o,e.fn.queryBuilder.defaults=o.defaults,e.fn.queryBuilder.extend=o.extend,e.fn.queryBuilder.define=o.define,e.fn.queryBuilder.regional=o.regional,o.define("bt-checkbox",function(e){"glyphicons"==e.font&&this.$el.addClass("bt-checkbox-glyphicons"),this.on("getRuleInput.filter",function(t,n,r){var i=n.filter;if(("radio"===i.input||"checkbox"===i.input)&&!i.plugin){t.value="",i.colors||(i.colors={}),i.color&&(i.colors._def_=i.color);var o=i.vertical?' style="display:block"':"",a=0;s.iterateOptions(i.values,function(n,s){var l=i.colors[n]||i.colors._def_||e.color,u=r+"_"+a++;t.value+="<div"+o+' class="'+i.input+" "+i.input+"-"+l+'">   <input type="'+i.input+'" name="'+r+'" id="'+u+'" value="'+n+'">   <label for="'+u+'">'+s+"</label> </div>"})}})},{font:"glyphicons",color:"default"}),o.define("bt-selectpicker",function(t){e.fn.selectpicker&&e.fn.selectpicker.Constructor||s.error("MissingLibrary",'Bootstrap Select is required to use "bt-selectpicker" plugin. Get it here: http://silviomoreto.github.io/bootstrap-select');var n=o.selectors;this.on("afterCreateRuleFilters",function(e,r){r.$el.find(n.rule_filter).removeClass("form-control").selectpicker(t)}),this.on("afterCreateRuleOperators",function(e,r){r.$el.find(n.rule_operator).removeClass("form-control").selectpicker(t)}),this.on("afterUpdateRuleFilter",function(e,t){t.$el.find(n.rule_filter).selectpicker("render")}),this.on("afterUpdateRuleOperator",function(e,t){t.$el.find(n.rule_operator).selectpicker("render")}),this.on("beforeDeleteRule",function(e,t){t.$el.find(n.rule_filter).selectpicker("destroy"),t.$el.find(n.rule_operator).selectpicker("destroy")})},{container:"body",style:"btn-inverse btn-xs",width:"auto",showIcon:!1}),o.define("bt-tooltip-errors",function(t){e.fn.tooltip&&e.fn.tooltip.Constructor&&e.fn.tooltip.Constructor.prototype.fixTitle||s.error("MissingLibrary",'Bootstrap Tooltip is required to use "bt-tooltip-errors" plugin. Get it here: http://getbootstrap.com');var n=this;this.on("getRuleTemplate.filter getGroupTemplate.filter",function(t){var n=e(t.value);n.find(o.selectors.error_container).attr("data-toggle","tooltip"),t.value=n.prop("outerHTML")}),this.model.on("update",function(e,r,i){"error"==i&&n.settings.display_errors&&r.$el.find(o.selectors.error_container).eq(0).tooltip(t).tooltip("hide").tooltip("fixTitle")})},{placement:"right"}),o.extend({setFilters:function(e,t){var n=this;void 0===t&&(t=e,e=!1),t=this.checkFilters(t),t=this.change("setFilters",t);var r=t.map(function(e){return e.id});if(e||function e(t){t.each(function(e){e.filter&&-1===r.indexOf(e.filter.id)&&s.error("ChangeFilter",'A rule is using filter "{0}"',e.filter.id)},e)}(this.model.root),this.filters=t,function e(t){t.each(!0,function(e){e.filter&&-1===r.indexOf(e.filter.id)?(e.drop(),n.trigger("rulesChanged")):(n.createRuleFilters(e),e.$el.find(o.selectors.rule_filter).val(e.filter?e.filter.id:"-1"),n.trigger("afterUpdateRuleFilter",e))},e)}(this.model.root),this.settings.plugins&&(this.settings.plugins["unique-filter"]&&this.updateDisabledFilters(),this.settings.plugins["bt-selectpicker"]&&this.$el.find(o.selectors.rule_filter).selectpicker("render")),this.settings.default_filter)try{this.getFilterById(this.settings.default_filter)}catch(e){this.settings.default_filter=null}this.trigger("afterSetFilters",t)},addFilter:function(t,n){void 0===n||"#end"==n?n=this.filters.length:"#start"==n&&(n=0),e.isArray(t)||(t=[t]);var r=e.extend(!0,[],this.filters);parseInt(n)==n?Array.prototype.splice.apply(r,[n,0].concat(t)):this.filters.some(function(e,t){if(e.id==n)return n=t+1,!0})?Array.prototype.splice.apply(r,[n,0].concat(t)):Array.prototype.push.apply(r,t),this.setFilters(r)},removeFilter:function(t,n){var r=e.extend(!0,[],this.filters);"string"==typeof t&&(t=[t]),r=r.filter(function(e){return-1===t.indexOf(e.id)}),this.setFilters(n,r)}}),o.define("chosen-selectpicker",function(t){e.fn.chosen||s.error("MissingLibrary",'chosen is required to use "chosen-selectpicker" plugin. Get it here: https://github.com/harvesthq/chosen'),this.settings.plugins["bt-selectpicker"]&&s.error("Conflict","bt-selectpicker is already selected as the dropdown plugin. Please remove chosen-selectpicker from the plugin list");var n=o.selectors;this.on("afterCreateRuleFilters",function(e,r){r.$el.find(n.rule_filter).removeClass("form-control").chosen(t)}),this.on("afterCreateRuleOperators",function(e,r){r.$el.find(n.rule_operator).removeClass("form-control").chosen(t)}),this.on("afterUpdateRuleFilter",function(e,t){t.$el.find(n.rule_filter).trigger("chosen:updated")}),this.on("afterUpdateRuleOperator",function(e,t){t.$el.find(n.rule_operator).trigger("chosen:updated")}),this.on("beforeDeleteRule",function(e,t){t.$el.find(n.rule_filter).chosen("destroy"),t.$el.find(n.rule_operator).chosen("destroy")})}),o.define("filter-description",function(t){"inline"===t.mode?this.on("afterUpdateRuleFilter afterUpdateRuleOperator",function(n,r){var i=r.$el.find("p.filter-description"),o=n.builder.getFilterDescription(r.filter,r);o?(0===i.length?(i=e('<p class="filter-description"></p>'),i.appendTo(r.$el)):i.css("display",""),i.html('<i class="'+t.icon+'"></i> '+o)):i.hide()}):"popover"===t.mode?(e.fn.popover&&e.fn.popover.Constructor&&e.fn.popover.Constructor.prototype.fixTitle||s.error("MissingLibrary",'Bootstrap Popover is required to use "filter-description" plugin. Get it here: http://getbootstrap.com'),this.on("afterUpdateRuleFilter afterUpdateRuleOperator",function(n,r){var i=r.$el.find("button.filter-description"),s=n.builder.getFilterDescription(r.filter,r);s?(0===i.length?(i=e('<button type="button" class="btn btn-xs btn-info filter-description" data-toggle="popover"><i class="'+t.icon+'"></i></button>'),i.prependTo(r.$el.find(o.selectors.rule_actions)),i.popover({placement:"left",container:"body",html:!0}),i.on("mouseout",function(){i.popover("hide")})):i.css("display",""),i.data("bs.popover").options.content=s,i.attr("aria-describedby")&&i.popover("show")):(i.hide(),i.data("bs.popover")&&i.popover("hide"))})):"bootbox"===t.mode&&("bootbox"in window||s.error("MissingLibrary",'Bootbox is required to use "filter-description" plugin. Get it here: http://bootboxjs.com'),this.on("afterUpdateRuleFilter afterUpdateRuleOperator",function(n,r){var i=r.$el.find("button.filter-description"),s=n.builder.getFilterDescription(r.filter,r);s?(0===i.length?(i=e('<button type="button" class="btn btn-xs btn-info filter-description" data-toggle="bootbox"><i class="'+t.icon+'"></i></button>'),i.prependTo(r.$el.find(o.selectors.rule_actions)),i.on("click",function(){bootbox.alert(i.data("description"))})):i.css("display",""),i.data("description",s)):i.hide()}))},{icon:"glyphicon glyphicon-info-sign",mode:"popover"}),o.extend({getFilterDescription:function(e,t){return e?"function"==typeof e.description?e.description.call(this,t):e.description:void 0}}),o.define("invert",function(t){var n=this,r=o.selectors;this.on("afterInit",function(){n.$el.on("click.queryBuilder","[data-invert=group]",function(){var i=e(this).closest(r.group_container);n.invert(n.getModel(i),t)}),t.display_rules_button&&t.invert_rules&&n.$el.on("click.queryBuilder","[data-invert=rule]",function(){var i=e(this).closest(r.rule_container);n.invert(n.getModel(i),t)})}),t.disable_template||(this.on("getGroupTemplate.filter",function(i){var o=e(i.value);o.find(r.condition_container).after('<button type="button" class="btn btn-xs btn-default" data-invert="group"><i class="'+t.icon+'"></i> '+n.translate("invert")+"</button>"),i.value=o.prop("outerHTML")}),t.display_rules_button&&t.invert_rules&&this.on("getRuleTemplate.filter",function(i){var o=e(i.value);o.find(r.rule_actions).prepend('<button type="button" class="btn btn-xs btn-default" data-invert="rule"><i class="'+t.icon+'"></i> '+n.translate("invert")+"</button>"),i.value=o.prop("outerHTML")}))},{icon:"glyphicon glyphicon-random",recursive:!0,invert_rules:!0,display_rules_button:!1,silent_fail:!1,disable_template:!1}),o.defaults({operatorOpposites:{equal:"not_equal",not_equal:"equal",in:"not_in",not_in:"in",less:"greater_or_equal",less_or_equal:"greater",greater:"less_or_equal",greater_or_equal:"less",between:"not_between",not_between:"between",begins_with:"not_begins_with",not_begins_with:"begins_with",contains:"not_contains",not_contains:"contains",ends_with:"not_ends_with",not_ends_with:"ends_with",is_empty:"is_not_empty",is_not_empty:"is_empty",is_null:"is_not_null",is_not_null:"is_null"},conditionOpposites:{AND:"OR",OR:"AND"}}),o.extend({invert:function(t,n){if(!(t instanceof a)){if(!this.model.root)return;n=t,t=this.model.root}if("object"!=typeof n&&(n={}),void 0===n.recursive&&(n.recursive=!0),void 0===n.invert_rules&&(n.invert_rules=!0),void 0===n.silent_fail&&(n.silent_fail=!1),void 0===n.trigger&&(n.trigger=!0),t instanceof l){if(this.settings.conditionOpposites[t.condition]?t.condition=this.settings.conditionOpposites[t.condition]:n.silent_fail||s.error("InvertCondition",'Unknown inverse of condition "{0}"',t.condition),n.recursive){var r=e.extend({},n,{trigger:!1});t.each(function(e){n.invert_rules&&this.invert(e,r)},function(e){this.invert(e,r)},this)}}else if(t instanceof u&&t.operator&&!t.filter.no_invert)if(this.settings.operatorOpposites[t.operator.type]){var i=this.settings.operatorOpposites[t.operator.type];t.filter.operators&&-1==t.filter.operators.indexOf(i)||(t.operator=this.getOperatorByType(i))}else n.silent_fail||s.error("InvertOperator",'Unknown inverse of operator "{0}"',t.operator.type);n.trigger&&(this.trigger("afterInvert",t,n),this.trigger("rulesChanged"))}}),o.defaults({mongoOperators:{equal:function(e){return e[0]},not_equal:function(e){return{$ne:e[0]}},in:function(e){return{$in:e}},not_in:function(e){return{$nin:e}},less:function(e){return{$lt:e[0]}},less_or_equal:function(e){return{$lte:e[0]}},greater:function(e){return{$gt:e[0]}},greater_or_equal:function(e){return{$gte:e[0]}},between:function(e){return{$gte:e[0],$lte:e[1]}},not_between:function(e){return{$lt:e[0],$gt:e[1]}},begins_with:function(e){return{$regex:"^"+s.escapeRegExp(e[0])}},not_begins_with:function(e){return{$regex:"^(?!"+s.escapeRegExp(e[0])+")"}},contains:function(e){return{$regex:s.escapeRegExp(e[0])}},not_contains:function(e){return{$regex:"^((?!"+s.escapeRegExp(e[0])+").)*$",$options:"s"}},ends_with:function(e){return{$regex:s.escapeRegExp(e[0])+"$"}},not_ends_with:function(e){return{$regex:"(?<!"+s.escapeRegExp(e[0])+")$"}},is_empty:function(e){return""},is_not_empty:function(e){return{$ne:""}},is_null:function(e){return null},is_not_null:function(e){return{$ne:null}}},mongoRuleOperators:{$eq:function(e){return{val:e,op:null===e?"is_null":""===e?"is_empty":"equal"}},$ne:function(e){return e=e.$ne,{val:e,op:null===e?"is_not_null":""===e?"is_not_empty":"not_equal"}},$regex:function(e){return e=e.$regex,"^(?!"==e.slice(0,4)&&")"==e.slice(-1)?{val:e.slice(4,-1),op:"not_begins_with"}:"^((?!"==e.slice(0,5)&&").)*$"==e.slice(-5)?{val:e.slice(5,-5),op:"not_contains"}:"(?<!"==e.slice(0,4)&&")$"==e.slice(-2)?{val:e.slice(4,-2),op:"not_ends_with"}:"$"==e.slice(-1)?{val:e.slice(0,-1),op:"ends_with"}:"^"==e.slice(0,1)?{val:e.slice(1),op:"begins_with"}:{val:e,op:"contains"}},between:function(e){return{val:[e.$gte,e.$lte],op:"between"}},not_between:function(e){return{val:[e.$lt,e.$gt],op:"not_between"}},$in:function(e){return{val:e.$in,op:"in"}},$nin:function(e){return{val:e.$nin,op:"not_in"}},$lt:function(e){return{val:e.$lt,op:"less"}},$lte:function(e){return{val:e.$lte,op:"less_or_equal"}},$gt:function(e){return{val:e.$gt,op:"greater"}},$gte:function(e){return{val:e.$gte,op:"greater_or_equal"}}}}),o.extend({getMongo:function(e){if(!(e=void 0===e?this.getRules():e))return null;var t=this;return function e(n){if(n.condition||(n.condition=t.settings.default_condition),-1===["AND","OR"].indexOf(n.condition.toUpperCase())&&s.error("UndefinedMongoCondition",'Unable to build MongoDB query with condition "{0}"',n.condition),!n.rules)return{};var r=[];n.rules.forEach(function(n){if(n.rules&&n.rules.length>0)r.push(e(n));else{var i=t.settings.mongoOperators[n.operator],o=t.getOperatorByType(n.operator);void 0===i&&s.error("UndefinedMongoOperator",'Unknown MongoDB operation for operator "{0}"',n.operator),0!==o.nb_inputs&&(n.value instanceof Array||(n.value=[n.value]));var a=t.change("getMongoDBField",n.field,n),l={};l[a]=i.call(t,n.value),r.push(t.change("ruleToMongo",l,n,n.value,i))}});var i={};return i["$"+n.condition.toLowerCase()]=r,t.change("groupToMongo",i,n)}(e)},getRulesFromMongo:function(e){if(void 0===e||null===e)return null;var t=this;if("rules"in(e=t.change("parseMongoNode",e))&&"condition"in e)return e;if("id"in e&&"operator"in e&&"value"in e)return{condition:this.settings.default_condition,rules:[e]};var n=t.getMongoCondition(e);return n||s.error("MongoParse","Invalid MongoDB query format"),function e(n,r){var i=n[r],o=[];return i.forEach(function(n){if("rules"in(n=t.change("parseMongoNode",n))&&"condition"in n)return void o.push(n);if("id"in n&&"operator"in n&&"value"in n)return void o.push(n);var r=t.getMongoCondition(n);if(r)o.push(e(n,r));else{var i=Object.keys(n)[0],a=n[i],l=t.getMongoOperator(a);void 0===l&&s.error("MongoParse","Invalid MongoDB query format");var u=t.settings.mongoRuleOperators[l];void 0===u&&s.error("UndefinedMongoOperator",'JSON Rule operation unknown for operator "{0}"',l);var c=u.call(t,a),p=t.getMongoDBFieldID(i,a),d=t.change("mongoToRule",{id:p,field:i,operator:c.op,value:c.val},n);o.push(d)}}),t.change("mongoToGroup",{condition:r.replace("$","").toUpperCase(),rules:o},n)}(e,n)},setRulesFromMongo:function(e){this.setRules(this.getRulesFromMongo(e))},getMongoDBFieldID:function(e,t){var n=this.filters.filter(function(t){return t.field===e});return 1===n.length?n[0].id:this.change("getMongoDBFieldID",e,t)},getMongoOperator:function(e){if(null===e||"object"!=typeof e)return"$eq";if(void 0!==e.$gte&&void 0!==e.$lte)return"between";if(void 0!==e.$lt&&void 0!==e.$gt)return"not_between";var t=Object.keys(e).filter(function(e){return!!this.settings.mongoRuleOperators[e]}.bind(this));return 1===t.length?t[0]:void 0},getMongoCondition:function(e){for(var t=Object.keys(e),n=0,r=t.length;n<r;n++)if("$or"===t[n].toLowerCase()||"$and"===t[n].toLowerCase())return t[n]}}),o.define("not-group",function(t){var n=this;this.on("afterInit",function(){n.$el.on("click.queryBuilder","[data-not=group]",function(){var t=e(this).closest(o.selectors.group_container),r=n.getModel(t);r.not=!r.not}),n.model.on("update",function(e,t,r){t instanceof l&&"not"===r&&n.updateGroupNot(t)})}),this.on("afterAddGroup",function(e,t){t.__.not=!1}),t.disable_template||this.on("getGroupTemplate.filter",function(r){var i=e(r.value);i.find(o.selectors.condition_container).prepend('<button type="button" class="btn btn-xs btn-default" data-not="group"><i class="'+t.icon_unchecked+'"></i> '+n.translate("NOT")+"</button>"),r.value=i.prop("outerHTML")}),this.on("groupToJson.filter",function(e,t){e.value.not=t.not}),this.on("jsonToGroup.filter",function(e,t){e.value.not=!!t.not}),this.on("groupToSQL.filter",function(e,t){t.not&&(e.value="NOT ( "+e.value+" )")}),this.on("parseSQLNode.filter",function(e){e.value.name&&"NOT"==e.value.name.toUpperCase()&&(e.value=e.value.arguments.value[0],-1===["AND","OR"].indexOf(e.value.operation.toUpperCase())&&(e.value=new SQLParser.nodes.Op(n.settings.default_condition,e.value,null)),e.value.not=!0)}),this.on("sqlGroupsDistinct.filter",function(e,t,n,r){n.not&&r>0&&(e.value=!0)}),this.on("sqlToGroup.filter",function(e,t){e.value.not=!!t.not}),this.on("groupToMongo.filter",function(e,t){var n="$"+t.condition.toLowerCase();t.not&&e.value[n]&&(e.value={$nor:[e.value]})}),this.on("parseMongoNode.filter",function(e){var t=Object.keys(e.value);"$nor"==t[0]&&(e.value=e.value[t[0]][0],e.value.not=!0)}),this.on("mongoToGroup.filter",function(e,t){e.value.not=!!t.not})},{icon_unchecked:"glyphicon glyphicon-unchecked",icon_checked:"glyphicon glyphicon-check",disable_template:!1}),s.defineModelProperties(l,["not"]),o.selectors.group_not=o.selectors.group_header+" [data-not=group]",o.extend({updateGroupNot:function(e){var t=this.plugins["not-group"];e.$el.find(">"+o.selectors.group_not).toggleClass("active",e.not).find("i").attr("class",e.not?t.icon_checked:t.icon_unchecked),this.trigger("afterUpdateGroupNot",e),this.trigger("rulesChanged")}}),o.define("sortable",function(t){"interact"in window||s.error("MissingLibrary",'interact.js is required to use "sortable" plugin. Get it here: http://interactjs.io'),void 0!==t.default_no_sortable&&(s.error(!1,"Config",'Sortable plugin : "default_no_sortable" options is deprecated, use standard "default_rule_flags" and "default_group_flags" instead'),this.settings.default_rule_flags.no_sortable=this.settings.default_group_flags.no_sortable=t.default_no_sortable),interact.dynamicDrop(!0),interact.pointerMoveTolerance(10);var n,i,a,u;this.on("afterAddRule afterAddGroup",function(s,c){if(c!=n){var p=s.builder;t.inherit_no_sortable&&c.parent&&c.parent.flags.no_sortable&&(c.flags.no_sortable=!0),t.inherit_no_drop&&c.parent&&c.parent.flags.no_drop&&(c.flags.no_drop=!0),c.flags.no_sortable||interact(c.$el[0]).draggable({allowFrom:o.selectors.drag_handle,onstart:function(t){u=!1,a=p.getModel(t.target),i=a.$el.clone().appendTo(a.$el.parent()).width(a.$el.outerWidth()).addClass("dragging");var r=e('<div class="rule-placeholder">&nbsp;</div>').height(a.$el.outerHeight());n=a.parent.addRule(r,a.getPos()),a.$el.hide()},onmove:function(e){i[0].style.top=e.clientY-15+"px",i[0].style.left=e.clientX-15+"px"},onend:function(t){t.dropzone&&(r(a,e(t.relatedTarget),p),u=!0),i.remove(),i=void 0,n.drop(),n=void 0,a.$el.css("display",""),p.trigger("afterMove",a),p.trigger("rulesChanged")}}),c.flags.no_drop||(interact(c.$el[0]).dropzone({accept:o.selectors.rule_and_group_containers,ondragenter:function(t){r(n,e(t.target),p)},ondrop:function(t){u||r(a,e(t.target),p)}}),c instanceof l&&interact(c.$el.find(o.selectors.group_header)[0]).dropzone({accept:o.selectors.rule_and_group_containers,ondragenter:function(t){r(n,e(t.target),p)},ondrop:function(t){u||r(a,e(t.target),p)}}))}}),this.on("beforeDeleteRule beforeDeleteGroup",function(e,t){e.isDefaultPrevented()||(interact(t.$el[0]).unset(),t instanceof l&&interact(t.$el.find(o.selectors.group_header)[0]).unset())}),this.on("afterApplyRuleFlags afterApplyGroupFlags",function(e,t){t.flags.no_sortable&&t.$el.find(".drag-handle").remove()}),t.disable_template||(this.on("getGroupTemplate.filter",function(n,r){if(r>1){var i=e(n.value);i.find(o.selectors.condition_container).after('<div class="drag-handle"><i class="'+t.icon+'"></i></div>'),n.value=i.prop("outerHTML")}}),this.on("getRuleTemplate.filter",function(n){var r=e(n.value);r.find(o.selectors.rule_header).after('<div class="drag-handle"><i class="'+t.icon+'"></i></div>'),n.value=r.prop("outerHTML")}))},{inherit_no_sortable:!0,inherit_no_drop:!0,icon:"glyphicon glyphicon-sort",disable_template:!1}),o.selectors.rule_and_group_containers=o.selectors.rule_container+", "+o.selectors.group_container,o.selectors.drag_handle=".drag-handle",o.defaults({default_rule_flags:{no_sortable:!1,no_drop:!1},default_group_flags:{no_sortable:!1,no_drop:!1}}),o.define("sql-support",function(e){},{boolean_as_integer:!0}),o.defaults({
sqlOperators:{equal:{op:"= ?"},not_equal:{op:"!= ?"},in:{op:"IN(?)",sep:", "},not_in:{op:"NOT IN(?)",sep:", "},less:{op:"< ?"},less_or_equal:{op:"<= ?"},greater:{op:"> ?"},greater_or_equal:{op:">= ?"},between:{op:"BETWEEN ?",sep:" AND "},not_between:{op:"NOT BETWEEN ?",sep:" AND "},begins_with:{op:"LIKE(?)",mod:"{0}%"},not_begins_with:{op:"NOT LIKE(?)",mod:"{0}%"},contains:{op:"LIKE(?)",mod:"%{0}%"},not_contains:{op:"NOT LIKE(?)",mod:"%{0}%"},ends_with:{op:"LIKE(?)",mod:"%{0}"},not_ends_with:{op:"NOT LIKE(?)",mod:"%{0}"},is_empty:{op:"= ''"},is_not_empty:{op:"!= ''"},is_null:{op:"IS NULL"},is_not_null:{op:"IS NOT NULL"}},sqlRuleOperator:{"=":function(e){return{val:e,op:""===e?"is_empty":"equal"}},"!=":function(e){return{val:e,op:""===e?"is_not_empty":"not_equal"}},LIKE:function(e){return"%"==e.slice(0,1)&&"%"==e.slice(-1)?{val:e.slice(1,-1),op:"contains"}:"%"==e.slice(0,1)?{val:e.slice(1),op:"ends_with"}:"%"==e.slice(-1)?{val:e.slice(0,-1),op:"begins_with"}:void s.error("SQLParse",'Invalid value for LIKE operator "{0}"',e)},"NOT LIKE":function(e){return"%"==e.slice(0,1)&&"%"==e.slice(-1)?{val:e.slice(1,-1),op:"not_contains"}:"%"==e.slice(0,1)?{val:e.slice(1),op:"not_ends_with"}:"%"==e.slice(-1)?{val:e.slice(0,-1),op:"not_begins_with"}:void s.error("SQLParse",'Invalid value for NOT LIKE operator "{0}"',e)},IN:function(e){return{val:e,op:"in"}},"NOT IN":function(e){return{val:e,op:"not_in"}},"<":function(e){return{val:e,op:"less"}},"<=":function(e){return{val:e,op:"less_or_equal"}},">":function(e){return{val:e,op:"greater"}},">=":function(e){return{val:e,op:"greater_or_equal"}},BETWEEN:function(e){return{val:e,op:"between"}},"NOT BETWEEN":function(e){return{val:e,op:"not_between"}},IS:function(e){return null!==e&&s.error("SQLParse","Invalid value for IS operator"),{val:null,op:"is_null"}},"IS NOT":function(e){return null!==e&&s.error("SQLParse","Invalid value for IS operator"),{val:null,op:"is_not_null"}}},sqlStatements:{question_mark:function(){var e=[];return{add:function(t,n){return e.push(n),"?"},run:function(){return e}}},numbered:function(e){(!e||e.length>1)&&(e="$");var t=0,n=[];return{add:function(r,i){return n.push(i),t++,e+t},run:function(){return n}}},named:function(e){(!e||e.length>1)&&(e=":");var t={},n={};return{add:function(r,i){t[r.field]||(t[r.field]=1);var o=r.field+"_"+t[r.field]++;return n[o]=i,e+o},run:function(){return n}}}},sqlRuleStatement:{question_mark:function(e){var t=0;return{parse:function(n){return"?"==n?e[t++]:n},esc:function(e){return e.replace(/\?/g,"'?'")}}},numbered:function(e,t){(!t||t.length>1)&&(t="$");var n=new RegExp("^\\"+t+"[0-9]+$"),r=new RegExp("\\"+t+"([0-9]+)","g");return{parse:function(t){return n.test(t)?e[t.slice(1)-1]:t},esc:function(e){return e.replace(r,"'"+("$"==t?"$$":t)+"$1'")}}},named:function(e,t){(!t||t.length>1)&&(t=":");var n=new RegExp("^\\"+t),r=new RegExp("\\"+t+"("+Object.keys(e).join("|")+")","g");return{parse:function(t){return n.test(t)?e[t.slice(1)]:t},esc:function(e){return e.replace(r,"'"+("$"==t?"$$":t)+"$1'")}}}}}),o.extend({getSQL:function(e,t,n){if(!(n=void 0===n?this.getRules():n))return null;t=t?"\n":" ";var r=this.getPluginOptions("sql-support","boolean_as_integer");if(!0===e&&(e="question_mark"),"string"==typeof e){var o=i(e);e=this.settings.sqlStatements[o[1]](o[2])}var a=this,l=function n(i){if(i.condition||(i.condition=a.settings.default_condition),-1===["AND","OR"].indexOf(i.condition.toUpperCase())&&s.error("UndefinedSQLCondition",'Unable to build SQL query with condition "{0}"',i.condition),!i.rules)return"";var o=[];i.rules.forEach(function(i){if(i.rules&&i.rules.length>0)o.push("("+t+n(i)+t+")"+t);else{var l=a.settings.sqlOperators[i.operator],u=a.getOperatorByType(i.operator),c="";void 0===l&&s.error("UndefinedSQLOperator",'Unknown SQL operation for operator "{0}"',i.operator),0!==u.nb_inputs&&(i.value instanceof Array||(i.value=[i.value]),i.value.forEach(function(t,n){n>0&&(c+=l.sep),"boolean"==i.type&&r?t=t?1:0:e||"integer"===i.type||"double"===i.type||"boolean"===i.type||(t=s.escapeString(t)),l.mod&&(t=s.fmt(l.mod,t)),e?c+=e.add(i,t):("string"==typeof t&&(t="'"+t+"'"),c+=t)}));var p=function(e){return l.op.replace("?",function(){return e})},d=a.change("getSQLField",i.field,i),h=d+" "+p(c);o.push(a.change("ruleToSQL",h,i,c,p))}});var l=o.join(" "+i.condition+t);return a.change("groupToSQL",l,i)}(n);return e?{sql:l,params:e.run()}:{sql:l}},getRulesFromSQL:function(t,n){"SQLParser"in window||s.error("MissingLibrary","SQLParser is required to parse SQL queries. Get it here https://github.com/mistic100/sql-parser");var r=this;if("string"==typeof t&&(t={sql:t}),!0===n&&(n="question_mark"),"string"==typeof n){var o=i(n);n=this.settings.sqlRuleStatement[o[1]](t.params,o[2])}n&&(t.sql=n.esc(t.sql)),0!==t.sql.toUpperCase().indexOf("SELECT")&&(t.sql="SELECT * FROM table WHERE "+t.sql);var a=SQLParser.parse(t.sql);a.where||s.error("SQLParse","No WHERE clause found");var l=r.change("parseSQLNode",a.where.conditions);if("rules"in l&&"condition"in l)return l;if("id"in l&&"operator"in l&&"value"in l)return{condition:this.settings.default_condition,rules:[l]};var u=r.change("sqlToGroup",{condition:this.settings.default_condition,rules:[]},l),c=u;return function t(i,o){if(null!==i){if("rules"in(i=r.change("parseSQLNode",i))&&"condition"in i)return void c.rules.push(i);if("id"in i&&"operator"in i&&"value"in i)return void c.rules.push(i);if("left"in i&&"right"in i&&"operation"in i||s.error("SQLParse","Unable to parse WHERE clause"),-1!==["AND","OR"].indexOf(i.operation.toUpperCase())){if(r.change("sqlGroupsDistinct",o>0&&c.condition!=i.operation.toUpperCase(),c,i,o)){var a=r.change("sqlToGroup",{condition:r.settings.default_condition,rules:[]},i);c.rules.push(a),c=a}c.condition=i.operation.toUpperCase(),o++;var l=c;t(i.left,o),c=l,t(i.right,o)}else{e.isPlainObject(i.right.value)&&s.error("SQLParse","Value format not supported for {0}.",i.left.value);var u;u=e.isArray(i.right.value)?i.right.value.map(function(e){return e.value}):i.right.value,n&&(u=e.isArray(u)?u.map(n.parse):n.parse(u));var p=i.operation.toUpperCase();"<>"==p&&(p="!=");var d=r.settings.sqlRuleOperator[p];void 0===d&&s.error("UndefinedSQLOperator",'Invalid SQL operation "{0}".',i.operation);var h,f=d.call(this,u,i.operation);"values"in i.left?h=i.left.values.join("."):"value"in i.left?h=i.left.value:s.error("SQLParse","Cannot find field name in {0}",JSON.stringify(i.left));var g=r.getSQLFieldID(h,u),m=r.change("sqlToRule",{id:g,field:h,operator:f.op,value:f.val},i);c.rules.push(m)}}}(l,0),u},setRulesFromSQL:function(e,t){this.setRules(this.getRulesFromSQL(e,t))},getSQLFieldID:function(e,t){var n=this.filters.filter(function(t){return t.field.toLowerCase()===e.toLowerCase()});return 1===n.length?n[0].id:this.change("getSQLFieldID",e,t)}}),o.define("unique-filter",function(){this.status.used_filters={},this.on("afterUpdateRuleFilter",this.updateDisabledFilters),this.on("afterDeleteRule",this.updateDisabledFilters),this.on("afterCreateRuleFilters",this.applyDisabledFilters),this.on("afterReset",this.clearDisabledFilters),this.on("afterClear",this.clearDisabledFilters),this.on("getDefaultFilter.filter",function(e,t){var n=e.builder;if(n.updateDisabledFilters(),e.value.id in n.status.used_filters){n.filters.some(function(r){if(!(r.id in n.status.used_filters)||n.status.used_filters[r.id].length>0&&-1===n.status.used_filters[r.id].indexOf(t.parent))return e.value=r,!0})||(s.error(!1,"UniqueFilter","No more non-unique filters available"),e.value=void 0)}})}),o.extend({updateDisabledFilters:function(e){var t=e?e.builder:this;t.status.used_filters={},t.model&&(!function e(n){n.each(function(e){e.filter&&e.filter.unique&&(t.status.used_filters[e.filter.id]||(t.status.used_filters[e.filter.id]=[]),"group"==e.filter.unique&&t.status.used_filters[e.filter.id].push(e.parent))},function(t){e(t)})}(t.model.root),t.applyDisabledFilters(e))},clearDisabledFilters:function(e){var t=e?e.builder:this;t.status.used_filters={},t.applyDisabledFilters(e)},applyDisabledFilters:function(t){var n=t?t.builder:this;n.$el.find(o.selectors.filter_container+" option").prop("disabled",!1),e.each(n.status.used_filters,function(e,t){0===t.length?n.$el.find(o.selectors.filter_container+' option[value="'+e+'"]:not(:selected)').prop("disabled",!0):t.forEach(function(t){t.each(function(t){t.$el.find(o.selectors.filter_container+' option[value="'+e+'"]:not(:selected)').prop("disabled",!0)})})}),n.settings.plugins&&n.settings.plugins["bt-selectpicker"]&&n.$el.find(o.selectors.rule_filter).selectpicker("render")}}),o.regional.en={__locale:"English (en)",__author:'Damien "Mistic" Sorel, http://www.strangeplanet.fr',add_rule:"Add rule",add_group:"Add group",delete_rule:"Delete",delete_group:"Delete",conditions:{AND:"AND",OR:"OR"},operators:{equal:"equal",not_equal:"not equal",in:"in",not_in:"not in",less:"less",less_or_equal:"less or equal",greater:"greater",greater_or_equal:"greater or equal",between:"between",not_between:"not between",begins_with:"begins with",not_begins_with:"doesn't begin with",contains:"contains",not_contains:"doesn't contain",ends_with:"ends with",not_ends_with:"doesn't end with",is_empty:"is empty",is_not_empty:"is not empty",is_null:"is null",is_not_null:"is not null"},errors:{no_filter:"No filter selected",empty_group:"The group is empty",radio_empty:"No value selected",checkbox_empty:"No value selected",select_empty:"No value selected",string_empty:"Empty value",string_exceed_min_length:"Must contain at least {0} characters",string_exceed_max_length:"Must not contain more than {0} characters",string_invalid_format:"Invalid format ({0})",number_nan:"Not a number",number_not_integer:"Not an integer",number_not_double:"Not a real number",number_exceed_min:"Must be greater than {0}",number_exceed_max:"Must be lower than {0}",number_wrong_step:"Must be a multiple of {0}",number_between_invalid:"Invalid values, {0} is greater than {1}",datetime_empty:"Empty value",datetime_invalid:"Invalid date format ({0})",datetime_exceed_min:"Must be after {0}",datetime_exceed_max:"Must be before {0}",datetime_between_invalid:"Invalid values, {0} is greater than {1}",boolean_not_valid:"Not a boolean",operator_not_multiple:'Operator "{1}" cannot accept multiple values'},invert:"Invert",NOT:"NOT"},o.defaults({lang_code:"en"}),o}),function(e,t){"function"==typeof define&&define.amd?define(["jquery","query-builder"],t):t(e.jQuery)}(this,function(e){"use strict";e.fn.queryBuilder.define("bt-selectpicker-values",function(t){e.fn.selectpicker&&e.fn.selectpicker.Constructor||Utils.error("MissingLibrary",'Bootstrap Select is required to use "bt-selectpicker" plugin. Get it here: http://silviomoreto.github.io/bootstrap-select'),this.on("afterCreateRuleInput",function(e,n){n.$el.find(".rule-value-container").find("select").removeClass("form-control").selectpicker(t)}),this.on("afterUpdateRuleValue",function(e,t){t.$el.find(".rule-value-container").find("select").selectpicker("render")})},{container:"body",style:"btn-inverse btn-xs",width:"auto"})}),$._getComputedStyle=function(e,t){return(window.parent?window.parent.getComputedStyle(e,""):window.getComputedStyle(e,""))[t]},$.hasTransition=function(e){var t=$._getComputedStyle(e,Modernizr.prefixed("transitionProperty"));return t&&""!=t&&"none"!=t},$.hasAnimation=function(e){var t=$._getComputedStyle(e,Modernizr.prefixed("animationName"));return t&&""!=t&&"none"!=t},$.prototype.onTransitionEndOnce=function(e){return this.each(function(t,n){$(n).onTransitionEnd(function(){$(n).unbindTransitionEnd(),e()})}),this};var animationListeners="transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd animationend webkitAnimationEnd MSAnimationEnd oanimationend oAnimationEnd";$.prototype.unbindTransitionEnd=function(){return this.each(function(e,t){$(t).unbind(animationListeners)}),this},$.prototype.onTransitionEnd=function(e){return this.each(function(t,n){console.log($.hasTransition(n)),$.hasTransition(n)||$.hasAnimation(n)?(console.log(1),$(n).bind(animationListeners,e)):(console.log(0),e())}),this},function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(n),n}:e(jQuery)}(function(e){"use strict";function t(t){var n=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(t.target).closest("form").ajaxSubmit(n))}function n(t){var n=t.target,r=e(n);if(!r.is("[type=submit],[type=image]")){var i=r.closest("[type=submit]");if(0===i.length)return;n=i[0]}var o=n.form;if(o.clk=n,"image"===n.type)if(void 0!==t.offsetX)o.clk_x=t.offsetX,o.clk_y=t.offsetY;else if("function"==typeof e.fn.offset){var s=r.offset();o.clk_x=t.pageX-s.left,o.clk_y=t.pageY-s.top}else o.clk_x=t.pageX-n.offsetLeft,o.clk_y=t.pageY-n.offsetTop;setTimeout(function(){o.clk=o.clk_x=o.clk_y=null},100)}function r(){if(e.fn.ajaxSubmit.debug){var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}}var i=/\r?\n/g,o={};o.fileapi=void 0!==e('<input type="file">').get(0).files,o.formdata=void 0!==window.FormData;var s=!!e.fn.prop;e.fn.attr2=function(){if(!s)return this.attr.apply(this,arguments);var e=this.prop.apply(this,arguments);return e&&e.jquery||"string"==typeof e?e:this.attr.apply(this,arguments)},e.fn.ajaxSubmit=function(t,n,i,a){function l(n){var r,i,o=e.param(n,t.traditional).split("&"),s=o.length,a=[];for(r=0;r<s;r++)o[r]=o[r].replace(/\+/g," "),i=o[r].split("="),a.push([decodeURIComponent(i[0]),decodeURIComponent(i[1])]);return a}function u(n){function i(e){var t=null;try{e.contentWindow&&(t=e.contentWindow.document)}catch(e){r("cannot get iframe.contentWindow document: "+e)}if(t)return t;try{t=e.contentDocument?e.contentDocument:e.document}catch(n){r("cannot get iframe.contentDocument: "+n),t=e.document}return t}function o(){function t(){try{var e=i(m).readyState;r("state = "+e),e&&"uninitialized"===e.toLowerCase()&&setTimeout(t,50)}catch(e){r("Server abort: ",e," (",e.name,")"),a(C),x&&clearTimeout(x),x=void 0}}var n=h.attr2("target"),o=h.attr2("action"),s=h.attr("enctype")||h.attr("encoding")||"multipart/form-data";$.setAttribute("target",f),c&&!/post/i.test(c)||$.setAttribute("method","POST"),o!==p.url&&$.setAttribute("action",p.url),p.skipEncodingOverride||c&&!/post/i.test(c)||h.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),p.timeout&&(x=setTimeout(function(){w=!0,a(D)},p.timeout));var l=[];try{if(p.extraData)for(var u in p.extraData)p.extraData.hasOwnProperty(u)&&(e.isPlainObject(p.extraData[u])&&p.extraData[u].hasOwnProperty("name")&&p.extraData[u].hasOwnProperty("value")?l.push(e('<input type="hidden" name="'+p.extraData[u].name+'">',A).val(p.extraData[u].value).appendTo($)[0]):l.push(e('<input type="hidden" name="'+u+'">',A).val(p.extraData[u]).appendTo($)[0]));p.iframeTarget||g.appendTo(O),m.attachEvent?m.attachEvent("onload",a):m.addEventListener("load",a,!1),setTimeout(t,15);try{$.submit()}catch(e){document.createElement("form").submit.apply($)}}finally{$.setAttribute("action",o),$.setAttribute("enctype",s),n?$.setAttribute("target",n):h.removeAttr("target"),e(l).remove()}}function a(t){if(!_.aborted&&!R){if((k=i(m))||(r("cannot access response document"),t=C),t===D&&_)return _.abort("timeout"),void S.reject(_,"timeout");if(t===C&&_)return _.abort("server abort"),void S.reject(_,"error","server abort");if(k&&k.location.href!==p.iframeSrc||w){m.detachEvent?m.detachEvent("onload",a):m.removeEventListener("load",a,!1);var n,o="success";try{if(w)throw"timeout";var s="xml"===p.dataType||k.XMLDocument||e.isXMLDoc(k);if(r("isXml="+s),!s&&window.opera&&(null===k.body||!k.body.innerHTML)&&--j)return r("requeing onLoad callback, DOM not available"),void setTimeout(a,250);var l=k.body?k.body:k.documentElement;_.responseText=l?l.innerHTML:null,_.responseXML=k.XMLDocument?k.XMLDocument:k,s&&(p.dataType="xml"),_.getResponseHeader=function(e){return{"content-type":p.dataType}[e.toLowerCase()]},l&&(_.status=Number(l.getAttribute("status"))||_.status,_.statusText=l.getAttribute("statusText")||_.statusText);var u=(p.dataType||"").toLowerCase(),c=/(json|script|text)/.test(u);if(c||p.textarea){var h=k.getElementsByTagName("textarea")[0];if(h)_.responseText=h.value,_.status=Number(h.getAttribute("status"))||_.status,_.statusText=h.getAttribute("statusText")||_.statusText;else if(c){var f=k.getElementsByTagName("pre")[0],v=k.getElementsByTagName("body")[0];f?_.responseText=f.textContent?f.textContent:f.innerText:v&&(_.responseText=v.textContent?v.textContent:v.innerText)}}else"xml"===u&&!_.responseXML&&_.responseText&&(_.responseXML=L(_.responseText));try{q=I(_,u,p)}catch(e){o="parsererror",_.error=n=e||o}}catch(e){r("error caught: ",e),o="error",_.error=n=e||o}_.aborted&&(r("upload aborted"),o=null),_.status&&(o=_.status>=200&&_.status<300||304===_.status?"success":"error"),"success"===o?(p.success&&p.success.call(p.context,q,"success",_),S.resolve(_.responseText,"success",_),d&&e.event.trigger("ajaxSuccess",[_,p])):o&&(void 0===n&&(n=_.statusText),p.error&&p.error.call(p.context,_,o,n),S.reject(_,"error",n),d&&e.event.trigger("ajaxError",[_,p,n])),d&&e.event.trigger("ajaxComplete",[_,p]),d&&!--e.active&&e.event.trigger("ajaxStop"),p.complete&&p.complete.call(p.context,_,o),R=!0,p.timeout&&clearTimeout(x),setTimeout(function(){p.iframeTarget?g.attr("src",p.iframeSrc):g.remove(),_.responseXML=null},100)}}}var l,u,p,d,f,g,m,_,y,b,w,x,$=h[0],S=e.Deferred();if(S.abort=function(e){_.abort(e)},n)for(u=0;u<v.length;u++)l=e(v[u]),s?l.prop("disabled",!1):l.removeAttr("disabled");(p=e.extend(!0,{},e.ajaxSettings,t)).context=p.context||p,f="jqFormIO"+(new Date).getTime();var A=$.ownerDocument,O=h.closest("body");if(p.iframeTarget?(b=(g=e(p.iframeTarget,A)).attr2("name"))?f=b:g.attr2("name",f):(g=e('<iframe name="'+f+'" src="'+p.iframeSrc+'" />',A)).css({position:"absolute",top:"-1000px",left:"-1000px"}),m=g[0],_={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var n="timeout"===t?"timeout":"aborted";r("aborting upload... "+n),this.aborted=1;try{m.contentWindow.document.execCommand&&m.contentWindow.document.execCommand("Stop")}catch(e){}g.attr("src",p.iframeSrc),_.error=n,p.error&&p.error.call(p.context,_,n,t),d&&e.event.trigger("ajaxError",[_,p,n]),p.complete&&p.complete.call(p.context,_,n)}},(d=p.global)&&0==e.active++&&e.event.trigger("ajaxStart"),d&&e.event.trigger("ajaxSend",[_,p]),p.beforeSend&&!1===p.beforeSend.call(p.context,_,p))return p.global&&e.active--,S.reject(),S;if(_.aborted)return S.reject(),S;(y=$.clk)&&(b=y.name)&&!y.disabled&&(p.extraData=p.extraData||{},p.extraData[b]=y.value,"image"===y.type&&(p.extraData[b+".x"]=$.clk_x,p.extraData[b+".y"]=$.clk_y));var D=1,C=2,E=e("meta[name=csrf-token]").attr("content"),T=e("meta[name=csrf-param]").attr("content");T&&E&&(p.extraData=p.extraData||{},p.extraData[T]=E),p.forceSync?o():setTimeout(o,10);var q,k,R,j=50,L=e.parseXML||function(e,t){return window.ActiveXObject?((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!==t.documentElement.nodeName?t:null},M=e.parseJSON||function(e){return window.eval("("+e+")")},I=function(t,n,r){var i=t.getResponseHeader("content-type")||"",o=("xml"===n||!n)&&i.indexOf("xml")>=0,s=o?t.responseXML:t.responseText;return o&&"parsererror"===s.documentElement.nodeName&&e.error&&e.error("parsererror"),r&&r.dataFilter&&(s=r.dataFilter(s,n)),"string"==typeof s&&(("json"===n||!n)&&i.indexOf("json")>=0?s=M(s):("script"===n||!n)&&i.indexOf("javascript")>=0&&e.globalEval(s)),s};return S}if(!this.length)return r("ajaxSubmit: skipping submit process - no element selected"),this;var c,p,d,h=this;"function"==typeof t?t={success:t}:"string"==typeof t||!1===t&&arguments.length>0?(t={url:t,data:n,dataType:i},"function"==typeof a&&(t.success=a)):void 0===t&&(t={}),c=t.method||t.type||this.attr2("method"),(d=(d="string"==typeof(p=t.url||this.attr2("action"))?e.trim(p):"")||window.location.href||"")&&(d=(d.match(/^([^#]+)/)||[])[1]),t=e.extend(!0,{url:d,success:e.ajaxSettings.success,type:c||e.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},t);var f={};if(this.trigger("form-pre-serialize",[this,t,f]),f.veto)return r("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(t.beforeSerialize&&!1===t.beforeSerialize(this,t))return r("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var g=t.traditional;void 0===g&&(g=e.ajaxSettings.traditional);var m,v=[],_=this.formToArray(t.semantic,v,t.filtering);if(t.data){var y=e.isFunction(t.data)?t.data(_):t.data;t.extraData=y,m=e.param(y,g)}if(t.beforeSubmit&&!1===t.beforeSubmit(_,this,t))return r("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[_,this,t,f]),f.veto)return r("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var b=e.param(_,g);m&&(b=b?b+"&"+m:m),"GET"===t.type.toUpperCase()?(t.url+=(t.url.indexOf("?")>=0?"&":"?")+b,t.data=null):t.data=b;var w=[];if(t.resetForm&&w.push(function(){h.resetForm()}),t.clearForm&&w.push(function(){h.clearForm(t.includeHidden)}),!t.dataType&&t.target){var x=t.success||function(){};w.push(function(n,r,i){var o=arguments,s=t.replaceTarget?"replaceWith":"html";e(t.target)[s](n).each(function(){x.apply(this,o)})})}else t.success&&(e.isArray(t.success)?e.merge(w,t.success):w.push(t.success));if(t.success=function(e,n,r){for(var i=t.context||this,o=0,s=w.length;o<s;o++)w[o].apply(i,[e,n,r||h,h])},t.error){var $=t.error;t.error=function(e,n,r){var i=t.context||this;$.apply(i,[e,n,r,h])}}if(t.complete){var S=t.complete;t.complete=function(e,n){var r=t.context||this;S.apply(r,[e,n,h])}}var A=e("input[type=file]:enabled",this).filter(function(){return""!==e(this).val()}).length>0,O="multipart/form-data",D=h.attr("enctype")===O||h.attr("encoding")===O,C=o.fileapi&&o.formdata;r("fileAPI :"+C);var E,T=(A||D)&&!C;!1!==t.iframe&&(t.iframe||T)?t.closeKeepAlive?e.get(t.closeKeepAlive,function(){E=u(_)}):E=u(_):E=(A||D)&&C?function(n){for(var r=new FormData,i=0;i<n.length;i++)r.append(n[i].name,n[i].value);if(t.extraData){var o=l(t.extraData);for(i=0;i<o.length;i++)o[i]&&r.append(o[i][0],o[i][1])}t.data=null;var s=e.extend(!0,{},e.ajaxSettings,t,{contentType:!1,processData:!1,cache:!1,type:c||"POST"});t.uploadProgress&&(s.xhr=function(){var n=e.ajaxSettings.xhr();return n.upload&&n.upload.addEventListener("progress",function(e){var n=0,r=e.loaded||e.position,i=e.total;e.lengthComputable&&(n=Math.ceil(r/i*100)),t.uploadProgress(e,r,i,n)},!1),n}),s.data=null;var a=s.beforeSend;return s.beforeSend=function(e,n){t.formData?n.data=t.formData:n.data=r,a&&a.call(this,e,n)},e.ajax(s)}(_):e.ajax(t),h.removeData("jqxhr").data("jqxhr",E);for(var q=0;q<v.length;q++)v[q]=null;return this.trigger("form-submit-notify",[this,t]),this},e.fn.ajaxForm=function(i,o,s,a){if(("string"==typeof i||!1===i&&arguments.length>0)&&(i={url:i,data:o,dataType:s},"function"==typeof a&&(i.success=a)),i=i||{},i.delegation=i.delegation&&e.isFunction(e.fn.on),!i.delegation&&0===this.length){var l={s:this.selector,c:this.context};return!e.isReady&&l.s?(r("DOM not ready, queuing ajaxForm"),e(function(){e(l.s,l.c).ajaxForm(i)}),this):(r("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return i.delegation?(e(document).off("submit.form-plugin",this.selector,t).off("click.form-plugin",this.selector,n).on("submit.form-plugin",this.selector,i,t).on("click.form-plugin",this.selector,i,n),this):this.ajaxFormUnbind().on("submit.form-plugin",i,t).on("click.form-plugin",i,n)},e.fn.ajaxFormUnbind=function(){return this.off("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(t,n,r){var i=[];if(0===this.length)return i;var s,a=this[0],l=this.attr("id"),u=t||void 0===a.elements?a.getElementsByTagName("*"):a.elements;if(u&&(u=e.makeArray(u)),l&&(t||/(Edge|Trident)\//.test(navigator.userAgent))&&(s=e(':input[form="'+l+'"]').get()).length&&(u=(u||[]).concat(s)),!u||!u.length)return i;e.isFunction(r)&&(u=e.map(u,r));var c,p,d,h,f,g,m;for(c=0,g=u.length;c<g;c++)if(f=u[c],(d=f.name)&&!f.disabled)if(t&&a.clk&&"image"===f.type)a.clk===f&&(i.push({name:d,value:e(f).val(),type:f.type}),i.push({name:d+".x",value:a.clk_x},{name:d+".y",value:a.clk_y}));else if((h=e.fieldValue(f,!0))&&h.constructor===Array)for(n&&n.push(f),p=0,m=h.length;p<m;p++)i.push({name:d,value:h[p]});else if(o.fileapi&&"file"===f.type){n&&n.push(f);var v=f.files;if(v.length)for(p=0;p<v.length;p++)i.push({name:d,value:v[p],type:f.type});else i.push({name:d,value:"",type:f.type})}else null!==h&&void 0!==h&&(n&&n.push(f),i.push({name:d,value:h,type:f.type,required:f.required}));if(!t&&a.clk){var _=e(a.clk),y=_[0];(d=y.name)&&!y.disabled&&"image"===y.type&&(i.push({name:d,value:_.val()}),i.push({name:d+".x",value:a.clk_x},{name:d+".y",value:a.clk_y}))}return i},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var n=[];return this.each(function(){var r=this.name;if(r){var i=e.fieldValue(this,t);if(i&&i.constructor===Array)for(var o=0,s=i.length;o<s;o++)n.push({name:r,value:i[o]});else null!==i&&void 0!==i&&n.push({name:this.name,value:i})}}),e.param(n)},e.fn.fieldValue=function(t){for(var n=[],r=0,i=this.length;r<i;r++){var o=this[r],s=e.fieldValue(o,t);null===s||void 0===s||s.constructor===Array&&!s.length||(s.constructor===Array?e.merge(n,s):n.push(s))}return n},e.fieldValue=function(t,n){var r=t.name,o=t.type,s=t.tagName.toLowerCase();if(void 0===n&&(n=!0),n&&(!r||t.disabled||"reset"===o||"button"===o||("checkbox"===o||"radio"===o)&&!t.checked||("submit"===o||"image"===o)&&t.form&&t.form.clk!==t||"select"===s&&-1===t.selectedIndex))return null;if("select"===s){var a=t.selectedIndex;if(a<0)return null;for(var l=[],u=t.options,c="select-one"===o,p=c?a+1:u.length,d=c?a:0;d<p;d++){var h=u[d];if(h.selected&&!h.disabled){var f=h.value;if(f||(f=h.attributes&&h.attributes.value&&!h.attributes.value.specified?h.text:h.value),c)return f;l.push(f)}}return l}return e(t).val().replace(i,"\r\n")},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var n=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var r=this.type,i=this.tagName.toLowerCase();n.test(r)||"textarea"===i?this.value="":"checkbox"===r||"radio"===r?this.checked=!1:"select"===i?this.selectedIndex=-1:"file"===r?/MSIE/.test(navigator.userAgent)?e(this).replaceWith(e(this).clone(!0)):e(this).val(""):t&&(!0===t&&/hidden/.test(r)||"string"==typeof t&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){var t=e(this),n=this.tagName.toLowerCase();switch(n){case"input":this.checked=this.defaultChecked;case"textarea":return this.value=this.defaultValue,!0;case"option":case"optgroup":var r=t.parents("select");return r.length&&r[0].multiple?"option"===n?this.selected=this.defaultSelected:t.find("option").resetForm():r.resetForm(),!0;case"select":return t.find("option").each(function(e){if(this.selected=this.defaultSelected,this.defaultSelected&&!t[0].multiple)return t[0].selectedIndex=e,!1}),!0;case"label":var i=e(t.attr("for")),o=t.find("input,select,textarea");return i[0]&&o.unshift(i[0]),o.resetForm(),!0;case"form":return("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset(),!0;default:return t.find("form,input,label,select,textarea").resetForm(),!0}})},e.fn.enable=function(e){return void 0===e&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return void 0===t&&(t=!0),this.each(function(){var n=this.type;if("checkbox"===n||"radio"===n)this.checked=t;else if("option"===this.tagName.toLowerCase()){var r=e(this).parent("select");t&&r[0]&&"select-one"===r[0].type&&r.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1}),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(n),n}:e(jQuery)}(function(e){var t=function(){if(e&&e.fn&&e.fn.select2&&e.fn.select2.amd)var t=e.fn.select2.amd;var t;return function(){if(!t||!t.requirejs){t?n=t:t={};var e,n,r;!function(t){function i(e,t){return w.call(e,t)}function o(e,t){var n,r,i,o,s,a,l,u,c,p,d,h,f=t&&t.split("/"),g=y.map,m=g&&g["*"]||{};if(e){for(e=e.split("/"),s=e.length-1,y.nodeIdCompat&&$.test(e[s])&&(e[s]=e[s].replace($,"")),"."===e[0].charAt(0)&&f&&(h=f.slice(0,f.length-1),e=h.concat(e)),c=0;c<e.length;c++)if("."===(d=e[c]))e.splice(c,1),c-=1;else if(".."===d){if(0===c||1===c&&".."===e[2]||".."===e[c-1])continue;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}if((f||m)&&g){for(n=e.split("/"),c=n.length;c>0;c-=1){if(r=n.slice(0,c).join("/"),f)for(p=f.length;p>0;p-=1)if((i=g[f.slice(0,p).join("/")])&&(i=i[r])){o=i,a=c;break}if(o)break;!l&&m&&m[r]&&(l=m[r],u=c)}!o&&l&&(o=l,a=u),o&&(n.splice(0,a,o),e=n.join("/"))}return e}function s(e,n){return function(){var r=x.call(arguments,0);return"string"!=typeof r[0]&&1===r.length&&r.push(null),f.apply(t,r.concat([e,n]))}}function a(e){return function(t){return o(t,e)}}function l(e){return function(t){v[e]=t}}function u(e){if(i(_,e)){var n=_[e];delete _[e],b[e]=!0,h.apply(t,n)}if(!i(v,e)&&!i(b,e))throw new Error("No "+e);return v[e]}function c(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function p(e){return e?c(e):[]}function d(e){return function(){return y&&y.config&&y.config[e]||{}}}var h,f,g,m,v={},_={},y={},b={},w=Object.prototype.hasOwnProperty,x=[].slice,$=/\.js$/;g=function(e,t){var n,r=c(e),i=r[0],s=t[1];return e=r[1],i&&(i=o(i,s),n=u(i)),i?e=n&&n.normalize?n.normalize(e,a(s)):o(e,s):(e=o(e,s),r=c(e),i=r[0],e=r[1],i&&(n=u(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},m={require:function(e){return s(e)},exports:function(e){var t=v[e];return void 0!==t?t:v[e]={}},module:function(e){return{id:e,uri:"",exports:v[e],config:d(e)}}},h=function(e,n,r,o){var a,c,d,h,f,y,w,x=[],$=typeof r;if(o=o||e,y=p(o),"undefined"===$||"function"===$){for(n=!n.length&&r.length?["require","exports","module"]:n,f=0;f<n.length;f+=1)if(h=g(n[f],y),"require"===(c=h.f))x[f]=m.require(e);else if("exports"===c)x[f]=m.exports(e),w=!0;else if("module"===c)a=x[f]=m.module(e);else if(i(v,c)||i(_,c)||i(b,c))x[f]=u(c);else{if(!h.p)throw new Error(e+" missing "+c);h.p.load(h.n,s(o,!0),l(c),{}),x[f]=v[c]}d=r?r.apply(v[e],x):void 0,e&&(a&&a.exports!==t&&a.exports!==v[e]?v[e]=a.exports:d===t&&w||(v[e]=d))}else e&&(v[e]=r)},e=n=f=function(e,n,r,i,o){if("string"==typeof e)return m[e]?m[e](n):u(g(e,p(n)).f);if(!e.splice){if(y=e,y.deps&&f(y.deps,y.callback),!n)return;n.splice?(e=n,n=r,r=null):e=t}return n=n||function(){},"function"==typeof r&&(r=i,i=o),i?h(t,e,n,r):setTimeout(function(){h(t,e,n,r)},4),f},f.config=function(e){return f(e)},e._defined=v,r=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),i(v,e)||i(_,e)||(_[e]=[e,t,n])},r.amd={jQuery:!0}}(),t.requirejs=e,t.require=n,t.define=r}}(),t.define("almond",function(){}),t.define("jquery",[],function(){var t=e||$;return null==t&&console&&console.error&&console.error("Select2: An instance of jQuery or a jQuery-compatible library was not found. Make sure that you are including jQuery before Select2 on your web page."),t}),t.define("select2/utils",["jquery"],function(e){function t(e){var t=e.prototype,n=[];for(var r in t){
"function"==typeof t[r]&&("constructor"!==r&&n.push(r))}return n}var n={};n.Extend=function(e,t){function n(){this.constructor=e}var r={}.hasOwnProperty;for(var i in t)r.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},n.Decorate=function(e,n){function r(){var t=Array.prototype.unshift,r=n.prototype.constructor.length,i=e.prototype.constructor;r>0&&(t.call(arguments,e.prototype.constructor),i=n.prototype.constructor),i.apply(this,arguments)}function i(){this.constructor=r}var o=t(n),s=t(e);n.displayName=e.displayName,r.prototype=new i;for(var a=0;a<s.length;a++){var l=s[a];r.prototype[l]=e.prototype[l]}for(var u=0;u<o.length;u++){var c=o[u];r.prototype[c]=function(e){var t=function(){};e in r.prototype&&(t=r.prototype[e]);var i=n.prototype[e];return function(){return Array.prototype.unshift.call(arguments,t),i.apply(this,arguments)}}(c)}return r};var r=function(){this.listeners={}};r.prototype.on=function(e,t){this.listeners=this.listeners||{},e in this.listeners?this.listeners[e].push(t):this.listeners[e]=[t]},r.prototype.trigger=function(e){var t=Array.prototype.slice,n=t.call(arguments,1);this.listeners=this.listeners||{},null==n&&(n=[]),0===n.length&&n.push({}),n[0]._type=e,e in this.listeners&&this.invoke(this.listeners[e],t.call(arguments,1)),"*"in this.listeners&&this.invoke(this.listeners["*"],arguments)},r.prototype.invoke=function(e,t){for(var n=0,r=e.length;n<r;n++)e[n].apply(this,t)},n.Observable=r,n.generateChars=function(e){for(var t="",n=0;n<e;n++){t+=Math.floor(36*Math.random()).toString(36)}return t},n.bind=function(e,t){return function(){e.apply(t,arguments)}},n._convertData=function(e){for(var t in e){var n=t.split("-"),r=e;if(1!==n.length){for(var i=0;i<n.length;i++){var o=n[i];o=o.substring(0,1).toLowerCase()+o.substring(1),o in r||(r[o]={}),i==n.length-1&&(r[o]=e[t]),r=r[o]}delete e[t]}}return e},n.hasScroll=function(t,n){var r=e(n),i=n.style.overflowX,o=n.style.overflowY;return(i!==o||"hidden"!==o&&"visible"!==o)&&("scroll"===i||"scroll"===o||(r.innerHeight()<n.scrollHeight||r.innerWidth()<n.scrollWidth))},n.escapeMarkup=function(e){var t={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return"string"!=typeof e?e:String(e).replace(/[&<>"'\/\\]/g,function(e){return t[e]})},n.appendMany=function(t,n){if("1.7"===e.fn.jquery.substr(0,3)){var r=e();e.map(n,function(e){r=r.add(e)}),n=r}t.append(n)},n.__cache={};var i=0;return n.GetUniqueElementId=function(e){var t=e.getAttribute("data-select2-id");return null==t&&(e.id?(t=e.id,e.setAttribute("data-select2-id",t)):(e.setAttribute("data-select2-id",++i),t=i.toString())),t},n.StoreData=function(e,t,r){var i=n.GetUniqueElementId(e);n.__cache[i]||(n.__cache[i]={}),n.__cache[i][t]=r},n.GetData=function(t,r){var i=n.GetUniqueElementId(t);return r?n.__cache[i]&&null!=n.__cache[i][r]?n.__cache[i][r]:e(t).data(r):n.__cache[i]},n.RemoveData=function(e){var t=n.GetUniqueElementId(e);null!=n.__cache[t]&&delete n.__cache[t]},n}),t.define("select2/results",["jquery","./utils"],function(e,t){function n(e,t,r){this.$element=e,this.data=r,this.options=t,n.__super__.constructor.call(this)}return t.Extend(n,t.Observable),n.prototype.render=function(){var t=e('<ul class="select2-results__options" role="tree"></ul>');return this.options.get("multiple")&&t.attr("aria-multiselectable","true"),this.$results=t,t},n.prototype.clear=function(){this.$results.empty()},n.prototype.displayMessage=function(t){var n=this.options.get("escapeMarkup");this.clear(),this.hideLoading();var r=e('<li role="treeitem" aria-live="assertive" class="select2-results__option"></li>'),i=this.options.get("translations").get(t.message);r.append(n(i(t.args))),r[0].className+=" select2-results__message",this.$results.append(r)},n.prototype.hideMessages=function(){this.$results.find(".select2-results__message").remove()},n.prototype.append=function(e){this.hideLoading();var t=[];if(null==e.results||0===e.results.length)return void(0===this.$results.children().length&&this.trigger("results:message",{message:"noResults"}));e.results=this.sort(e.results);for(var n=0;n<e.results.length;n++){var r=e.results[n],i=this.option(r);t.push(i)}this.$results.append(t)},n.prototype.position=function(e,t){t.find(".select2-results").append(e)},n.prototype.sort=function(e){return this.options.get("sorter")(e)},n.prototype.highlightFirstItem=function(){var e=this.$results.find(".select2-results__option[aria-selected]"),t=e.filter("[aria-selected=true]");t.length>0?t.first().trigger("mouseenter"):e.first().trigger("mouseenter"),this.ensureHighlightVisible()},n.prototype.setClasses=function(){var n=this;this.data.current(function(r){var i=e.map(r,function(e){return e.id.toString()});n.$results.find(".select2-results__option[aria-selected]").each(function(){var n=e(this),r=t.GetData(this,"data"),o=""+r.id;null!=r.element&&r.element.selected||null==r.element&&e.inArray(o,i)>-1?n.attr("aria-selected","true"):n.attr("aria-selected","false")})})},n.prototype.showLoading=function(e){this.hideLoading();var t=this.options.get("translations").get("searching"),n={disabled:!0,loading:!0,text:t(e)},r=this.option(n);r.className+=" loading-results",this.$results.prepend(r)},n.prototype.hideLoading=function(){this.$results.find(".loading-results").remove()},n.prototype.option=function(n){var r=document.createElement("li");r.className="select2-results__option";var i={role:"treeitem","aria-selected":"false"};n.disabled&&(delete i["aria-selected"],i["aria-disabled"]="true"),null==n.id&&delete i["aria-selected"],null!=n._resultId&&(r.id=n._resultId),n.title&&(r.title=n.title),n.children&&(i.role="group",i["aria-label"]=n.text,delete i["aria-selected"]);for(var o in i){var s=i[o];r.setAttribute(o,s)}if(n.children){var a=e(r),l=document.createElement("strong");l.className="select2-results__group";e(l);this.template(n,l);for(var u=[],c=0;c<n.children.length;c++){var p=n.children[c],d=this.option(p);u.push(d)}var h=e("<ul></ul>",{class:"select2-results__options select2-results__options--nested"});h.append(u),a.append(l),a.append(h)}else this.template(n,r);return t.StoreData(r,"data",n),r},n.prototype.bind=function(n,r){var i=this,o=n.id+"-results";this.$results.attr("id",o),n.on("results:all",function(e){i.clear(),i.append(e.data),n.isOpen()&&(i.setClasses(),i.highlightFirstItem())}),n.on("results:append",function(e){i.append(e.data),n.isOpen()&&i.setClasses()}),n.on("query",function(e){i.hideMessages(),i.showLoading(e)}),n.on("select",function(){n.isOpen()&&(i.setClasses(),i.highlightFirstItem())}),n.on("unselect",function(){n.isOpen()&&(i.setClasses(),i.highlightFirstItem())}),n.on("open",function(){i.$results.attr("aria-expanded","true"),i.$results.attr("aria-hidden","false"),i.setClasses(),i.ensureHighlightVisible()}),n.on("close",function(){i.$results.attr("aria-expanded","false"),i.$results.attr("aria-hidden","true"),i.$results.removeAttr("aria-activedescendant")}),n.on("results:toggle",function(){var e=i.getHighlightedResults();0!==e.length&&e.trigger("mouseup")}),n.on("results:select",function(){var e=i.getHighlightedResults();if(0!==e.length){var n=t.GetData(e[0],"data");"true"==e.attr("aria-selected")?i.trigger("close",{}):i.trigger("select",{data:n})}}),n.on("results:previous",function(){var e=i.getHighlightedResults(),t=i.$results.find("[aria-selected]"),n=t.index(e);if(!(n<=0)){var r=n-1;0===e.length&&(r=0);var o=t.eq(r);o.trigger("mouseenter");var s=i.$results.offset().top,a=o.offset().top,l=i.$results.scrollTop()+(a-s);0===r?i.$results.scrollTop(0):a-s<0&&i.$results.scrollTop(l)}}),n.on("results:next",function(){var e=i.getHighlightedResults(),t=i.$results.find("[aria-selected]"),n=t.index(e),r=n+1;if(!(r>=t.length)){var o=t.eq(r);o.trigger("mouseenter");var s=i.$results.offset().top+i.$results.outerHeight(!1),a=o.offset().top+o.outerHeight(!1),l=i.$results.scrollTop()+a-s;0===r?i.$results.scrollTop(0):a>s&&i.$results.scrollTop(l)}}),n.on("results:focus",function(e){e.element.addClass("select2-results__option--highlighted")}),n.on("results:message",function(e){i.displayMessage(e)}),e.fn.mousewheel&&this.$results.on("mousewheel",function(e){var t=i.$results.scrollTop(),n=i.$results.get(0).scrollHeight-t+e.deltaY,r=e.deltaY>0&&t-e.deltaY<=0,o=e.deltaY<0&&n<=i.$results.height();r?(i.$results.scrollTop(0),e.preventDefault(),e.stopPropagation()):o&&(i.$results.scrollTop(i.$results.get(0).scrollHeight-i.$results.height()),e.preventDefault(),e.stopPropagation())}),this.$results.on("mouseup",".select2-results__option[aria-selected]",function(n){var r=e(this),o=t.GetData(this,"data");if("true"===r.attr("aria-selected"))return void(i.options.get("multiple")?i.trigger("unselect",{originalEvent:n,data:o}):i.trigger("close",{}));i.trigger("select",{originalEvent:n,data:o})}),this.$results.on("mouseenter",".select2-results__option[aria-selected]",function(n){var r=t.GetData(this,"data");i.getHighlightedResults().removeClass("select2-results__option--highlighted"),i.trigger("results:focus",{data:r,element:e(this)})})},n.prototype.getHighlightedResults=function(){return this.$results.find(".select2-results__option--highlighted")},n.prototype.destroy=function(){this.$results.remove()},n.prototype.ensureHighlightVisible=function(){var e=this.getHighlightedResults();if(0!==e.length){var t=this.$results.find("[aria-selected]"),n=t.index(e),r=this.$results.offset().top,i=e.offset().top,o=this.$results.scrollTop()+(i-r),s=i-r;o-=2*e.outerHeight(!1),n<=2?this.$results.scrollTop(0):(s>this.$results.outerHeight()||s<0)&&this.$results.scrollTop(o)}},n.prototype.template=function(t,n){var r=this.options.get("templateResult"),i=this.options.get("escapeMarkup"),o=r(t,n);null==o?n.style.display="none":"string"==typeof o?n.innerHTML=i(o):e(n).append(o)},n}),t.define("select2/keys",[],function(){return{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46}}),t.define("select2/selection/base",["jquery","../utils","../keys"],function(e,t,n){function r(e,t){this.$element=e,this.options=t,r.__super__.constructor.call(this)}return t.Extend(r,t.Observable),r.prototype.render=function(){var n=e('<span class="select2-selection" role="combobox"  aria-haspopup="true" aria-expanded="false"></span>');return this._tabindex=0,null!=t.GetData(this.$element[0],"old-tabindex")?this._tabindex=t.GetData(this.$element[0],"old-tabindex"):null!=this.$element.attr("tabindex")&&(this._tabindex=this.$element.attr("tabindex")),n.attr("title",this.$element.attr("title")),n.attr("tabindex",this._tabindex),this.$selection=n,n},r.prototype.bind=function(e,t){var r=this,i=(e.id,e.id+"-results");this.container=e,this.$selection.on("focus",function(e){r.trigger("focus",e)}),this.$selection.on("blur",function(e){r._handleBlur(e)}),this.$selection.on("keydown",function(e){r.trigger("keypress",e),e.which===n.SPACE&&e.preventDefault()}),e.on("results:focus",function(e){r.$selection.attr("aria-activedescendant",e.data._resultId)}),e.on("selection:update",function(e){r.update(e.data)}),e.on("open",function(){r.$selection.attr("aria-expanded","true"),r.$selection.attr("aria-owns",i),r._attachCloseHandler(e)}),e.on("close",function(){r.$selection.attr("aria-expanded","false"),r.$selection.removeAttr("aria-activedescendant"),r.$selection.removeAttr("aria-owns"),r.$selection.focus(),window.setTimeout(function(){r.$selection.focus()},0),r._detachCloseHandler(e)}),e.on("enable",function(){r.$selection.attr("tabindex",r._tabindex)}),e.on("disable",function(){r.$selection.attr("tabindex","-1")})},r.prototype._handleBlur=function(t){var n=this;window.setTimeout(function(){document.activeElement==n.$selection[0]||e.contains(n.$selection[0],document.activeElement)||n.trigger("blur",t)},1)},r.prototype._attachCloseHandler=function(n){e(document.body).on("mousedown.select2."+n.id,function(n){var r=e(n.target),i=r.closest(".select2");e(".select2.select2-container--open").each(function(){e(this),this!=i[0]&&t.GetData(this,"element").select2("close")})})},r.prototype._detachCloseHandler=function(t){e(document.body).off("mousedown.select2."+t.id)},r.prototype.position=function(e,t){t.find(".selection").append(e)},r.prototype.destroy=function(){this._detachCloseHandler(this.container)},r.prototype.update=function(e){throw new Error("The `update` method must be defined in child classes.")},r}),t.define("select2/selection/single",["jquery","./base","../utils","../keys"],function(e,t,n,r){function i(){i.__super__.constructor.apply(this,arguments)}return n.Extend(i,t),i.prototype.render=function(){var e=i.__super__.render.call(this);return e.addClass("select2-selection--single"),e.html('<span class="select2-selection__rendered"></span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span>'),e},i.prototype.bind=function(e,t){var n=this;i.__super__.bind.apply(this,arguments);var r=e.id+"-container";this.$selection.find(".select2-selection__rendered").attr("id",r).attr("role","textbox").attr("aria-readonly","true"),this.$selection.attr("aria-labelledby",r),this.$selection.on("mousedown",function(e){1===e.which&&n.trigger("toggle",{originalEvent:e})}),this.$selection.on("focus",function(e){}),this.$selection.on("blur",function(e){}),e.on("focus",function(t){e.isOpen()||n.$selection.focus()})},i.prototype.clear=function(){var e=this.$selection.find(".select2-selection__rendered");e.empty(),e.removeAttr("title")},i.prototype.display=function(e,t){var n=this.options.get("templateSelection");return this.options.get("escapeMarkup")(n(e,t))},i.prototype.selectionContainer=function(){return e("<span></span>")},i.prototype.update=function(e){if(0===e.length)return void this.clear();var t=e[0],n=this.$selection.find(".select2-selection__rendered"),r=this.display(t,n);n.empty().append(r),n.attr("title",t.title||t.text)},i}),t.define("select2/selection/multiple",["jquery","./base","../utils"],function(e,t,n){function r(e,t){r.__super__.constructor.apply(this,arguments)}return n.Extend(r,t),r.prototype.render=function(){var e=r.__super__.render.call(this);return e.addClass("select2-selection--multiple"),e.html('<ul class="select2-selection__rendered"></ul>'),e},r.prototype.bind=function(t,i){var o=this;r.__super__.bind.apply(this,arguments),this.$selection.on("click",function(e){o.trigger("toggle",{originalEvent:e})}),this.$selection.on("click",".select2-selection__choice__remove",function(t){if(!o.options.get("disabled")){var r=e(this),i=r.parent(),s=n.GetData(i[0],"data");o.trigger("unselect",{originalEvent:t,data:s})}})},r.prototype.clear=function(){var e=this.$selection.find(".select2-selection__rendered");e.empty(),e.removeAttr("title")},r.prototype.display=function(e,t){var n=this.options.get("templateSelection");return this.options.get("escapeMarkup")(n(e,t))},r.prototype.selectionContainer=function(){return e('<li class="select2-selection__choice"><span class="select2-selection__choice__remove" role="presentation">&times;</span></li>')},r.prototype.update=function(e){if(this.clear(),0!==e.length){for(var t=[],r=0;r<e.length;r++){var i=e[r],o=this.selectionContainer(),s=this.display(i,o);o.append(s),o.attr("title",i.title||i.text),n.StoreData(o[0],"data",i),t.push(o)}var a=this.$selection.find(".select2-selection__rendered");n.appendMany(a,t)}},r}),t.define("select2/selection/placeholder",["../utils"],function(e){function t(e,t,n){this.placeholder=this.normalizePlaceholder(n.get("placeholder")),e.call(this,t,n)}return t.prototype.normalizePlaceholder=function(e,t){return"string"==typeof t&&(t={id:"",text:t}),t},t.prototype.createPlaceholder=function(e,t){var n=this.selectionContainer();return n.html(this.display(t)),n.addClass("select2-selection__placeholder").removeClass("select2-selection__choice"),n},t.prototype.update=function(e,t){var n=1==t.length&&t[0].id!=this.placeholder.id;if(t.length>1||n)return e.call(this,t);this.clear();var r=this.createPlaceholder(this.placeholder);this.$selection.find(".select2-selection__rendered").append(r)},t}),t.define("select2/selection/allowClear",["jquery","../keys","../utils"],function(e,t,n){function r(){}return r.prototype.bind=function(e,t,n){var r=this;e.call(this,t,n),null==this.placeholder&&this.options.get("debug")&&window.console&&console.error&&console.error("Select2: The `allowClear` option should be used in combination with the `placeholder` option."),this.$selection.on("mousedown",".select2-selection__clear",function(e){r._handleClear(e)}),t.on("keypress",function(e){r._handleKeyboardClear(e,t)})},r.prototype._handleClear=function(e,t){if(!this.options.get("disabled")){var r=this.$selection.find(".select2-selection__clear");if(0!==r.length){t.stopPropagation();var i=n.GetData(r[0],"data"),o=this.$element.val();this.$element.val(this.placeholder.id);var s={data:i};if(this.trigger("clear",s),s.prevented)return void this.$element.val(o);for(var a=0;a<i.length;a++)if(s={data:i[a]},this.trigger("unselect",s),s.prevented)return void this.$element.val(o);this.$element.trigger("change"),this.trigger("toggle",{})}}},r.prototype._handleKeyboardClear=function(e,n,r){r.isOpen()||n.which!=t.DELETE&&n.which!=t.BACKSPACE||this._handleClear(n)},r.prototype.update=function(t,r){if(t.call(this,r),!(this.$selection.find(".select2-selection__placeholder").length>0||0===r.length)){var i=e('<span class="select2-selection__clear">&times;</span>');n.StoreData(i[0],"data",r),this.$selection.find(".select2-selection__rendered").prepend(i)}},r}),t.define("select2/selection/search",["jquery","../utils","../keys"],function(e,t,n){function r(e,t,n){e.call(this,t,n)}return r.prototype.render=function(t){var n=e('<li class="select2-search select2-search--inline"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" role="textbox" aria-autocomplete="list" /></li>');this.$searchContainer=n,this.$search=n.find("input");var r=t.call(this);return this._transferTabIndex(),r},r.prototype.bind=function(e,r,i){var o=this;e.call(this,r,i),r.on("open",function(){o.$search.trigger("focus")}),r.on("close",function(){o.$search.val(""),o.$search.removeAttr("aria-activedescendant"),o.$search.trigger("focus")}),r.on("enable",function(){o.$search.prop("disabled",!1),o._transferTabIndex()}),r.on("disable",function(){o.$search.prop("disabled",!0)}),r.on("focus",function(e){o.$search.trigger("focus")}),r.on("results:focus",function(e){o.$search.attr("aria-activedescendant",e.id)}),this.$selection.on("focusin",".select2-search--inline",function(e){o.trigger("focus",e)}),this.$selection.on("focusout",".select2-search--inline",function(e){o._handleBlur(e)}),this.$selection.on("keydown",".select2-search--inline",function(e){if(e.stopPropagation(),o.trigger("keypress",e),o._keyUpPrevented=e.isDefaultPrevented(),e.which===n.BACKSPACE&&""===o.$search.val()){var r=o.$searchContainer.prev(".select2-selection__choice");if(r.length>0){var i=t.GetData(r[0],"data");o.searchRemoveChoice(i),e.preventDefault()}}});var s=document.documentMode,a=s&&s<=11;this.$selection.on("input.searchcheck",".select2-search--inline",function(e){if(a)return void o.$selection.off("input.search input.searchcheck");o.$selection.off("keyup.search")}),this.$selection.on("keyup.search input.search",".select2-search--inline",function(e){if(a&&"input"===e.type)return void o.$selection.off("input.search input.searchcheck");var t=e.which;t!=n.SHIFT&&t!=n.CTRL&&t!=n.ALT&&t!=n.TAB&&o.handleSearch(e)})},r.prototype._transferTabIndex=function(e){this.$search.attr("tabindex",this.$selection.attr("tabindex")),this.$selection.attr("tabindex","-1")},r.prototype.createPlaceholder=function(e,t){this.$search.attr("placeholder",t.text)},r.prototype.update=function(e,t){var n=this.$search[0]==document.activeElement;if(this.$search.attr("placeholder",""),e.call(this,t),this.$selection.find(".select2-selection__rendered").append(this.$searchContainer),this.resizeSearch(),n){this.$element.find("[data-select2-tag]").length?this.$element.focus():this.$search.focus()}},r.prototype.handleSearch=function(){if(this.resizeSearch(),!this._keyUpPrevented){var e=this.$search.val();this.trigger("query",{term:e})}this._keyUpPrevented=!1},r.prototype.searchRemoveChoice=function(e,t){this.trigger("unselect",{data:t}),this.$search.val(t.text),this.handleSearch()},r.prototype.resizeSearch=function(){this.$search.css("width","25px");var e="";if(""!==this.$search.attr("placeholder"))e=this.$selection.find(".select2-selection__rendered").innerWidth();else{e=.75*(this.$search.val().length+1)+"em"}this.$search.css("width",e)},r}),t.define("select2/selection/eventRelay",["jquery"],function(e){function t(){}return t.prototype.bind=function(t,n,r){var i=this,o=["open","opening","close","closing","select","selecting","unselect","unselecting","clear","clearing"],s=["opening","closing","selecting","unselecting","clearing"];t.call(this,n,r),n.on("*",function(t,n){if(-1!==e.inArray(t,o)){n=n||{};var r=e.Event("select2:"+t,{params:n});i.$element.trigger(r),-1!==e.inArray(t,s)&&(n.prevented=r.isDefaultPrevented())}})},t}),t.define("select2/translation",["jquery","require"],function(e,t){function n(e){this.dict=e||{}}return n.prototype.all=function(){return this.dict},n.prototype.get=function(e){return this.dict[e]},n.prototype.extend=function(t){this.dict=e.extend({},t.all(),this.dict)},n._cache={},n.loadPath=function(e){if(!(e in n._cache)){var r=t(e);n._cache[e]=r}return new n(n._cache[e])},n}),t.define("select2/diacritics",[],function(){return{"":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"AA","":"AE","":"AE","":"AE","":"AO","":"AU","":"AV","":"AV","":"AY","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"DZ","":"DZ","":"Dz","":"Dz","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"F","":"F","":"F","":"F","":"F","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"J","":"J","":"J","":"J","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"LJ","":"Lj","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"NJ","":"Nj","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"OI","":"OO","":"OU","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"Q","":"Q","":"Q","":"Q","":"Q","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"TZ","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"VY","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"X","":"X","":"X","":"X","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"aa","":"ae","":"ae","":"ae","":"ao","":"au","":"av","":"av","":"ay","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"dz","":"dz","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"f","":"f","":"f","":"f","":"f","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"hv","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"j","":"j","":"j","":"j","":"j","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"lj","":"m","":"m","":"m","":"m","":"m","":"m","":"m","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"nj","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"oi","":"ou","":"oo","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"q","":"q","":"q","":"q","":"q","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"tz","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"vy","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"x","":"x","":"x","":"x","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""}}),t.define("select2/data/base",["../utils"],function(e){function t(e,n){t.__super__.constructor.call(this)}return e.Extend(t,e.Observable),t.prototype.current=function(e){throw new Error("The `current` method must be defined in child classes.")},t.prototype.query=function(e,t){throw new Error("The `query` method must be defined in child classes.")},t.prototype.bind=function(e,t){},t.prototype.destroy=function(){},t.prototype.generateResultId=function(t,n){var r=t.id+"-result-";return r+=e.generateChars(4),null!=n.id?r+="-"+n.id.toString():r+="-"+e.generateChars(4),r},t}),t.define("select2/data/select",["./base","../utils","jquery"],function(e,t,n){function r(e,t){this.$element=e,this.options=t,r.__super__.constructor.call(this)}return t.Extend(r,e),r.prototype.current=function(e){var t=[],r=this;this.$element.find(":selected").each(function(){var e=n(this),i=r.item(e);t.push(i)}),e(t)},r.prototype.select=function(e){var t=this;if(e.selected=!0,n(e.element).is("option"))return e.element.selected=!0,void this.$element.trigger("change");if(this.$element.prop("multiple"))this.current(function(r){var i=[];e=[e],e.push.apply(e,r);for(var o=0;o<e.length;o++){var s=e[o].id;-1===n.inArray(s,i)&&i.push(s)}t.$element.val(i),t.$element.trigger("change")});else{var r=e.id;this.$element.val(r),this.$element.trigger("change")}},r.prototype.unselect=function(e){var t=this;if(this.$element.prop("multiple")){if(e.selected=!1,n(e.element).is("option"))return e.element.selected=!1,void this.$element.trigger("change");this.current(function(r){for(var i=[],o=0;o<r.length;o++){var s=r[o].id;s!==e.id&&-1===n.inArray(s,i)&&i.push(s)}t.$element.val(i),t.$element.trigger("change")})}},r.prototype.bind=function(e,t){var n=this;this.container=e,e.on("select",function(e){n.select(e.data)}),e.on("unselect",function(e){n.unselect(e.data)})},r.prototype.destroy=function(){this.$element.find("*").each(function(){t.RemoveData(this)})},r.prototype.query=function(e,t){var r=[],i=this;this.$element.children().each(function(){var t=n(this);if(t.is("option")||t.is("optgroup")){var o=i.item(t),s=i.matches(e,o);null!==s&&r.push(s)}}),t({results:r})},r.prototype.addOptions=function(e){t.appendMany(this.$element,e)},r.prototype.option=function(e){var r;e.children?(r=document.createElement("optgroup"),r.label=e.text):(r=document.createElement("option"),void 0!==r.textContent?r.textContent=e.text:r.innerText=e.text),void 0!==e.id&&(r.value=e.id),e.disabled&&(r.disabled=!0),e.selected&&(r.selected=!0),e.title&&(r.title=e.title);var i=n(r),o=this._normalizeItem(e);return o.element=r,t.StoreData(r,"data",o),i},r.prototype.item=function(e){var r={};if(null!=(r=t.GetData(e[0],"data")))return r;if(e.is("option"))r={id:e.val(),text:e.text(),disabled:e.prop("disabled"),selected:e.prop("selected"),title:e.prop("title")};else if(e.is("optgroup")){r={text:e.prop("label"),children:[],title:e.prop("title")};for(var i=e.children("option"),o=[],s=0;s<i.length;s++){var a=n(i[s]),l=this.item(a);o.push(l)}r.children=o}return r=this._normalizeItem(r),r.element=e[0],t.StoreData(e[0],"data",r),r},r.prototype._normalizeItem=function(e){e!==Object(e)&&(e={id:e,text:e}),e=n.extend({},{text:""},e);var t={selected:!1,disabled:!1};return null!=e.id&&(e.id=e.id.toString()),null!=e.text&&(e.text=e.text.toString()),null==e._resultId&&e.id&&null!=this.container&&(e._resultId=this.generateResultId(this.container,e)),n.extend({},t,e)},r.prototype.matches=function(e,t){return this.options.get("matcher")(e,t)},r}),t.define("select2/data/array",["./select","../utils","jquery"],function(e,t,n){function r(e,t){var n=t.get("data")||[];r.__super__.constructor.call(this,e,t),
this.addOptions(this.convertToOptions(n))}return t.Extend(r,e),r.prototype.select=function(e){var t=this.$element.find("option").filter(function(t,n){return n.value==e.id.toString()});0===t.length&&(t=this.option(e),this.addOptions(t)),r.__super__.select.call(this,e)},r.prototype.convertToOptions=function(e){for(var r=this,i=this.$element.find("option"),o=i.map(function(){return r.item(n(this)).id}).get(),s=[],a=0;a<e.length;a++){var l=this._normalizeItem(e[a]);if(n.inArray(l.id,o)>=0){var u=i.filter(function(e){return function(){return n(this).val()==e.id}}(l)),c=this.item(u),p=n.extend(!0,{},l,c),d=this.option(p);u.replaceWith(d)}else{var h=this.option(l);if(l.children){var f=this.convertToOptions(l.children);t.appendMany(h,f)}s.push(h)}}return s},r}),t.define("select2/data/ajax",["./array","../utils","jquery"],function(e,t,n){function r(e,t){this.ajaxOptions=this._applyDefaults(t.get("ajax")),null!=this.ajaxOptions.processResults&&(this.processResults=this.ajaxOptions.processResults),r.__super__.constructor.call(this,e,t)}return t.Extend(r,e),r.prototype._applyDefaults=function(e){var t={data:function(e){return n.extend({},e,{q:e.term})},transport:function(e,t,r){var i=n.ajax(e);return i.then(t),i.fail(r),i}};return n.extend({},t,e,!0)},r.prototype.processResults=function(e){return e},r.prototype.query=function(e,t){function r(){var r=o.transport(o,function(r){var o=i.processResults(r,e);i.options.get("debug")&&window.console&&console.error&&(o&&o.results&&n.isArray(o.results)||console.error("Select2: The AJAX results did not return an array in the `results` key of the response.")),t(o)},function(){"status"in r&&(0===r.status||"0"===r.status)||i.trigger("results:message",{message:"errorLoading"})});i._request=r}var i=this;null!=this._request&&(n.isFunction(this._request.abort)&&this._request.abort(),this._request=null);var o=n.extend({type:"GET"},this.ajaxOptions);"function"==typeof o.url&&(o.url=o.url.call(this.$element,e)),"function"==typeof o.data&&(o.data=o.data.call(this.$element,e)),this.ajaxOptions.delay&&null!=e.term?(this._queryTimeout&&window.clearTimeout(this._queryTimeout),this._queryTimeout=window.setTimeout(r,this.ajaxOptions.delay)):r()},r}),t.define("select2/data/tags",["jquery"],function(e){function t(t,n,r){var i=r.get("tags"),o=r.get("createTag");void 0!==o&&(this.createTag=o);var s=r.get("insertTag");if(void 0!==s&&(this.insertTag=s),t.call(this,n,r),e.isArray(i))for(var a=0;a<i.length;a++){var l=i[a],u=this._normalizeItem(l),c=this.option(u);this.$element.append(c)}}return t.prototype.query=function(e,t,n){function r(e,o){for(var s=e.results,a=0;a<s.length;a++){var l=s[a],u=null!=l.children&&!r({results:l.children},!0);if((l.text||"").toUpperCase()===(t.term||"").toUpperCase()||u)return!o&&(e.data=s,void n(e))}if(o)return!0;var c=i.createTag(t);if(null!=c){var p=i.option(c);p.attr("data-select2-tag",!0),i.addOptions([p]),i.insertTag(s,c)}e.results=s,n(e)}var i=this;if(this._removeOldTags(),null==t.term||null!=t.page)return void e.call(this,t,n);e.call(this,t,r)},t.prototype.createTag=function(t,n){var r=e.trim(n.term);return""===r?null:{id:r,text:r}},t.prototype.insertTag=function(e,t,n){t.unshift(n)},t.prototype._removeOldTags=function(t){this._lastTag;this.$element.find("option[data-select2-tag]").each(function(){this.selected||e(this).remove()})},t}),t.define("select2/data/tokenizer",["jquery"],function(e){function t(e,t,n){var r=n.get("tokenizer");void 0!==r&&(this.tokenizer=r),e.call(this,t,n)}return t.prototype.bind=function(e,t,n){e.call(this,t,n),this.$search=t.dropdown.$search||t.selection.$search||n.find(".select2-search__field")},t.prototype.query=function(t,n,r){function i(t){var n=s._normalizeItem(t);if(!s.$element.find("option").filter(function(){return e(this).val()===n.id}).length){var r=s.option(n);r.attr("data-select2-tag",!0),s._removeOldTags(),s.addOptions([r])}o(n)}function o(e){s.trigger("select",{data:e})}var s=this;n.term=n.term||"";var a=this.tokenizer(n,this.options,i);a.term!==n.term&&(this.$search.length&&(this.$search.val(a.term),this.$search.focus()),n.term=a.term),t.call(this,n,r)},t.prototype.tokenizer=function(t,n,r,i){for(var o=r.get("tokenSeparators")||[],s=n.term,a=0,l=this.createTag||function(e){return{id:e.term,text:e.term}};a<s.length;){var u=s[a];if(-1!==e.inArray(u,o)){var c=s.substr(0,a),p=e.extend({},n,{term:c}),d=l(p);null!=d?(i(d),s=s.substr(a+1)||"",a=0):a++}else a++}return{term:s}},t}),t.define("select2/data/minimumInputLength",[],function(){function e(e,t,n){this.minimumInputLength=n.get("minimumInputLength"),e.call(this,t,n)}return e.prototype.query=function(e,t,n){if(t.term=t.term||"",t.term.length<this.minimumInputLength)return void this.trigger("results:message",{message:"inputTooShort",args:{minimum:this.minimumInputLength,input:t.term,params:t}});e.call(this,t,n)},e}),t.define("select2/data/maximumInputLength",[],function(){function e(e,t,n){this.maximumInputLength=n.get("maximumInputLength"),e.call(this,t,n)}return e.prototype.query=function(e,t,n){if(t.term=t.term||"",this.maximumInputLength>0&&t.term.length>this.maximumInputLength)return void this.trigger("results:message",{message:"inputTooLong",args:{maximum:this.maximumInputLength,input:t.term,params:t}});e.call(this,t,n)},e}),t.define("select2/data/maximumSelectionLength",[],function(){function e(e,t,n){this.maximumSelectionLength=n.get("maximumSelectionLength"),e.call(this,t,n)}return e.prototype.query=function(e,t,n){var r=this;this.current(function(i){var o=null!=i?i.length:0;if(r.maximumSelectionLength>0&&o>=r.maximumSelectionLength)return void r.trigger("results:message",{message:"maximumSelected",args:{maximum:r.maximumSelectionLength}});e.call(r,t,n)})},e}),t.define("select2/dropdown",["jquery","./utils"],function(e,t){function n(e,t){this.$element=e,this.options=t,n.__super__.constructor.call(this)}return t.Extend(n,t.Observable),n.prototype.render=function(){var t=e('<span class="select2-dropdown"><span class="select2-results"></span></span>');return t.attr("dir",this.options.get("dir")),this.$dropdown=t,t},n.prototype.bind=function(){},n.prototype.position=function(e,t){},n.prototype.destroy=function(){this.$dropdown.remove()},n}),t.define("select2/dropdown/search",["jquery","../utils"],function(e,t){function n(){}return n.prototype.render=function(t){var n=t.call(this),r=e('<span class="select2-search select2-search--dropdown"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" role="textbox" /></span>');return this.$searchContainer=r,this.$search=r.find("input"),n.prepend(r),n},n.prototype.bind=function(t,n,r){var i=this;t.call(this,n,r),this.$search.on("keydown",function(e){i.trigger("keypress",e),i._keyUpPrevented=e.isDefaultPrevented()}),this.$search.on("input",function(t){e(this).off("keyup")}),this.$search.on("keyup input",function(e){i.handleSearch(e)}),n.on("open",function(){i.$search.attr("tabindex",0),i.$search.focus(),window.setTimeout(function(){i.$search.focus()},0)}),n.on("close",function(){i.$search.attr("tabindex",-1),i.$search.val(""),i.$search.blur()}),n.on("focus",function(){n.isOpen()||i.$search.focus()}),n.on("results:all",function(e){if(null==e.query.term||""===e.query.term){i.showSearch(e)?i.$searchContainer.removeClass("select2-search--hide"):i.$searchContainer.addClass("select2-search--hide")}})},n.prototype.handleSearch=function(e){if(!this._keyUpPrevented){var t=this.$search.val();this.trigger("query",{term:t})}this._keyUpPrevented=!1},n.prototype.showSearch=function(e,t){return!0},n}),t.define("select2/dropdown/hidePlaceholder",[],function(){function e(e,t,n,r){this.placeholder=this.normalizePlaceholder(n.get("placeholder")),e.call(this,t,n,r)}return e.prototype.append=function(e,t){t.results=this.removePlaceholder(t.results),e.call(this,t)},e.prototype.normalizePlaceholder=function(e,t){return"string"==typeof t&&(t={id:"",text:t}),t},e.prototype.removePlaceholder=function(e,t){for(var n=t.slice(0),r=t.length-1;r>=0;r--){var i=t[r];this.placeholder.id===i.id&&n.splice(r,1)}return n},e}),t.define("select2/dropdown/infiniteScroll",["jquery"],function(e){function t(e,t,n,r){this.lastParams={},e.call(this,t,n,r),this.$loadingMore=this.createLoadingMore(),this.loading=!1}return t.prototype.append=function(e,t){this.$loadingMore.remove(),this.loading=!1,e.call(this,t),this.showLoadingMore(t)&&this.$results.append(this.$loadingMore)},t.prototype.bind=function(t,n,r){var i=this;t.call(this,n,r),n.on("query",function(e){i.lastParams=e,i.loading=!0}),n.on("query:append",function(e){i.lastParams=e,i.loading=!0}),this.$results.on("scroll",function(){var t=e.contains(document.documentElement,i.$loadingMore[0]);if(!i.loading&&t){i.$results.offset().top+i.$results.outerHeight(!1)+50>=i.$loadingMore.offset().top+i.$loadingMore.outerHeight(!1)&&i.loadMore()}})},t.prototype.loadMore=function(){this.loading=!0;var t=e.extend({},{page:1},this.lastParams);t.page++,this.trigger("query:append",t)},t.prototype.showLoadingMore=function(e,t){return t.pagination&&t.pagination.more},t.prototype.createLoadingMore=function(){var t=e('<li class="select2-results__option select2-results__option--load-more"role="treeitem" aria-disabled="true"></li>'),n=this.options.get("translations").get("loadingMore");return t.html(n(this.lastParams)),t},t}),t.define("select2/dropdown/attachBody",["jquery","../utils"],function(e,t){function n(t,n,r){this.$dropdownParent=r.get("dropdownParent")||e(document.body),t.call(this,n,r)}return n.prototype.bind=function(e,t,n){var r=this,i=!1;e.call(this,t,n),t.on("open",function(){r._showDropdown(),r._attachPositioningHandler(t),i||(i=!0,t.on("results:all",function(){r._positionDropdown(),r._resizeDropdown()}),t.on("results:append",function(){r._positionDropdown(),r._resizeDropdown()}))}),t.on("close",function(){r._hideDropdown(),r._detachPositioningHandler(t)}),this.$dropdownContainer.on("mousedown",function(e){e.stopPropagation()})},n.prototype.destroy=function(e){e.call(this),this.$dropdownContainer.remove()},n.prototype.position=function(e,t,n){t.attr("class",n.attr("class")),t.removeClass("select2"),t.addClass("select2-container--open"),t.css({position:"absolute",top:-999999}),this.$container=n},n.prototype.render=function(t){var n=e("<span></span>"),r=t.call(this);return n.append(r),this.$dropdownContainer=n,n},n.prototype._hideDropdown=function(e){this.$dropdownContainer.detach()},n.prototype._attachPositioningHandler=function(n,r){var i=this,o="scroll.select2."+r.id,s="resize.select2."+r.id,a="orientationchange.select2."+r.id,l=this.$container.parents().filter(t.hasScroll);l.each(function(){t.StoreData(this,"select2-scroll-position",{x:e(this).scrollLeft(),y:e(this).scrollTop()})}),l.on(o,function(n){var r=t.GetData(this,"select2-scroll-position");e(this).scrollTop(r.y)}),e(window).on(o+" "+s+" "+a,function(e){i._positionDropdown(),i._resizeDropdown()})},n.prototype._detachPositioningHandler=function(n,r){var i="scroll.select2."+r.id,o="resize.select2."+r.id,s="orientationchange.select2."+r.id;this.$container.parents().filter(t.hasScroll).off(i),e(window).off(i+" "+o+" "+s)},n.prototype._positionDropdown=function(){var t=e(window),n=this.$dropdown.hasClass("select2-dropdown--above"),r=this.$dropdown.hasClass("select2-dropdown--below"),i=null,o=this.$container.offset();o.bottom=o.top+this.$container.outerHeight(!1);var s={height:this.$container.outerHeight(!1)};s.top=o.top,s.bottom=o.top+s.height;var a={height:this.$dropdown.outerHeight(!1)},l={top:t.scrollTop(),bottom:t.scrollTop()+t.height()},u=l.top<o.top-a.height,c=l.bottom>o.bottom+a.height,p={left:o.left,top:s.bottom},d=this.$dropdownParent;"static"===d.css("position")&&(d=d.offsetParent());var h=d.offset();p.top-=h.top,p.left-=h.left,n||r||(i="below"),c||!u||n?!u&&c&&n&&(i="below"):i="above",("above"==i||n&&"below"!==i)&&(p.top=s.top-h.top-a.height),null!=i&&(this.$dropdown.removeClass("select2-dropdown--below select2-dropdown--above").addClass("select2-dropdown--"+i),this.$container.removeClass("select2-container--below select2-container--above").addClass("select2-container--"+i)),this.$dropdownContainer.css(p)},n.prototype._resizeDropdown=function(){var e={width:this.$container.outerWidth(!1)+"px"};this.options.get("dropdownAutoWidth")&&(e.minWidth=e.width,e.position="relative",e.width="auto"),this.$dropdown.css(e)},n.prototype._showDropdown=function(e){this.$dropdownContainer.appendTo(this.$dropdownParent),this._positionDropdown(),this._resizeDropdown()},n}),t.define("select2/dropdown/minimumResultsForSearch",[],function(){function e(t){for(var n=0,r=0;r<t.length;r++){var i=t[r];i.children?n+=e(i.children):n++}return n}function t(e,t,n,r){this.minimumResultsForSearch=n.get("minimumResultsForSearch"),this.minimumResultsForSearch<0&&(this.minimumResultsForSearch=1/0),e.call(this,t,n,r)}return t.prototype.showSearch=function(t,n){return!(e(n.data.results)<this.minimumResultsForSearch)&&t.call(this,n)},t}),t.define("select2/dropdown/selectOnClose",["../utils"],function(e){function t(){}return t.prototype.bind=function(e,t,n){var r=this;e.call(this,t,n),t.on("close",function(e){r._handleSelectOnClose(e)})},t.prototype._handleSelectOnClose=function(t,n){if(n&&null!=n.originalSelect2Event){var r=n.originalSelect2Event;if("select"===r._type||"unselect"===r._type)return}var i=this.getHighlightedResults();if(!(i.length<1)){var o=e.GetData(i[0],"data");null!=o.element&&o.element.selected||null==o.element&&o.selected||this.trigger("select",{data:o})}},t}),t.define("select2/dropdown/closeOnSelect",[],function(){function e(){}return e.prototype.bind=function(e,t,n){var r=this;e.call(this,t,n),t.on("select",function(e){r._selectTriggered(e)}),t.on("unselect",function(e){r._selectTriggered(e)})},e.prototype._selectTriggered=function(e,t){var n=t.originalEvent;n&&n.ctrlKey||this.trigger("close",{originalEvent:n,originalSelect2Event:t})},e}),t.define("select2/i18n/en",[],function(){return{errorLoading:function(){return"The results could not be loaded."},inputTooLong:function(e){var t=e.input.length-e.maximum,n="Please delete "+t+" character";return 1!=t&&(n+="s"),n},inputTooShort:function(e){return"Please enter "+(e.minimum-e.input.length)+" or more characters"},loadingMore:function(){return"Loading more results"},maximumSelected:function(e){var t="You can only select "+e.maximum+" item";return 1!=e.maximum&&(t+="s"),t},noResults:function(){return"No results found"},searching:function(){return"Searching"}}}),t.define("select2/defaults",["jquery","require","./results","./selection/single","./selection/multiple","./selection/placeholder","./selection/allowClear","./selection/search","./selection/eventRelay","./utils","./translation","./diacritics","./data/select","./data/array","./data/ajax","./data/tags","./data/tokenizer","./data/minimumInputLength","./data/maximumInputLength","./data/maximumSelectionLength","./dropdown","./dropdown/search","./dropdown/hidePlaceholder","./dropdown/infiniteScroll","./dropdown/attachBody","./dropdown/minimumResultsForSearch","./dropdown/selectOnClose","./dropdown/closeOnSelect","./i18n/en"],function(e,t,n,r,i,o,s,a,l,u,c,p,d,h,f,g,m,v,_,y,b,w,x,$,S,A,O,D,C){function E(){this.reset()}return E.prototype.apply=function(p){if(p=e.extend(!0,{},this.defaults,p),null==p.dataAdapter){if(null!=p.ajax?p.dataAdapter=f:null!=p.data?p.dataAdapter=h:p.dataAdapter=d,p.minimumInputLength>0&&(p.dataAdapter=u.Decorate(p.dataAdapter,v)),p.maximumInputLength>0&&(p.dataAdapter=u.Decorate(p.dataAdapter,_)),p.maximumSelectionLength>0&&(p.dataAdapter=u.Decorate(p.dataAdapter,y)),p.tags&&(p.dataAdapter=u.Decorate(p.dataAdapter,g)),null==p.tokenSeparators&&null==p.tokenizer||(p.dataAdapter=u.Decorate(p.dataAdapter,m)),null!=p.query){var C=t(p.amdBase+"compat/query");p.dataAdapter=u.Decorate(p.dataAdapter,C)}if(null!=p.initSelection){var E=t(p.amdBase+"compat/initSelection");p.dataAdapter=u.Decorate(p.dataAdapter,E)}}if(null==p.resultsAdapter&&(p.resultsAdapter=n,null!=p.ajax&&(p.resultsAdapter=u.Decorate(p.resultsAdapter,$)),null!=p.placeholder&&(p.resultsAdapter=u.Decorate(p.resultsAdapter,x)),p.selectOnClose&&(p.resultsAdapter=u.Decorate(p.resultsAdapter,O))),null==p.dropdownAdapter){if(p.multiple)p.dropdownAdapter=b;else{var T=u.Decorate(b,w);p.dropdownAdapter=T}if(0!==p.minimumResultsForSearch&&(p.dropdownAdapter=u.Decorate(p.dropdownAdapter,A)),p.closeOnSelect&&(p.dropdownAdapter=u.Decorate(p.dropdownAdapter,D)),null!=p.dropdownCssClass||null!=p.dropdownCss||null!=p.adaptDropdownCssClass){var q=t(p.amdBase+"compat/dropdownCss");p.dropdownAdapter=u.Decorate(p.dropdownAdapter,q)}p.dropdownAdapter=u.Decorate(p.dropdownAdapter,S)}if(null==p.selectionAdapter){if(p.multiple?p.selectionAdapter=i:p.selectionAdapter=r,null!=p.placeholder&&(p.selectionAdapter=u.Decorate(p.selectionAdapter,o)),p.allowClear&&(p.selectionAdapter=u.Decorate(p.selectionAdapter,s)),p.multiple&&(p.selectionAdapter=u.Decorate(p.selectionAdapter,a)),null!=p.containerCssClass||null!=p.containerCss||null!=p.adaptContainerCssClass){var k=t(p.amdBase+"compat/containerCss");p.selectionAdapter=u.Decorate(p.selectionAdapter,k)}p.selectionAdapter=u.Decorate(p.selectionAdapter,l)}if("string"==typeof p.language)if(p.language.indexOf("-")>0){var R=p.language.split("-"),j=R[0];p.language=[p.language,j]}else p.language=[p.language];if(e.isArray(p.language)){var L=new c;p.language.push("en");for(var M=p.language,I=0;I<M.length;I++){var F=M[I],P={};try{P=c.loadPath(F)}catch(e){try{F=this.defaults.amdLanguageBase+F,P=c.loadPath(F)}catch(e){p.debug&&window.console&&console.warn&&console.warn('Select2: The language file for "'+F+'" could not be automatically loaded. A fallback will be used instead.');continue}}L.extend(P)}p.translations=L}else{var N=c.loadPath(this.defaults.amdLanguageBase+"en"),U=new c(p.language);U.extend(N),p.translations=U}return p},E.prototype.reset=function(){function t(e){function t(e){return p[e]||e}return e.replace(/[^\u0000-\u007E]/g,t)}function n(r,i){if(""===e.trim(r.term))return i;if(i.children&&i.children.length>0){for(var o=e.extend(!0,{},i),s=i.children.length-1;s>=0;s--){null==n(r,i.children[s])&&o.children.splice(s,1)}return o.children.length>0?o:n(r,o)}var a=t(i.text).toUpperCase(),l=t(r.term).toUpperCase();return a.indexOf(l)>-1?i:null}this.defaults={amdBase:"./",amdLanguageBase:"./i18n/",closeOnSelect:!0,debug:!1,dropdownAutoWidth:!1,escapeMarkup:u.escapeMarkup,language:C,matcher:n,minimumInputLength:0,maximumInputLength:0,maximumSelectionLength:0,minimumResultsForSearch:0,selectOnClose:!1,sorter:function(e){return e},templateResult:function(e){return e.text},templateSelection:function(e){return e.text},theme:"default",width:"resolve"}},E.prototype.set=function(t,n){var r=e.camelCase(t),i={};i[r]=n;var o=u._convertData(i);e.extend(!0,this.defaults,o)},new E}),t.define("select2/options",["require","jquery","./defaults","./utils"],function(e,t,n,r){function i(t,i){if(this.options=t,null!=i&&this.fromElement(i),this.options=n.apply(this.options),i&&i.is("input")){var o=e(this.get("amdBase")+"compat/inputData");this.options.dataAdapter=r.Decorate(this.options.dataAdapter,o)}}return i.prototype.fromElement=function(e){var n=["select2"];null==this.options.multiple&&(this.options.multiple=e.prop("multiple")),null==this.options.disabled&&(this.options.disabled=e.prop("disabled")),null==this.options.language&&(e.prop("lang")?this.options.language=e.prop("lang").toLowerCase():e.closest("[lang]").prop("lang")&&(this.options.language=e.closest("[lang]").prop("lang"))),null==this.options.dir&&(e.prop("dir")?this.options.dir=e.prop("dir"):e.closest("[dir]").prop("dir")?this.options.dir=e.closest("[dir]").prop("dir"):this.options.dir="ltr"),e.prop("disabled",this.options.disabled),e.prop("multiple",this.options.multiple),r.GetData(e[0],"select2Tags")&&(this.options.debug&&window.console&&console.warn&&console.warn('Select2: The `data-select2-tags` attribute has been changed to use the `data-data` and `data-tags="true"` attributes and will be removed in future versions of Select2.'),r.StoreData(e[0],"data",r.GetData(e[0],"select2Tags")),r.StoreData(e[0],"tags",!0)),r.GetData(e[0],"ajaxUrl")&&(this.options.debug&&window.console&&console.warn&&console.warn("Select2: The `data-ajax-url` attribute has been changed to `data-ajax--url` and support for the old attribute will be removed in future versions of Select2."),e.attr("ajax--url",r.GetData(e[0],"ajaxUrl")),r.StoreData(e[0],"ajax-Url",r.GetData(e[0],"ajaxUrl")));var i={};i=t.fn.jquery&&"1."==t.fn.jquery.substr(0,2)&&e[0].dataset?t.extend(!0,{},e[0].dataset,r.GetData(e[0])):r.GetData(e[0]);var o=t.extend(!0,{},i);o=r._convertData(o);for(var s in o)t.inArray(s,n)>-1||(t.isPlainObject(this.options[s])?t.extend(this.options[s],o[s]):this.options[s]=o[s]);return this},i.prototype.get=function(e){return this.options[e]},i.prototype.set=function(e,t){this.options[e]=t},i}),t.define("select2/core",["jquery","./options","./utils","./keys"],function(e,t,n,r){var i=function(e,r){null!=n.GetData(e[0],"select2")&&n.GetData(e[0],"select2").destroy(),this.$element=e,this.id=this._generateId(e),r=r||{},this.options=new t(r,e),i.__super__.constructor.call(this);var o=e.attr("tabindex")||0;n.StoreData(e[0],"old-tabindex",o),e.attr("tabindex","-1");var s=this.options.get("dataAdapter");this.dataAdapter=new s(e,this.options);var a=this.render();this._placeContainer(a);var l=this.options.get("selectionAdapter");this.selection=new l(e,this.options),this.$selection=this.selection.render(),this.selection.position(this.$selection,a);var u=this.options.get("dropdownAdapter");this.dropdown=new u(e,this.options),this.$dropdown=this.dropdown.render(),this.dropdown.position(this.$dropdown,a);var c=this.options.get("resultsAdapter");this.results=new c(e,this.options,this.dataAdapter),this.$results=this.results.render(),this.results.position(this.$results,this.$dropdown);var p=this;this._bindAdapters(),this._registerDomEvents(),this._registerDataEvents(),this._registerSelectionEvents(),this._registerDropdownEvents(),this._registerResultsEvents(),this._registerEvents(),this.dataAdapter.current(function(e){p.trigger("selection:update",{data:e})}),e.addClass("select2-hidden-accessible"),e.attr("aria-hidden","true"),this._syncAttributes(),n.StoreData(e[0],"select2",this),e.data("select2",this)};return n.Extend(i,n.Observable),i.prototype._generateId=function(e){var t="";return t=null!=e.attr("id")?e.attr("id"):null!=e.attr("name")?e.attr("name")+"-"+n.generateChars(2):n.generateChars(4),t=t.replace(/(:|\.|\[|\]|,)/g,""),t="select2-"+t},i.prototype._placeContainer=function(e){e.insertAfter(this.$element);var t=this._resolveWidth(this.$element,this.options.get("width"));null!=t&&e.css("width",t)},i.prototype._resolveWidth=function(e,t){var n=/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i;if("resolve"==t){var r=this._resolveWidth(e,"style");return null!=r?r:this._resolveWidth(e,"element")}if("element"==t){var i=e.outerWidth(!1);return i<=0?"auto":i+"px"}if("style"==t){var o=e.attr("style");if("string"!=typeof o)return null;for(var s=o.split(";"),a=0,l=s.length;a<l;a+=1){var u=s[a].replace(/\s/g,""),c=u.match(n);if(null!==c&&c.length>=1)return c[1]}return null}return t},i.prototype._bindAdapters=function(){this.dataAdapter.bind(this,this.$container),this.selection.bind(this,this.$container),this.dropdown.bind(this,this.$container),this.results.bind(this,this.$container)},i.prototype._registerDomEvents=function(){var t=this;this.$element.on("change.select2",function(){t.dataAdapter.current(function(e){t.trigger("selection:update",{data:e})})}),this.$element.on("focus.select2",function(e){t.trigger("focus",e)}),this._syncA=n.bind(this._syncAttributes,this),this._syncS=n.bind(this._syncSubtree,this),this.$element[0].attachEvent&&this.$element[0].attachEvent("onpropertychange",this._syncA);var r=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;null!=r?(this._observer=new r(function(n){e.each(n,t._syncA),e.each(n,t._syncS)}),this._observer.observe(this.$element[0],{attributes:!0,childList:!0,subtree:!1})):this.$element[0].addEventListener&&(this.$element[0].addEventListener("DOMAttrModified",t._syncA,!1),this.$element[0].addEventListener("DOMNodeInserted",t._syncS,!1),this.$element[0].addEventListener("DOMNodeRemoved",t._syncS,!1))},i.prototype._registerDataEvents=function(){var e=this;this.dataAdapter.on("*",function(t,n){e.trigger(t,n)})},i.prototype._registerSelectionEvents=function(){var t=this,n=["toggle","focus"];this.selection.on("toggle",function(){t.toggleDropdown()}),this.selection.on("focus",function(e){t.focus(e)}),this.selection.on("*",function(r,i){-1===e.inArray(r,n)&&t.trigger(r,i)})},i.prototype._registerDropdownEvents=function(){var e=this;this.dropdown.on("*",function(t,n){e.trigger(t,n)})},i.prototype._registerResultsEvents=function(){var e=this;this.results.on("*",function(t,n){e.trigger(t,n)})},i.prototype._registerEvents=function(){var e=this;this.on("open",function(){e.$container.addClass("select2-container--open")}),this.on("close",function(){e.$container.removeClass("select2-container--open")}),this.on("enable",function(){e.$container.removeClass("select2-container--disabled")}),this.on("disable",function(){e.$container.addClass("select2-container--disabled")}),this.on("blur",function(){e.$container.removeClass("select2-container--focus")}),this.on("query",function(t){e.isOpen()||e.trigger("open",{}),this.dataAdapter.query(t,function(n){e.trigger("results:all",{data:n,query:t})})}),this.on("query:append",function(t){this.dataAdapter.query(t,function(n){e.trigger("results:append",{data:n,query:t})})}),this.on("keypress",function(t){var n=t.which;e.isOpen()?n===r.ESC||n===r.TAB||n===r.UP&&t.altKey?(e.close(),t.preventDefault()):n===r.ENTER?(e.trigger("results:select",{}),t.preventDefault()):n===r.SPACE&&t.ctrlKey?(e.trigger("results:toggle",{}),t.preventDefault()):n===r.UP?(e.trigger("results:previous",{}),t.preventDefault()):n===r.DOWN&&(e.trigger("results:next",{}),t.preventDefault()):(n===r.ENTER||n===r.SPACE||n===r.DOWN&&t.altKey)&&(e.open(),t.preventDefault())})},i.prototype._syncAttributes=function(){this.options.set("disabled",this.$element.prop("disabled")),this.options.get("disabled")?(this.isOpen()&&this.close(),this.trigger("disable",{})):this.trigger("enable",{})},i.prototype._syncSubtree=function(e,t){var n=!1,r=this;if(!e||!e.target||"OPTION"===e.target.nodeName||"OPTGROUP"===e.target.nodeName){if(t)if(t.addedNodes&&t.addedNodes.length>0)for(var i=0;i<t.addedNodes.length;i++){var o=t.addedNodes[i];o.selected&&(n=!0)}else t.removedNodes&&t.removedNodes.length>0&&(n=!0);else n=!0;n&&this.dataAdapter.current(function(e){r.trigger("selection:update",{data:e})})}},i.prototype.trigger=function(e,t){var n=i.__super__.trigger,r={open:"opening",close:"closing",select:"selecting",unselect:"unselecting",clear:"clearing"};if(void 0===t&&(t={}),e in r){var o=r[e],s={prevented:!1,name:e,args:t};if(n.call(this,o,s),s.prevented)return void(t.prevented=!0)}n.call(this,e,t)},i.prototype.toggleDropdown=function(){this.options.get("disabled")||(this.isOpen()?this.close():this.open())},i.prototype.open=function(){this.isOpen()||this.trigger("query",{})},i.prototype.close=function(){this.isOpen()&&this.trigger("close",{})},i.prototype.isOpen=function(){return this.$container.hasClass("select2-container--open")},i.prototype.hasFocus=function(){return this.$container.hasClass("select2-container--focus")},i.prototype.focus=function(e){this.hasFocus()||(this.$container.addClass("select2-container--focus"),this.trigger("focus",{}))},i.prototype.enable=function(e){this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("enable")` method has been deprecated and will be removed in later Select2 versions. Use $element.prop("disabled") instead.'),null!=e&&0!==e.length||(e=[!0]);var t=!e[0];this.$element.prop("disabled",t)},i.prototype.data=function(){this.options.get("debug")&&arguments.length>0&&window.console&&console.warn&&console.warn('Select2: Data can no longer be set using `select2("data")`. You should consider setting the value instead using `$element.val()`.');var e=[];return this.dataAdapter.current(function(t){e=t}),e},i.prototype.val=function(t){if(this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("val")` method has been deprecated and will be removed in later Select2 versions. Use $element.val() instead.'),null==t||0===t.length)return this.$element.val();var n=t[0];e.isArray(n)&&(n=e.map(n,function(e){return e.toString()})),this.$element.val(n).trigger("change")},i.prototype.destroy=function(){this.$container.remove(),this.$element[0].detachEvent&&this.$element[0].detachEvent("onpropertychange",this._syncA),null!=this._observer?(this._observer.disconnect(),this._observer=null):this.$element[0].removeEventListener&&(this.$element[0].removeEventListener("DOMAttrModified",this._syncA,!1),this.$element[0].removeEventListener("DOMNodeInserted",this._syncS,!1),this.$element[0].removeEventListener("DOMNodeRemoved",this._syncS,!1)),this._syncA=null,this._syncS=null,this.$element.off(".select2"),this.$element.attr("tabindex",n.GetData(this.$element[0],"old-tabindex")),this.$element.removeClass("select2-hidden-accessible"),this.$element.attr("aria-hidden","false"),n.RemoveData(this.$element[0]),this.$element.removeData("select2"),this.dataAdapter.destroy(),this.selection.destroy(),this.dropdown.destroy(),this.results.destroy(),this.dataAdapter=null,this.selection=null,this.dropdown=null,this.results=null},i.prototype.render=function(){var t=e('<span class="select2 select2-container"><span class="selection"></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>');return t.attr("dir",this.options.get("dir")),this.$container=t,this.$container.addClass("select2-container--"+this.options.get("theme")),n.StoreData(t[0],"element",this.$element),t},i}),t.define("select2/compat/utils",["jquery"],function(e){function t(t,n,r){var i,o,s=[];i=e.trim(t.attr("class")),i&&(i=""+i,e(i.split(/\s+/)).each(function(){0===this.indexOf("select2-")&&s.push(this)})),i=e.trim(n.attr("class")),i&&(i=""+i,e(i.split(/\s+/)).each(function(){0!==this.indexOf("select2-")&&null!=(o=r(this))&&s.push(o)})),t.attr("class",s.join(" "))}return{syncCssClasses:t}}),t.define("select2/compat/containerCss",["jquery","./utils"],function(e,t){function n(e){return null}function r(){}return r.prototype.render=function(r){var i=r.call(this),o=this.options.get("containerCssClass")||"";e.isFunction(o)&&(o=o(this.$element));var s=this.options.get("adaptContainerCssClass");if(s=s||n,-1!==o.indexOf(":all:")){o=o.replace(":all:","");var a=s;s=function(e){var t=a(e);return null!=t?t+" "+e:e}}var l=this.options.get("containerCss")||{};return e.isFunction(l)&&(l=l(this.$element)),t.syncCssClasses(i,this.$element,s),i.css(l),i.addClass(o),i},r}),t.define("select2/compat/dropdownCss",["jquery","./utils"],function(e,t){function n(e){return null}function r(){}return r.prototype.render=function(r){var i=r.call(this),o=this.options.get("dropdownCssClass")||"";e.isFunction(o)&&(o=o(this.$element));var s=this.options.get("adaptDropdownCssClass");if(s=s||n,-1!==o.indexOf(":all:")){o=o.replace(":all:","");var a=s;s=function(e){var t=a(e);return null!=t?t+" "+e:e}}var l=this.options.get("dropdownCss")||{};return e.isFunction(l)&&(l=l(this.$element)),t.syncCssClasses(i,this.$element,s),i.css(l),i.addClass(o),i},r}),t.define("select2/compat/initSelection",["jquery"],function(e){function t(e,t,n){n.get("debug")&&window.console&&console.warn&&console.warn("Select2: The `initSelection` option has been deprecated in favor of a custom data adapter that overrides the `current` method. This method is now called multiple times instead of a single time when the instance is initialized. Support will be removed for the `initSelection` option in future versions of Select2"),
this.initSelection=n.get("initSelection"),this._isInitialized=!1,e.call(this,t,n)}return t.prototype.current=function(t,n){var r=this;if(this._isInitialized)return void t.call(this,n);this.initSelection.call(null,this.$element,function(t){r._isInitialized=!0,e.isArray(t)||(t=[t]),n(t)})},t}),t.define("select2/compat/inputData",["jquery","../utils"],function(e,t){function n(e,t,n){this._currentData=[],this._valueSeparator=n.get("valueSeparator")||",","hidden"===t.prop("type")&&n.get("debug")&&console&&console.warn&&console.warn("Select2: Using a hidden input with Select2 is no longer supported and may stop working in the future. It is recommended to use a `<select>` element instead."),e.call(this,t,n)}return n.prototype.current=function(t,n){function r(t,n){var i=[];return t.selected||-1!==e.inArray(t.id,n)?(t.selected=!0,i.push(t)):t.selected=!1,t.children&&i.push.apply(i,r(t.children,n)),i}for(var i=[],o=0;o<this._currentData.length;o++){var s=this._currentData[o];i.push.apply(i,r(s,this.$element.val().split(this._valueSeparator)))}n(i)},n.prototype.select=function(t,n){if(this.options.get("multiple")){var r=this.$element.val();r+=this._valueSeparator+n.id,this.$element.val(r),this.$element.trigger("change")}else this.current(function(t){e.map(t,function(e){e.selected=!1})}),this.$element.val(n.id),this.$element.trigger("change")},n.prototype.unselect=function(e,t){var n=this;t.selected=!1,this.current(function(e){for(var r=[],i=0;i<e.length;i++){var o=e[i];t.id!=o.id&&r.push(o.id)}n.$element.val(r.join(n._valueSeparator)),n.$element.trigger("change")})},n.prototype.query=function(e,t,n){for(var r=[],i=0;i<this._currentData.length;i++){var o=this._currentData[i],s=this.matches(t,o);null!==s&&r.push(s)}n({results:r})},n.prototype.addOptions=function(n,r){var i=e.map(r,function(e){return t.GetData(e[0],"data")});this._currentData.push.apply(this._currentData,i)},n}),t.define("select2/compat/matcher",["jquery"],function(e){function t(t){function n(n,r){var i=e.extend(!0,{},r);if(null==n.term||""===e.trim(n.term))return i;if(r.children){for(var o=r.children.length-1;o>=0;o--){var s=r.children[o];t(n.term,s.text,s)||i.children.splice(o,1)}if(i.children.length>0)return i}return t(n.term,r.text,r)?i:null}return n}return t}),t.define("select2/compat/query",[],function(){function e(e,t,n){n.get("debug")&&window.console&&console.warn&&console.warn("Select2: The `query` option has been deprecated in favor of a custom data adapter that overrides the `query` method. Support will be removed for the `query` option in future versions of Select2."),e.call(this,t,n)}return e.prototype.query=function(e,t,n){t.callback=n,this.options.get("query").call(null,t)},e}),t.define("select2/dropdown/attachContainer",[],function(){function e(e,t,n){e.call(this,t,n)}return e.prototype.position=function(e,t,n){n.find(".dropdown-wrapper").append(t),t.addClass("select2-dropdown--below"),n.addClass("select2-container--below")},e}),t.define("select2/dropdown/stopPropagation",[],function(){function e(){}return e.prototype.bind=function(e,t,n){e.call(this,t,n);var r=["blur","change","click","dblclick","focus","focusin","focusout","input","keydown","keyup","keypress","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseup","search","touchend","touchstart"];this.$dropdown.on(r.join(" "),function(e){e.stopPropagation()})},e}),t.define("select2/selection/stopPropagation",[],function(){function e(){}return e.prototype.bind=function(e,t,n){e.call(this,t,n);var r=["blur","change","click","dblclick","focus","focusin","focusout","input","keydown","keyup","keypress","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseup","search","touchend","touchstart"];this.$selection.on(r.join(" "),function(e){e.stopPropagation()})},e}),function(n){"function"==typeof t.define&&t.define.amd?t.define("jquery-mousewheel",["jquery"],n):"object"==typeof exports?module.exports=n:n(e)}(function(e){function t(t){var s=t||window.event,a=l.call(arguments,1),u=0,p=0,d=0,h=0,f=0,g=0;if(t=e.event.fix(s),t.type="mousewheel","detail"in s&&(d=-1*s.detail),"wheelDelta"in s&&(d=s.wheelDelta),"wheelDeltaY"in s&&(d=s.wheelDeltaY),"wheelDeltaX"in s&&(p=-1*s.wheelDeltaX),"axis"in s&&s.axis===s.HORIZONTAL_AXIS&&(p=-1*d,d=0),u=0===d?p:d,"deltaY"in s&&(d=-1*s.deltaY,u=d),"deltaX"in s&&(p=s.deltaX,0===d&&(u=-1*p)),0!==d||0!==p){if(1===s.deltaMode){var m=e.data(this,"mousewheel-line-height");u*=m,d*=m,p*=m}else if(2===s.deltaMode){var v=e.data(this,"mousewheel-page-height");u*=v,d*=v,p*=v}if(h=Math.max(Math.abs(d),Math.abs(p)),(!o||h<o)&&(o=h,r(s,h)&&(o/=40)),r(s,h)&&(u/=40,p/=40,d/=40),u=Math[u>=1?"floor":"ceil"](u/o),p=Math[p>=1?"floor":"ceil"](p/o),d=Math[d>=1?"floor":"ceil"](d/o),c.settings.normalizeOffset&&this.getBoundingClientRect){var _=this.getBoundingClientRect();f=t.clientX-_.left,g=t.clientY-_.top}return t.deltaX=p,t.deltaY=d,t.deltaFactor=o,t.offsetX=f,t.offsetY=g,t.deltaMode=0,a.unshift(t,u,p,d),i&&clearTimeout(i),i=setTimeout(n,200),(e.event.dispatch||e.event.handle).apply(this,a)}}function n(){o=null}function r(e,t){return c.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}var i,o,s=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],a="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],l=Array.prototype.slice;if(e.event.fixHooks)for(var u=s.length;u;)e.event.fixHooks[s[--u]]=e.event.mouseHooks;var c=e.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var n=a.length;n;)this.addEventListener(a[--n],t,!1);else this.onmousewheel=t;e.data(this,"mousewheel-line-height",c.getLineHeight(this)),e.data(this,"mousewheel-page-height",c.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var n=a.length;n;)this.removeEventListener(a[--n],t,!1);else this.onmousewheel=null;e.removeData(this,"mousewheel-line-height"),e.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var n=e(t),r=n["offsetParent"in e.fn?"offsetParent":"parent"]();return r.length||(r=e("body")),parseInt(r.css("fontSize"),10)||parseInt(n.css("fontSize"),10)||16},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}),t.define("jquery.select2",["jquery","jquery-mousewheel","./select2/core","./select2/defaults","./select2/utils"],function(e,t,n,r,i){if(null==e.fn.select2){var o=["open","close","destroy"];e.fn.select2=function(t){if("object"==typeof(t=t||{}))return this.each(function(){var r=e.extend(!0,{},t);new n(e(this),r)}),this;if("string"==typeof t){var r,s=Array.prototype.slice.call(arguments,1);return this.each(function(){var e=i.GetData(this,"select2");null==e&&window.console&&console.error&&console.error("The select2('"+t+"') method was called on an element that is not using Select2."),r=e[t].apply(e,s)}),e.inArray(t,o)>-1?this:r}throw new Error("Invalid arguments for Select2: "+t)}}return null==e.fn.select2.defaults&&(e.fn.select2.defaults=r),n}),{define:t.define,require:t.require}}(),n=t.require("jquery.select2");return e.fn.select2.amd=t,n});
