!function(e,t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&module.exports?module.exports=t(require("jquery")):t(e.jQuery)}(this,function(e){"use strict";e.extendext=function(){var t,r,n,i,o,a,s=arguments[0]||{},l=1,u=arguments.length,p=!1,c="default";for("boolean"==typeof s&&(p=s,s=arguments[l++]||{}),"string"==typeof s&&(c=s.toLowerCase(),"concat"!==c&&"replace"!==c&&"extend"!==c&&(c="default"),s=arguments[l++]||{}),"object"==typeof s||e.isFunction(s)||(s={}),l===u&&(s=this,l--);l<u;l++)if(null!==(t=arguments[l]))if(e.isArray(t)&&"default"!==c)switch(a=s&&e.isArray(s)?s:[],c){case"concat":s=a.concat(e.extend(p,[],t));break;case"replace":s=e.extend(p,[],t);break;case"extend":t.forEach(function(t,r){if("object"==typeof t){var n=e.isArray(t)?[]:{};a[r]=e.extendext(p,c,a[r]||n,t)}else-1===a.indexOf(t)&&a.push(t)}),s=a}else for(r in t)n=s[r],i=t[r],s!==i&&(p&&i&&(e.isPlainObject(i)||(o=e.isArray(i)))?(o?(o=!1,a=n&&e.isArray(n)?n:[]):a=n&&e.isPlainObject(n)?n:{},s[r]=e.extendext(p,c,a,i)):void 0!==i&&(s[r]=i));return s}}),function(e,t){"function"==typeof define&&define.amd?define(["jquery","dot/doT","jquery-extendext"],t):"object"==typeof module&&module.exports?module.exports=t(require("jquery"),require("dot/doT"),require("jquery-extendext")):t(e.jQuery,e.doT)}(this,function(e,t){"use strict";function r(){this.root=null,this.$=e(this)}function n(e,t,r){var n,i,a=o.selectors;n=t.closest(a.rule_container),n.length&&(i="moveAfter"),i||(n=t.closest(a.group_header),n.length&&(n=t.closest(a.group_container),i="moveAtBegin")),i||(n=t.closest(a.group_container),n.length&&(i="moveAtEnd")),i&&(e[i](r.getModel(n)),r&&e instanceof u&&r.setRuleInputValue(e,e.value))}function i(e){var t=e.match(/(question_mark|numbered|named)(?:\((.)\))?/);return t||(t=[null,"question_mark",void 0]),t}var o=function(n,i){n[0].queryBuilder=this,this.$el=n,this.settings=e.extendext(!0,"replace",{},o.DEFAULTS,i),this.model=new r,this.status={id:null,generated_id:!1,group_id:0,rule_id:0,has_optgroup:!1,has_operator_optgroup:!1},this.filters=this.settings.filters,this.icons=this.settings.icons,this.operators=this.settings.operators,this.templates=this.settings.templates,this.plugins=this.settings.plugins,this.lang=null,void 0===o.regional.en&&a.error("Config",'"i18n/en.js" not loaded.'),this.lang=e.extendext(!0,"replace",{},o.regional.en,o.regional[this.settings.lang_code],this.settings.lang),!1===this.settings.allow_groups?this.settings.allow_groups=0:!0===this.settings.allow_groups&&(this.settings.allow_groups=-1),Object.keys(this.templates).forEach(function(e){this.templates[e]||(this.templates[e]=o.templates[e]),"string"==typeof this.templates[e]&&(this.templates[e]=t.template(this.templates[e]))},this),this.$el.attr("id")||(this.$el.attr("id","qb_"+Math.floor(99999*Math.random())),this.status.generated_id=!0),this.status.id=this.$el.attr("id"),this.$el.addClass("query-builder form-inline"),this.filters=this.checkFilters(this.filters),this.operators=this.checkOperators(this.operators),this.bindEvents(),this.initPlugins()};e.extend(o.prototype,{trigger:function(t){var r=new e.Event(this._tojQueryEvent(t),{builder:this});return this.$el.triggerHandler(r,Array.prototype.slice.call(arguments,1)),r},change:function(t,r){var n=new e.Event(this._tojQueryEvent(t,!0),{builder:this,value:r});return this.$el.triggerHandler(n,Array.prototype.slice.call(arguments,2)),n.value},on:function(e,t){return this.$el.on(this._tojQueryEvent(e),t),this},off:function(e,t){return this.$el.off(this._tojQueryEvent(e),t),this},once:function(e,t){return this.$el.one(this._tojQueryEvent(e),t),this},_tojQueryEvent:function(e,t){return e.split(" ").map(function(e){return e+".queryBuilder"+(t?".filter":"")}).join(" ")}}),o.types={string:"string",integer:"number",double:"number",date:"datetime",time:"datetime",datetime:"datetime",boolean:"boolean"},o.inputs=["text","number","textarea","radio","checkbox","select"],o.modifiable_options=["display_errors","allow_groups","allow_empty","default_condition","default_filter"],o.selectors={group_container:".rules-group-container",rule_container:".rule-container",filter_container:".rule-filter-container",operator_container:".rule-operator-container",value_container:".rule-value-container",error_container:".error-container",condition_container:".rules-group-header .group-conditions",rule_header:".rule-header",group_header:".rules-group-header",group_actions:".group-actions",rule_actions:".rule-actions",rules_list:".rules-group-body>.rules-list",group_condition:".rules-group-header [name$=_cond]",rule_filter:".rule-filter-container [name$=_filter]",rule_operator:".rule-operator-container [name$=_operator]",rule_value:".rule-value-container [name*=_value_]",add_rule:"[data-add=rule]",delete_rule:"[data-delete=rule]",add_group:"[data-add=group]",delete_group:"[data-delete=group]"},o.templates={},o.regional={},o.OPERATORS={equal:{type:"equal",nb_inputs:1,multiple:!1,apply_to:["string","number","datetime","boolean"]},not_equal:{type:"not_equal",nb_inputs:1,multiple:!1,apply_to:["string","number","datetime","boolean"]},in:{type:"in",nb_inputs:1,multiple:!0,apply_to:["string","number","datetime"]},not_in:{type:"not_in",nb_inputs:1,multiple:!0,apply_to:["string","number","datetime"]},less:{type:"less",nb_inputs:1,multiple:!1,apply_to:["number","datetime"]},less_or_equal:{type:"less_or_equal",nb_inputs:1,multiple:!1,apply_to:["number","datetime"]},greater:{type:"greater",nb_inputs:1,multiple:!1,apply_to:["number","datetime"]},greater_or_equal:{type:"greater_or_equal",nb_inputs:1,multiple:!1,apply_to:["number","datetime"]},between:{type:"between",nb_inputs:2,multiple:!1,apply_to:["number","datetime"]},not_between:{type:"not_between",nb_inputs:2,multiple:!1,apply_to:["number","datetime"]},begins_with:{type:"begins_with",nb_inputs:1,multiple:!1,apply_to:["string"]},not_begins_with:{type:"not_begins_with",nb_inputs:1,multiple:!1,apply_to:["string"]},contains:{type:"contains",nb_inputs:1,multiple:!1,apply_to:["string"]},not_contains:{type:"not_contains",nb_inputs:1,multiple:!1,apply_to:["string"]},ends_with:{type:"ends_with",nb_inputs:1,multiple:!1,apply_to:["string"]},not_ends_with:{type:"not_ends_with",nb_inputs:1,multiple:!1,apply_to:["string"]},is_empty:{type:"is_empty",nb_inputs:0,multiple:!1,apply_to:["string"]},is_not_empty:{type:"is_not_empty",nb_inputs:0,multiple:!1,apply_to:["string"]},is_null:{type:"is_null",nb_inputs:0,multiple:!1,apply_to:["string","number","datetime","boolean"]},is_not_null:{type:"is_not_null",nb_inputs:0,multiple:!1,apply_to:["string","number","datetime","boolean"]}},o.DEFAULTS={filters:[],plugins:[],sort_filters:!1,display_errors:!0,allow_groups:-1,allow_empty:!1,conditions:["AND","OR"],default_condition:"AND",inputs_separator:" , ",select_placeholder:"------",display_empty_filter:!0,default_filter:null,optgroups:{},default_rule_flags:{filter_readonly:!1,operator_readonly:!1,value_readonly:!1,no_delete:!1},default_group_flags:{condition_readonly:!1,no_add_rule:!1,no_add_group:!1,no_delete:!1},templates:{group:null,rule:null,filterSelect:null,operatorSelect:null,ruleValueSelect:null},lang_code:"en",lang:{},operators:["equal","not_equal","in","not_in","less","less_or_equal","greater","greater_or_equal","between","not_between","begins_with","not_begins_with","contains","not_contains","ends_with","not_ends_with","is_empty","is_not_empty","is_null","is_not_null"],icons:{add_group:"glyphicon glyphicon-plus-sign",add_rule:"glyphicon glyphicon-plus",remove_group:"glyphicon glyphicon-remove",remove_rule:"glyphicon glyphicon-remove",error:"glyphicon glyphicon-warning-sign"}},o.plugins={},o.defaults=function(t){if("object"!=typeof t)return"string"==typeof t?"object"==typeof o.DEFAULTS[t]?e.extend(!0,{},o.DEFAULTS[t]):o.DEFAULTS[t]:e.extend(!0,{},o.DEFAULTS);e.extendext(!0,"replace",o.DEFAULTS,t)},o.define=function(e,t,r){o.plugins[e]={fct:t,def:r||{}}},o.extend=function(t){e.extend(o.prototype,t)},o.prototype.initPlugins=function(){if(this.plugins){if(e.isArray(this.plugins)){var t={};this.plugins.forEach(function(e){t[e]=null}),this.plugins=t}Object.keys(this.plugins).forEach(function(t){t in o.plugins?(this.plugins[t]=e.extend(!0,{},o.plugins[t].def,this.plugins[t]||{}),o.plugins[t].fct.call(this,this.plugins[t])):a.error("Config",'Unable to find plugin "{0}"',t)},this)}},o.prototype.getPluginOptions=function(e,t){var r;if(this.plugins&&this.plugins[e]?r=this.plugins[e]:o.plugins[e]&&(r=o.plugins[e].def),r)return t?r[t]:r;a.error("Config",'Unable to find plugin "{0}"',e)},o.prototype.init=function(e){this.trigger("afterInit"),e?(this.setRules(e),delete this.settings.rules):this.setRoot(!0)},o.prototype.checkFilters=function(e){var t=[];if(e&&0!==e.length||a.error("Config","Missing filters list"),e.forEach(function(e,r){switch(e.id||a.error("Config","Missing filter {0} id",r),-1!=t.indexOf(e.id)&&a.error("Config",'Filter "{0}" already defined',e.id),t.push(e.id),e.type?o.types[e.type]||a.error("Config",'Invalid type "{0}"',e.type):e.type="string",e.input?"function"!=typeof e.input&&-1==o.inputs.indexOf(e.input)&&a.error("Config",'Invalid input "{0}"',e.input):e.input="number"===o.types[e.type]?"number":"text",e.operators&&e.operators.forEach(function(e){"string"!=typeof e&&a.error("Config","Filter operators must be global operators types (string)")}),e.field||(e.field=e.id),e.label||(e.label=e.field),e.optgroup?(this.status.has_optgroup=!0,this.settings.optgroups[e.optgroup]||(this.settings.optgroups[e.optgroup]=e.optgroup)):e.optgroup=null,e.input){case"radio":case"checkbox":(!e.values||e.values.length<1)&&a.error("Config",'Missing filter "{0}" values',e.id);break;case"select":var n=[];e.has_optgroup=!1,a.iterateOptions(e.values,function(t,r,i){n.push({value:t,label:r,optgroup:i||null}),i&&(e.has_optgroup=!0,this.settings.optgroups[i]||(this.settings.optgroups[i]=i))}.bind(this)),e.has_optgroup?e.values=a.groupSort(n,"optgroup"):e.values=n,e.placeholder&&(void 0===e.placeholder_value&&(e.placeholder_value=-1),e.values.forEach(function(t){t.value==e.placeholder_value&&a.error("Config",'Placeholder of filter "{0}" overlaps with one of its values',e.id)}))}},this),this.settings.sort_filters)if("function"==typeof this.settings.sort_filters)e.sort(this.settings.sort_filters);else{var r=this;e.sort(function(e,t){return r.translate(e.label).localeCompare(r.translate(t.label))})}return this.status.has_optgroup&&(e=a.groupSort(e,"optgroup")),e},o.prototype.checkOperators=function(t){var r=[];return t.forEach(function(n,i){"string"==typeof n?(o.OPERATORS[n]||a.error("Config",'Unknown operator "{0}"',n),t[i]=n=e.extendext(!0,"replace",{},o.OPERATORS[n])):(n.type||a.error("Config",'Missing "type" for operator {0}',i),o.OPERATORS[n.type]&&(t[i]=n=e.extendext(!0,"replace",{},o.OPERATORS[n.type],n)),void 0!==n.nb_inputs&&void 0!==n.apply_to||a.error("Config",'Missing "nb_inputs" and/or "apply_to" for operator "{0}"',n.type)),-1!=r.indexOf(n.type)&&a.error("Config",'Operator "{0}" already defined',n.type),r.push(n.type),n.optgroup?(this.status.has_operator_optgroup=!0,this.settings.optgroups[n.optgroup]||(this.settings.optgroups[n.optgroup]=n.optgroup)):n.optgroup=null},this),this.status.has_operator_optgroup&&(t=a.groupSort(t,"optgroup")),t},o.prototype.bindEvents=function(){var t=this,r=o.selectors;this.$el.on("change.queryBuilder",r.group_condition,function(){if(e(this).is(":checked")){var n=e(this).closest(r.group_container);t.getModel(n).condition=e(this).val()}}),this.$el.on("change.queryBuilder",r.rule_filter,function(){var n=e(this).closest(r.rule_container);t.getModel(n).filter=t.getFilterById(e(this).val())}),this.$el.on("change.queryBuilder",r.rule_operator,function(){var n=e(this).closest(r.rule_container);t.getModel(n).operator=t.getOperatorByType(e(this).val())}),this.$el.on("click.queryBuilder",r.add_rule,function(){var n=e(this).closest(r.group_container);t.addRule(t.getModel(n))}),this.$el.on("click.queryBuilder",r.delete_rule,function(){var n=e(this).closest(r.rule_container);t.deleteRule(t.getModel(n))}),0!==this.settings.allow_groups&&(this.$el.on("click.queryBuilder",r.add_group,function(){var n=e(this).closest(r.group_container);t.addGroup(t.getModel(n))}),this.$el.on("click.queryBuilder",r.delete_group,function(){var n=e(this).closest(r.group_container);t.deleteGroup(t.getModel(n))})),this.model.on({drop:function(e,r){r.$el.remove(),t.refreshGroupsConditions()},add:function(e,r,n,i){0===i?n.$el.prependTo(r.$el.find(">"+o.selectors.rules_list)):n.$el.insertAfter(r.rules[i-1].$el),t.refreshGroupsConditions()},move:function(e,r,n,i){r.$el.detach(),0===i?r.$el.prependTo(n.$el.find(">"+o.selectors.rules_list)):r.$el.insertAfter(n.rules[i-1].$el),t.refreshGroupsConditions()},update:function(e,r,n,i,o){if(r instanceof u)switch(n){case"error":t.updateError(r);break;case"flags":t.applyRuleFlags(r);break;case"filter":t.updateRuleFilter(r,o);break;case"operator":t.updateRuleOperator(r,o);break;case"value":t.updateRuleValue(r,o)}else switch(n){case"error":t.updateError(r);break;case"flags":t.applyGroupFlags(r);break;case"condition":t.updateGroupCondition(r,o)}}})},o.prototype.setRoot=function(t,r,n){t=void 0===t||!0===t;var i=this.nextGroupId(),o=e(this.getGroupTemplate(i,1));return this.$el.append(o),this.model.root=new l(null,o),this.model.root.model=this.model,this.model.root.data=r,this.model.root.flags=e.extend({},this.settings.default_group_flags,n),this.model.root.condition=this.settings.default_condition,this.trigger("afterAddGroup",this.model.root),t&&this.addRule(this.model.root),this.model.root},o.prototype.addGroup=function(t,r,n,i){r=void 0===r||!0===r;var o=t.level+1;if(this.trigger("beforeAddGroup",t,r,o).isDefaultPrevented())return null;var a=this.nextGroupId(),s=e(this.getGroupTemplate(a,o)),l=t.addGroup(s);return l.data=n,l.flags=e.extend({},this.settings.default_group_flags,i),l.condition=this.settings.default_condition,this.trigger("afterAddGroup",l),this.trigger("rulesChanged"),r&&this.addRule(l),l},o.prototype.deleteGroup=function(e){if(e.isRoot())return!1;if(this.trigger("beforeDeleteGroup",e).isDefaultPrevented())return!1;var t=!0;return e.each("reverse",function(e){t&=this.deleteRule(e)},function(e){t&=this.deleteGroup(e)},this),t&&(e.drop(),this.trigger("afterDeleteGroup"),this.trigger("rulesChanged")),t},o.prototype.updateGroupCondition=function(t,r){t.$el.find(">"+o.selectors.group_condition).each(function(){var r=e(this);r.prop("checked",r.val()===t.condition),r.parent().toggleClass("active",r.val()===t.condition)}),this.trigger("afterUpdateGroupCondition",t,r),this.trigger("rulesChanged")},o.prototype.refreshGroupsConditions=function(){!function e(t){(!t.flags||t.flags&&!t.flags.condition_readonly)&&t.$el.find(">"+o.selectors.group_condition).prop("disabled",t.rules.length<=1).parent().toggleClass("disabled",t.rules.length<=1),t.each(null,function(t){e(t)},this)}(this.model.root)},o.prototype.addRule=function(t,r,n){if(this.trigger("beforeAddRule",t).isDefaultPrevented())return null;var i=this.nextRuleId(),o=e(this.getRuleTemplate(i)),a=t.addRule(o);return a.data=r,a.flags=e.extend({},this.settings.default_rule_flags,n),this.trigger("afterAddRule",a),this.trigger("rulesChanged"),this.createRuleFilters(a),!this.settings.default_filter&&this.settings.display_empty_filter||(a.filter=this.change("getDefaultFilter",this.getFilterById(this.settings.default_filter||this.filters[0].id),a)),a},o.prototype.deleteRule=function(e){return!e.flags.no_delete&&(!this.trigger("beforeDeleteRule",e).isDefaultPrevented()&&(e.drop(),this.trigger("afterDeleteRule"),this.trigger("rulesChanged"),!0))},o.prototype.createRuleFilters=function(t){var r=this.change("getRuleFilters",this.filters,t),n=e(this.getRuleFilterSelect(t,r));t.$el.find(o.selectors.filter_container).html(n),this.trigger("afterCreateRuleFilters",t),this.applyRuleFlags(t)},o.prototype.createRuleOperators=function(t){var r=t.$el.find(o.selectors.operator_container).empty();if(t.filter){var n=this.getOperators(t.filter),i=e(this.getRuleOperatorSelect(t,n));r.html(i),t.filter.default_operator?t.__.operator=this.getOperatorByType(t.filter.default_operator):t.__.operator=n[0],t.$el.find(o.selectors.rule_operator).val(t.operator.type),this.trigger("afterCreateRuleOperators",t,n),this.applyRuleFlags(t)}},o.prototype.createRuleInput=function(t){var r=t.$el.find(o.selectors.value_container).empty();if(t.__.value=void 0,t.filter&&t.operator&&0!==t.operator.nb_inputs){for(var n=this,i=e(),a=t.filter,s=0;s<t.operator.nb_inputs;s++){var l=e(this.getRuleInput(t,s));s>0&&r.append(this.settings.inputs_separator),r.append(l),i=i.add(l)}r.css("display",""),i.on("change "+(a.input_event||""),function(){t._updating_input||(t._updating_value=!0,t.value=n.getRuleInputValue(t),t._updating_value=!1)}),a.plugin&&i[a.plugin](a.plugin_config||{}),this.trigger("afterCreateRuleInput",t),void 0!==a.default_value?t.value=a.default_value:(t._updating_value=!0,t.value=n.getRuleInputValue(t),t._updating_value=!1),this.applyRuleFlags(t)}},o.prototype.updateRuleFilter=function(e,t){this.createRuleOperators(e),this.createRuleInput(e),e.$el.find(o.selectors.rule_filter).val(e.filter?e.filter.id:"-1"),t&&e.filter&&t.id!==e.filter.id&&(e.data=void 0),this.trigger("afterUpdateRuleFilter",e,t),this.trigger("rulesChanged")},o.prototype.updateRuleOperator=function(e,t){var r=e.$el.find(o.selectors.value_container);e.operator&&0!==e.operator.nb_inputs?(r.css("display",""),!r.is(":empty")&&t&&e.operator.nb_inputs===t.nb_inputs&&e.operator.optgroup===t.optgroup||this.createRuleInput(e)):(r.hide(),e.__.value=void 0),e.operator&&(e.$el.find(o.selectors.rule_operator).val(e.operator.type),e.__.value=this.getRuleInputValue(e)),this.trigger("afterUpdateRuleOperator",e,t),this.trigger("rulesChanged")},o.prototype.updateRuleValue=function(e,t){e._updating_value||this.setRuleInputValue(e,e.value),this.trigger("afterUpdateRuleValue",e,t),this.trigger("rulesChanged")},o.prototype.applyRuleFlags=function(e){var t=e.flags,r=o.selectors;e.$el.find(r.rule_filter).prop("disabled",t.filter_readonly),e.$el.find(r.rule_operator).prop("disabled",t.operator_readonly),e.$el.find(r.rule_value).prop("disabled",t.value_readonly),t.no_delete&&e.$el.find(r.delete_rule).remove(),this.trigger("afterApplyRuleFlags",e)},o.prototype.applyGroupFlags=function(e){var t=e.flags,r=o.selectors;e.$el.find(">"+r.group_condition).prop("disabled",t.condition_readonly).parent().toggleClass("readonly",t.condition_readonly),t.no_add_rule&&e.$el.find(r.add_rule).remove(),t.no_add_group&&e.$el.find(r.add_group).remove(),t.no_delete&&e.$el.find(r.delete_group).remove(),this.trigger("afterApplyGroupFlags",e)},o.prototype.clearErrors=function(e){(e=e||this.model.root)&&(e.error=null,e instanceof l&&e.each(function(e){e.error=null},function(e){this.clearErrors(e)},this))},o.prototype.updateError=function(e){if(this.settings.display_errors)if(null===e.error)e.$el.removeClass("has-error");else{var t=this.translate("errors",e.error[0]);t=a.fmt(t,e.error.slice(1)),t=this.change("displayError",t,e.error,e),e.$el.addClass("has-error").find(o.selectors.error_container).eq(0).attr("title",t)}},o.prototype.triggerValidationError=function(t,r,n){e.isArray(r)||(r=[r]),this.trigger("validationError",t,r,n).isDefaultPrevented()||(t.error=r)},o.prototype.destroy=function(){this.trigger("beforeDestroy"),this.status.generated_id&&this.$el.removeAttr("id"),this.clear(),this.model=null,this.$el.off(".queryBuilder").removeClass("query-builder").removeData("queryBuilder"),delete this.$el[0].queryBuilder},o.prototype.reset=function(){this.trigger("beforeReset").isDefaultPrevented()||(this.status.group_id=1,this.status.rule_id=0,this.model.root.empty(),this.model.root.data=void 0,this.model.root.flags=e.extend({},this.settings.default_group_flags),this.model.root.condition=this.settings.default_condition,this.addRule(this.model.root),this.trigger("afterReset"),this.trigger("rulesChanged"))},o.prototype.clear=function(){this.trigger("beforeClear").isDefaultPrevented()||(this.status.group_id=0,this.status.rule_id=0,this.model.root&&(this.model.root.drop(),this.model.root=null),this.trigger("afterClear"),this.trigger("rulesChanged"))},o.prototype.setOptions=function(t){e.each(t,function(e,t){-1!==o.modifiable_options.indexOf(e)&&(this.settings[e]=t)}.bind(this))},o.prototype.getModel=function(t){return t?t instanceof s?t:e(t).data("queryBuilderModel"):this.model.root},o.prototype.validate=function(t){t=e.extend({skip_empty:!1},t),this.clearErrors();var r=this,n=function e(n){var i=0,o=0;return n.each(function(e){if(e.filter||!t.skip_empty){if(!e.filter)return r.triggerValidationError(e,"no_filter",null),void o++;if(!e.operator)return r.triggerValidationError(e,"no_operator",null),void o++;if(0!==e.operator.nb_inputs){var n=r.validateValue(e,e.value);if(!0!==n)return r.triggerValidationError(e,n,e.value),void o++}i++}},function(t){var r=e(t);!0===r?i++:!1===r&&o++}),!(o>0)&&(0===i&&!n.isRoot()&&t.skip_empty?null:!!(0!==i||r.settings.allow_empty&&n.isRoot())||(r.triggerValidationError(n,"empty_group",null),!1))}(this.model.root);return this.change("validate",n)},o.prototype.getRules=function(t){t=e.extend({get_flags:!1,allow_invalid:!1,skip_empty:!1},t);var r=this.validate(t);if(!r&&!t.allow_invalid)return null;var n=this,i=function r(i){var o={condition:i.condition,rules:[]};if(i.data&&(o.data=e.extendext(!0,"replace",{},i.data)),t.get_flags){var a=n.getGroupFlags(i.flags,"all"===t.get_flags);e.isEmptyObject(a)||(o.flags=a)}return i.each(function(r){if(r.filter||!t.skip_empty){var i=null;r.operator&&0===r.operator.nb_inputs||(i=r.value);var a={id:r.filter?r.filter.id:null,field:r.filter?r.filter.field:null,type:r.filter?r.filter.type:null,input:r.filter?r.filter.input:null,operator:r.operator?r.operator.type:null,value:i};if((r.filter&&r.filter.data||r.data)&&(a.data=e.extendext(!0,"replace",{},r.filter.data,r.data)),t.get_flags){var s=n.getRuleFlags(r.flags,"all"===t.get_flags);e.isEmptyObject(s)||(a.flags=s)}o.rules.push(n.change("ruleToJson",a,r))}},function(e){var n=r(e);0===n.rules.length&&t.skip_empty||o.rules.push(n)},this),n.change("groupToJson",o,i)}(this.model.root);return i.valid=r,this.change("getRules",i)},o.prototype.setRules=function(t,r){r=e.extend({allow_invalid:!1},r),e.isArray(t)&&(t={condition:this.settings.default_condition,rules:t}),t&&t.rules&&(0!==t.rules.length||this.settings.allow_empty)||a.error("RulesParse","Incorrect data object passed"),this.clear(),this.setRoot(!1,t.data,this.parseGroupFlags(t)),t=this.change("setRules",t,r);var n=this;!function e(t,i){null!==i&&(void 0===t.condition?t.condition=n.settings.default_condition:-1==n.settings.conditions.indexOf(t.condition)&&(a.error(!r.allow_invalid,"UndefinedCondition",'Invalid condition "{0}"',t.condition),t.condition=n.settings.default_condition),i.condition=t.condition,t.rules.forEach(function(t){var o;if(void 0!==t.rules)if(-1!==n.settings.allow_groups&&n.settings.allow_groups<i.level)a.error(!r.allow_invalid,"RulesParse","No more than {0} groups are allowed",n.settings.allow_groups),n.reset();else{if(null===(o=n.addGroup(i,!1,t.data,n.parseGroupFlags(t))))return;e(t,o)}else{if(t.empty||(void 0===t.id&&(a.error(!r.allow_invalid,"RulesParse","Missing rule field id"),t.empty=!0),void 0===t.operator&&(t.operator="equal")),null===(o=n.addRule(i,t.data,n.parseRuleFlags(t))))return;t.empty||(o.filter=n.getFilterById(t.id,!r.allow_invalid)),o.filter&&(o.operator=n.getOperatorByType(t.operator,!r.allow_invalid),o.operator||(o.operator=n.getOperators(o.filter)[0])),o.operator&&0!==o.operator.nb_inputs&&(void 0!==t.value?o.value=t.value:void 0!==o.filter.default_value&&(o.value=o.filter.default_value)),n.change("jsonToRule",o,t)!=o&&a.error("RulesParse","Plugin tried to change rule reference")}}),n.change("jsonToGroup",i,t)!=i&&a.error("RulesParse","Plugin tried to change group reference"))}(t,this.model.root),this.trigger("afterSetRules")},o.prototype.validateValue=function(e,t){var r=e.filter.validation||{},n=!0;return n=r.callback?r.callback.call(this,t,e):this._validateValue(e,t),this.change("validateValue",n,t,e)},o.prototype._validateValue=function(t,r){var n,i,s=t.filter,l=t.operator,u=s.validation||{},p=!0;1===t.operator.nb_inputs&&(r=[r]);for(var c=0;c<l.nb_inputs;c++){if(!l.multiple&&e.isArray(r[c])&&r[c].length>1){p=["operator_not_multiple",l.type,this.translate("operators",l.type)];break}switch(s.input){case"radio":if(void 0===r[c]||0===r[c].length){u.allow_empty_value||(p=["radio_empty"]);break}break;case"checkbox":if(void 0===r[c]||0===r[c].length){u.allow_empty_value||(p=["checkbox_empty"]);break}break;case"select":if(void 0===r[c]||0===r[c].length||s.placeholder&&r[c]==s.placeholder_value){u.allow_empty_value||(p=["select_empty"]);break}break;default:i=e.isArray(r[c])?r[c]:[r[c]];for(var d=0;d<i.length;d++){switch(o.types[s.type]){case"string":if(void 0===i[d]||0===i[d].length){u.allow_empty_value||(p=["string_empty"]);break}if(void 0!==u.min&&i[d].length<parseInt(u.min)){p=[this.getValidationMessage(u,"min","string_exceed_min_length"),u.min];break}if(void 0!==u.max&&i[d].length>parseInt(u.max)){p=[this.getValidationMessage(u,"max","string_exceed_max_length"),u.max];break}if(u.format&&("string"==typeof u.format&&(u.format=new RegExp(u.format)),!u.format.test(i[d]))){p=[this.getValidationMessage(u,"format","string_invalid_format"),u.format];break}break;case"number":if(void 0===i[d]||0===i[d].length){u.allow_empty_value||(p=["number_nan"]);break}if(isNaN(i[d])){p=["number_nan"];break}if("integer"==s.type){if(parseInt(i[d])!=i[d]){p=["number_not_integer"];break}}else if(parseFloat(i[d])!=i[d]){p=["number_not_double"];break}if(void 0!==u.min&&i[d]<parseFloat(u.min)){p=[this.getValidationMessage(u,"min","number_exceed_min"),u.min];break}if(void 0!==u.max&&i[d]>parseFloat(u.max)){p=[this.getValidationMessage(u,"max","number_exceed_max"),u.max];break}if(void 0!==u.step&&"any"!==u.step){var f=(i[d]/u.step).toPrecision(14);if(parseInt(f)!=f){p=[this.getValidationMessage(u,"step","number_wrong_step"),u.step];break}}break;case"datetime":if(void 0===i[d]||0===i[d].length){u.allow_empty_value||(p=["datetime_empty"]);break}if(u.format){"moment"in window||a.error("MissingLibrary","MomentJS is required for Date/Time validation. Get it here http://momentjs.com");var g=moment(i[d],u.format);if(!g.isValid()){p=[this.getValidationMessage(u,"format","datetime_invalid"),u.format];break}if(u.min&&g<moment(u.min,u.format)){p=[this.getValidationMessage(u,"min","datetime_exceed_min"),u.min];break}if(u.max&&g>moment(u.max,u.format)){p=[this.getValidationMessage(u,"max","datetime_exceed_max"),u.max];break}}break;case"boolean":if(void 0===i[d]||0===i[d].length){u.allow_empty_value||(p=["boolean_not_valid"]);break}if("true"!==(n=(""+i[d]).trim().toLowerCase())&&"false"!==n&&"1"!==n&&"0"!==n&&1!==i[d]&&0!==i[d]){p=["boolean_not_valid"];break}}if(!0!==p)break}}if(!0!==p)break}if(("between"===t.operator.type||"not_between"===t.operator.type)&&2===r.length)switch(o.types[s.type]){case"number":r[0]>r[1]&&(p=["number_between_invalid",r[0],r[1]]);break;case"datetime":u.format&&("moment"in window||a.error("MissingLibrary","MomentJS is required for Date/Time validation. Get it here http://momentjs.com"),moment(r[0],u.format).isAfter(moment(r[1],u.format))&&(p=["datetime_between_invalid",r[0],r[1]]))}return p},o.prototype.nextGroupId=function(){return this.status.id+"_group_"+this.status.group_id++},o.prototype.nextRuleId=function(){return this.status.id+"_rule_"+this.status.rule_id++},o.prototype.getOperators=function(e){"string"==typeof e&&(e=this.getFilterById(e));for(var t=[],r=0,n=this.operators.length;r<n;r++){if(e.operators){if(-1==e.operators.indexOf(this.operators[r].type))continue}else if(-1==this.operators[r].apply_to.indexOf(o.types[e.type]))continue;t.push(this.operators[r])}return e.operators&&t.sort(function(t,r){return e.operators.indexOf(t.type)-e.operators.indexOf(r.type)}),this.change("getOperators",t,e)},o.prototype.getFilterById=function(e,t){if("-1"==e)return null;for(var r=0,n=this.filters.length;r<n;r++)if(this.filters[r].id==e)return this.filters[r];return a.error(!1!==t,"UndefinedFilter",'Undefined filter "{0}"',e),null},o.prototype.getOperatorByType=function(e,t){if("-1"==e)return null;for(var r=0,n=this.operators.length;r<n;r++)if(this.operators[r].type==e)return this.operators[r];return a.error(!1!==t,"UndefinedOperator",'Undefined operator "{0}"',e),null},o.prototype.getRuleInputValue=function(t){var r=t.filter,n=t.operator,i=[];if(r.valueGetter)i=r.valueGetter.call(this,t);else{for(var s=t.$el.find(o.selectors.value_container),l=0;l<n.nb_inputs;l++){var u,p=a.escapeElementId(t.id+"_value_"+l);switch(r.input){case"radio":i.push(s.find("[name="+p+"]:checked").val());break;case"checkbox":u=[],s.find("[name="+p+"]:checked").each(function(){u.push(e(this).val())}),i.push(u);break;case"select":r.multiple?(u=[],s.find("[name="+p+"] option:selected").each(function(){u.push(e(this).val())}),i.push(u)):i.push(s.find("[name="+p+"] option:selected").val());break;default:i.push(s.find("[name="+p+"]").val())}}i=i.map(function(t){return n.multiple&&r.value_separator&&"string"==typeof t&&(t=t.split(r.value_separator)),e.isArray(t)?t.map(function(e){return a.changeType(e,r.type)}):a.changeType(t,r.type)}),1===n.nb_inputs&&(i=i[0]),r.valueParser&&(i=r.valueParser.call(this,t,i))}return this.change("getRuleValue",i,t)},o.prototype.setRuleInputValue=function(t,r){var n=t.filter,i=t.operator;if(n&&i){if(t._updating_input=!0,n.valueSetter)n.valueSetter.call(this,t,r);else{var s=t.$el.find(o.selectors.value_container);1==i.nb_inputs&&(r=[r]);for(var l=0;l<i.nb_inputs;l++){var u=a.escapeElementId(t.id+"_value_"+l);switch(n.input){case"radio":s.find("[name="+u+'][value="'+r[l]+'"]').prop("checked",!0).trigger("change");break;case"checkbox":e.isArray(r[l])||(r[l]=[r[l]]),r[l].forEach(function(e){s.find("[name="+u+'][value="'+e+'"]').prop("checked",!0).trigger("change")});break;default:i.multiple&&n.value_separator&&e.isArray(r[l])&&(r[l]=r[l].join(n.value_separator)),s.find("[name="+u+"]").val(r[l]).trigger("change")}}}t._updating_input=!1}},o.prototype.parseRuleFlags=function(t){var r=e.extend({},this.settings.default_rule_flags);return t.readonly&&e.extend(r,{filter_readonly:!0,operator_readonly:!0,value_readonly:!0,no_delete:!0}),t.flags&&e.extend(r,t.flags),this.change("parseRuleFlags",r,t)},o.prototype.getRuleFlags=function(t,r){if(r)return e.extend({},t);var n={};return e.each(this.settings.default_rule_flags,function(e,r){t[e]!==r&&(n[e]=t[e])}),n},o.prototype.parseGroupFlags=function(t){var r=e.extend({},this.settings.default_group_flags);return t.readonly&&e.extend(r,{condition_readonly:!0,no_add_rule:!0,no_add_group:!0,no_delete:!0}),t.flags&&e.extend(r,t.flags),this.change("parseGroupFlags",r,t)},o.prototype.getGroupFlags=function(t,r){if(r)return e.extend({},t);var n={};return e.each(this.settings.default_group_flags,function(e,r){t[e]!==r&&(n[e]=t[e])}),n},o.prototype.translate=function(e,t){t||(t=e,e=void 0);var r;return r="object"==typeof t?t[this.settings.lang_code]||t.en:(e?this.lang[e]:this.lang)[t]||t,this.change("translate",r,t,e)},o.prototype.getValidationMessage=function(e,t,r){return e.messages&&e.messages[t]||r},
o.templates.group='<div id="{{= it.group_id }}" class="rules-group-container">   <div class="rules-group-header">     <div class="btn-group pull-right group-actions">       <button type="button" class="btn btn-xs btn-success" data-add="rule">         <i class="{{= it.icons.add_rule }}"></i> {{= it.translate("add_rule") }}       </button>       {{? it.settings.allow_groups===-1 || it.settings.allow_groups>=it.level }}         <button type="button" class="btn btn-xs btn-success" data-add="group">           <i class="{{= it.icons.add_group }}"></i> {{= it.translate("add_group") }}         </button>       {{?}}       {{? it.level>1 }}         <button type="button" class="btn btn-xs btn-danger" data-delete="group">           <i class="{{= it.icons.remove_group }}"></i> {{= it.translate("delete_group") }}         </button>       {{?}}     </div>     <div class="btn-group group-conditions">       {{~ it.conditions: condition }}         <label class="btn btn-xs btn-primary">           <input type="radio" name="{{= it.group_id }}_cond" value="{{= condition }}"> {{= it.translate("conditions", condition) }}         </label>       {{~}}     </div>     {{? it.settings.display_errors }}       <div class="error-container"><i class="{{= it.icons.error }}"></i></div>     {{?}}   </div>   <div class=rules-group-body>     <div class=rules-list></div>   </div> </div>',o.templates.rule='<div id="{{= it.rule_id }}" class="rule-container">   <div class="rule-header">     <div class="btn-group pull-right rule-actions">       <button type="button" class="btn btn-xs btn-danger" data-delete="rule">         <i class="{{= it.icons.remove_rule }}"></i> {{= it.translate("delete_rule") }}       </button>     </div>   </div>   {{? it.settings.display_errors }}     <div class="error-container"><i class="{{= it.icons.error }}"></i></div>   {{?}}   <div class="rule-filter-container"></div>   <div class="rule-operator-container"></div>   <div class="rule-value-container"></div> </div>',o.templates.filterSelect='{{ var optgroup = null; }} <select class="form-control" name="{{= it.rule.id }}_filter">   {{? it.settings.display_empty_filter }}     <option value="-1">{{= it.settings.select_placeholder }}</option>   {{?}}   {{~ it.filters: filter }}     {{? optgroup !== filter.optgroup }}       {{? optgroup !== null }}</optgroup>{{?}}       {{? (optgroup = filter.optgroup) !== null }}         <optgroup label="{{= it.translate(it.settings.optgroups[optgroup]) }}">       {{?}}     {{?}}     <option value="{{= filter.id }}" {{? filter.icon}}data-icon="{{= filter.icon}}"{{?}}>{{= it.translate(filter.label) }}</option>   {{~}}   {{? optgroup !== null }}</optgroup>{{?}} </select>',o.templates.operatorSelect='{{? it.operators.length === 1 }} <span> {{= it.translate("operators", it.operators[0].type) }} </span> {{?}} {{ var optgroup = null; }} <select class="form-control {{? it.operators.length === 1 }}hide{{?}}" name="{{= it.rule.id }}_operator">   {{~ it.operators: operator }}     {{? optgroup !== operator.optgroup }}       {{? optgroup !== null }}</optgroup>{{?}}       {{? (optgroup = operator.optgroup) !== null }}         <optgroup label="{{= it.translate(it.settings.optgroups[optgroup]) }}">       {{?}}     {{?}}     <option value="{{= operator.type }}" {{? operator.icon}}data-icon="{{= operator.icon}}"{{?}}>{{= it.translate("operators", operator.type) }}</option>   {{~}}   {{? optgroup !== null }}</optgroup>{{?}} </select>',o.templates.ruleValueSelect='{{ var optgroup = null; }} <select class="form-control" name="{{= it.name }}" {{? it.rule.filter.multiple }}multiple{{?}}>   {{? it.rule.filter.placeholder }}     <option value="{{= it.rule.filter.placeholder_value }}" disabled selected>{{= it.rule.filter.placeholder }}</option>   {{?}}   {{~ it.rule.filter.values: entry }}     {{? optgroup !== entry.optgroup }}       {{? optgroup !== null }}</optgroup>{{?}}       {{? (optgroup = entry.optgroup) !== null }}         <optgroup label="{{= it.translate(it.settings.optgroups[optgroup]) }}">       {{?}}     {{?}}     <option value="{{= entry.value }}">{{= entry.label }}</option>   {{~}}   {{? optgroup !== null }}</optgroup>{{?}} </select>',o.prototype.getGroupTemplate=function(e,t){var r=this.templates.group({builder:this,group_id:e,level:t,conditions:this.settings.conditions,icons:this.icons,settings:this.settings,translate:this.translate.bind(this)});return this.change("getGroupTemplate",r,t)},o.prototype.getRuleTemplate=function(e){var t=this.templates.rule({builder:this,rule_id:e,icons:this.icons,settings:this.settings,translate:this.translate.bind(this)});return this.change("getRuleTemplate",t)},o.prototype.getRuleFilterSelect=function(e,t){var r=this.templates.filterSelect({builder:this,rule:e,filters:t,icons:this.icons,settings:this.settings,translate:this.translate.bind(this)});return this.change("getRuleFilterSelect",r,e,t)},o.prototype.getRuleOperatorSelect=function(e,t){var r=this.templates.operatorSelect({builder:this,rule:e,operators:t,icons:this.icons,settings:this.settings,translate:this.translate.bind(this)});return this.change("getRuleOperatorSelect",r,e,t)},o.prototype.getRuleValueSelect=function(e,t){var r=this.templates.ruleValueSelect({builder:this,name:e,rule:t,icons:this.icons,settings:this.settings,translate:this.translate.bind(this)});return this.change("getRuleValueSelect",r,e,t)},o.prototype.getRuleInput=function(e,t){var r=e.filter,n=e.filter.validation||{},i=e.id+"_value_"+t,o=r.vertical?" class=block":"",s="";if("function"==typeof r.input)s=r.input.call(this,e,i);else switch(r.input){case"radio":case"checkbox":a.iterateOptions(r.values,function(e,t){s+="<label"+o+'><input type="'+r.input+'" name="'+i+'" value="'+e+'"> '+t+"</label> "});break;case"select":s=this.getRuleValueSelect(i,e);break;case"textarea":s+='<textarea class="form-control" name="'+i+'"',r.size&&(s+=' cols="'+r.size+'"'),r.rows&&(s+=' rows="'+r.rows+'"'),void 0!==n.min&&(s+=' minlength="'+n.min+'"'),void 0!==n.max&&(s+=' maxlength="'+n.max+'"'),r.placeholder&&(s+=' placeholder="'+r.placeholder+'"'),s+="></textarea>";break;case"number":s+='<input class="form-control" type="number" name="'+i+'"',void 0!==n.step&&(s+=' step="'+n.step+'"'),void 0!==n.min&&(s+=' min="'+n.min+'"'),void 0!==n.max&&(s+=' max="'+n.max+'"'),r.placeholder&&(s+=' placeholder="'+r.placeholder+'"'),r.size&&(s+=' size="'+r.size+'"'),s+=">";break;default:s+='<input class="form-control" type="text" name="'+i+'"',r.placeholder&&(s+=' placeholder="'+r.placeholder+'"'),"string"===r.type&&void 0!==n.min&&(s+=' minlength="'+n.min+'"'),"string"===r.type&&void 0!==n.max&&(s+=' maxlength="'+n.max+'"'),r.size&&(s+=' size="'+r.size+'"'),s+=">"}return this.change("getRuleInput",s,e,i)};var a={};o.utils=a,a.iterateOptions=function(t,r){t&&(e.isArray(t)?t.forEach(function(t){e.isPlainObject(t)?"value"in t?r(t.value,t.label||t.value,t.optgroup):e.each(t,function(e,t){return r(e,t),!1}):r(t,t)}):e.each(t,function(e,t){r(e,t)}))},a.fmt=function(e,t){return Array.isArray(t)||(t=Array.prototype.slice.call(arguments,1)),e.replace(/{([0-9]+)}/g,function(e,r){return t[parseInt(r)]})},a.error=function(){var e=0,t="boolean"!=typeof arguments[e]||arguments[e++],r=arguments[e++],n=arguments[e++],i=Array.isArray(arguments[e])?arguments[e]:Array.prototype.slice.call(arguments,e);if(t){var o=new Error(a.fmt(n,i));throw o.name=r+"Error",o.args=i,o}console.error(r+"Error: "+a.fmt(n,i))},a.changeType=function(e,t){if(""!==e&&void 0!==e)switch(t){case"integer":return"string"!=typeof e||/^-?\d+$/.test(e)?parseInt(e):e;case"double":return"string"!=typeof e||/^-?\d+\.?\d*$/.test(e)?parseFloat(e):e;case"boolean":return"string"!=typeof e||/^(0|1|true|false){1}$/i.test(e)?!0===e||1===e||"true"===e.toLowerCase()||"1"===e:e;default:return e}},a.escapeString=function(e){return"string"!=typeof e?e:e.replace(/[\0\n\r\b\\\'\"]/g,function(e){switch(e){case"\0":return"\\0";case"\n":return"\\n";case"\r":return"\\r";case"\b":return"\\b";default:return"\\"+e}}).replace(/\t/g,"\\t").replace(/\x1a/g,"\\Z")},a.escapeRegExp=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},a.escapeElementId=function(e){return e?e.replace(/(\\)?([:.\[\],])/g,function(e,t,r){return t?e:"\\"+r}):e},a.groupSort=function(e,t){var r=[],n=[];return e.forEach(function(e){var i;e[t]?(i=r.lastIndexOf(e[t]),-1==i?i=r.length:i++):i=r.length,r.splice(i,0,e[t]),n.splice(i,0,e)}),n},a.defineModelProperties=function(t,r){r.forEach(function(r){Object.defineProperty(t.prototype,r,{enumerable:!0,get:function(){return this.__[r]},set:function(t){var n=null!==this.__[r]&&"object"==typeof this.__[r]?e.extend({},this.__[r]):this.__[r];this.__[r]=t,null!==this.model&&this.model.trigger("update",this,r,t,n)}})})},e.extend(r.prototype,{trigger:function(t){var r=new e.Event(t);return this.$.triggerHandler(r,Array.prototype.slice.call(arguments,1)),r},on:function(){return this.$.on.apply(this.$,Array.prototype.slice.call(arguments)),this},off:function(){return this.$.off.apply(this.$,Array.prototype.slice.call(arguments)),this},once:function(){return this.$.one.apply(this.$,Array.prototype.slice.call(arguments)),this}});var s=function(e,t){if(!(this instanceof s))return new s(e,t);Object.defineProperty(this,"__",{value:{}}),t.data("queryBuilderModel",this),this.__.level=1,this.__.error=null,this.__.flags={},this.__.data=void 0,this.$el=t,this.id=t[0].id,this.model=null,this.parent=e};a.defineModelProperties(s,["level","error","data","flags"]),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){return this.__.parent},set:function(e){this.__.parent=e,this.level=null===e?1:e.level+1,this.model=null===e?null:e.model}}),s.prototype.isRoot=function(){return 1===this.level},s.prototype.getPos=function(){return this.isRoot()?-1:this.parent.getNodePos(this)},s.prototype.drop=function(){var e=this.model;this.parent&&this.parent.removeNode(this),this.$el.removeData("queryBuilderModel"),null!==e&&e.trigger("drop",this)},s.prototype.moveAfter=function(e){this.isRoot()||this.move(e.parent,e.getPos()+1)},s.prototype.moveAtBegin=function(e){this.isRoot()||(void 0===e&&(e=this.parent),this.move(e,0))},s.prototype.moveAtEnd=function(e){this.isRoot()||(void 0===e&&(e=this.parent),this.move(e,0===e.length()?0:e.length()-1))},s.prototype.move=function(e,t){this.isRoot()||("number"==typeof e&&(t=e,e=this.parent),this.parent.removeNode(this),e.insertNode(this,t,!1),null!==this.model&&this.model.trigger("move",this,e,t))};var l=function(e,t){if(!(this instanceof l))return new l(e,t);s.call(this,e,t),this.rules=[],this.__.condition=null};l.prototype=Object.create(s.prototype),l.prototype.constructor=l,a.defineModelProperties(l,["condition"]),l.prototype.empty=function(){this.each("reverse",function(e){e.drop()},function(e){e.drop()})},l.prototype.drop=function(){this.empty(),s.prototype.drop.call(this)},l.prototype.length=function(){return this.rules.length},l.prototype.insertNode=function(e,t,r){return void 0===t&&(t=this.length()),this.rules.splice(t,0,e),e.parent=this,r&&null!==this.model&&this.model.trigger("add",this,e,t),e},l.prototype.addGroup=function(e,t){return this.insertNode(new l(this,e),t,!0)},l.prototype.addRule=function(e,t){return this.insertNode(new u(this,e),t,!0)},l.prototype.removeNode=function(e){var t=this.getNodePos(e);-1!==t&&(e.parent=null,this.rules.splice(t,1))},l.prototype.getNodePos=function(e){return this.rules.indexOf(e)},l.prototype.each=function(e,t,r,n){"boolean"!=typeof e&&"string"!=typeof e&&(n=r,r=t,t=e,e=!1),n=void 0===n?null:n;for(var i=e?this.rules.length-1:0,o=e?0:this.rules.length-1,a=e?-1:1,s=!1;function(){return e?i>=o:i<=o}()&&(this.rules[i]instanceof l?r&&(s=!1===r.call(n,this.rules[i])):t&&(s=!1===t.call(n,this.rules[i])),!s);i+=a);return!s},l.prototype.contains=function(e,t){return-1!==this.getNodePos(e)||!!t&&!this.each(function(){return!0},function(t){return!t.contains(e,!0)})};var u=function(e,t){if(!(this instanceof u))return new u(e,t);s.call(this,e,t),this._updating_value=!1,this._updating_input=!1,this.__.filter=null,this.__.operator=null,this.__.value=void 0};return u.prototype=Object.create(s.prototype),u.prototype.constructor=u,a.defineModelProperties(u,["filter","operator","value"]),u.prototype.isRoot=function(){return!1},o.Group=l,o.Rule=u,e.fn.queryBuilder=function(e){0===this.length&&a.error("Config","No target defined"),this.length>1&&a.error("Config","Unable to initialize on multiple target");var t=this.data("queryBuilder"),r="object"==typeof e&&e||{};if(!t&&"destroy"==e)return this;if(!t){var n=new o(this,r);this.data("queryBuilder",n),n.init(r.rules)}return"string"==typeof e?t[e].apply(t,Array.prototype.slice.call(arguments,1)):this},e.fn.queryBuilder.constructor=o,e.fn.queryBuilder.defaults=o.defaults,e.fn.queryBuilder.extend=o.extend,e.fn.queryBuilder.define=o.define,e.fn.queryBuilder.regional=o.regional,o.define("bt-checkbox",function(e){"glyphicons"==e.font&&this.$el.addClass("bt-checkbox-glyphicons"),this.on("getRuleInput.filter",function(t,r,n){var i=r.filter;if(("radio"===i.input||"checkbox"===i.input)&&!i.plugin){t.value="",i.colors||(i.colors={}),i.color&&(i.colors._def_=i.color);var o=i.vertical?' style="display:block"':"",s=0;a.iterateOptions(i.values,function(r,a){var l=i.colors[r]||i.colors._def_||e.color,u=n+"_"+s++;t.value+="<div"+o+' class="'+i.input+" "+i.input+"-"+l+'">   <input type="'+i.input+'" name="'+n+'" id="'+u+'" value="'+r+'">   <label for="'+u+'">'+a+"</label> </div>"})}})},{font:"glyphicons",color:"default"}),o.define("bt-selectpicker",function(t){e.fn.selectpicker&&e.fn.selectpicker.Constructor||a.error("MissingLibrary",'Bootstrap Select is required to use "bt-selectpicker" plugin. Get it here: http://silviomoreto.github.io/bootstrap-select');var r=o.selectors;this.on("afterCreateRuleFilters",function(e,n){n.$el.find(r.rule_filter).removeClass("form-control").selectpicker(t)}),this.on("afterCreateRuleOperators",function(e,n){n.$el.find(r.rule_operator).removeClass("form-control").selectpicker(t)}),this.on("afterUpdateRuleFilter",function(e,t){t.$el.find(r.rule_filter).selectpicker("render")}),this.on("afterUpdateRuleOperator",function(e,t){t.$el.find(r.rule_operator).selectpicker("render")}),this.on("beforeDeleteRule",function(e,t){t.$el.find(r.rule_filter).selectpicker("destroy"),t.$el.find(r.rule_operator).selectpicker("destroy")})},{container:"body",style:"btn-inverse btn-xs",width:"auto",showIcon:!1}),o.define("bt-tooltip-errors",function(t){e.fn.tooltip&&e.fn.tooltip.Constructor&&e.fn.tooltip.Constructor.prototype.fixTitle||a.error("MissingLibrary",'Bootstrap Tooltip is required to use "bt-tooltip-errors" plugin. Get it here: http://getbootstrap.com');var r=this;this.on("getRuleTemplate.filter getGroupTemplate.filter",function(t){var r=e(t.value);r.find(o.selectors.error_container).attr("data-toggle","tooltip"),t.value=r.prop("outerHTML")}),this.model.on("update",function(e,n,i){"error"==i&&r.settings.display_errors&&n.$el.find(o.selectors.error_container).eq(0).tooltip(t).tooltip("hide").tooltip("fixTitle")})},{placement:"right"}),o.extend({setFilters:function(e,t){var r=this;void 0===t&&(t=e,e=!1),t=this.checkFilters(t),t=this.change("setFilters",t);var n=t.map(function(e){return e.id});if(e||function e(t){t.each(function(e){e.filter&&-1===n.indexOf(e.filter.id)&&a.error("ChangeFilter",'A rule is using filter "{0}"',e.filter.id)},e)}(this.model.root),this.filters=t,function e(t){t.each(!0,function(e){e.filter&&-1===n.indexOf(e.filter.id)?(e.drop(),r.trigger("rulesChanged")):(r.createRuleFilters(e),e.$el.find(o.selectors.rule_filter).val(e.filter?e.filter.id:"-1"),r.trigger("afterUpdateRuleFilter",e))},e)}(this.model.root),this.settings.plugins&&(this.settings.plugins["unique-filter"]&&this.updateDisabledFilters(),this.settings.plugins["bt-selectpicker"]&&this.$el.find(o.selectors.rule_filter).selectpicker("render")),this.settings.default_filter)try{this.getFilterById(this.settings.default_filter)}catch(e){this.settings.default_filter=null}this.trigger("afterSetFilters",t)},addFilter:function(t,r){void 0===r||"#end"==r?r=this.filters.length:"#start"==r&&(r=0),e.isArray(t)||(t=[t]);var n=e.extend(!0,[],this.filters);parseInt(r)==r?Array.prototype.splice.apply(n,[r,0].concat(t)):this.filters.some(function(e,t){if(e.id==r)return r=t+1,!0})?Array.prototype.splice.apply(n,[r,0].concat(t)):Array.prototype.push.apply(n,t),this.setFilters(n)},removeFilter:function(t,r){var n=e.extend(!0,[],this.filters);"string"==typeof t&&(t=[t]),n=n.filter(function(e){return-1===t.indexOf(e.id)}),this.setFilters(r,n)}}),o.define("chosen-selectpicker",function(t){e.fn.chosen||a.error("MissingLibrary",'chosen is required to use "chosen-selectpicker" plugin. Get it here: https://github.com/harvesthq/chosen'),this.settings.plugins["bt-selectpicker"]&&a.error("Conflict","bt-selectpicker is already selected as the dropdown plugin. Please remove chosen-selectpicker from the plugin list");var r=o.selectors;this.on("afterCreateRuleFilters",function(e,n){n.$el.find(r.rule_filter).removeClass("form-control").chosen(t)}),this.on("afterCreateRuleOperators",function(e,n){n.$el.find(r.rule_operator).removeClass("form-control").chosen(t)}),this.on("afterUpdateRuleFilter",function(e,t){t.$el.find(r.rule_filter).trigger("chosen:updated")}),this.on("afterUpdateRuleOperator",function(e,t){t.$el.find(r.rule_operator).trigger("chosen:updated")}),this.on("beforeDeleteRule",function(e,t){t.$el.find(r.rule_filter).chosen("destroy"),t.$el.find(r.rule_operator).chosen("destroy")})}),o.define("filter-description",function(t){"inline"===t.mode?this.on("afterUpdateRuleFilter afterUpdateRuleOperator",function(r,n){var i=n.$el.find("p.filter-description"),o=r.builder.getFilterDescription(n.filter,n);o?(0===i.length?(i=e('<p class="filter-description"></p>'),i.appendTo(n.$el)):i.css("display",""),i.html('<i class="'+t.icon+'"></i> '+o)):i.hide()}):"popover"===t.mode?(e.fn.popover&&e.fn.popover.Constructor&&e.fn.popover.Constructor.prototype.fixTitle||a.error("MissingLibrary",'Bootstrap Popover is required to use "filter-description" plugin. Get it here: http://getbootstrap.com'),this.on("afterUpdateRuleFilter afterUpdateRuleOperator",function(r,n){var i=n.$el.find("button.filter-description"),a=r.builder.getFilterDescription(n.filter,n);a?(0===i.length?(i=e('<button type="button" class="btn btn-xs btn-info filter-description" data-toggle="popover"><i class="'+t.icon+'"></i></button>'),i.prependTo(n.$el.find(o.selectors.rule_actions)),i.popover({placement:"left",container:"body",html:!0}),i.on("mouseout",function(){i.popover("hide")})):i.css("display",""),i.data("bs.popover").options.content=a,i.attr("aria-describedby")&&i.popover("show")):(i.hide(),i.data("bs.popover")&&i.popover("hide"))})):"bootbox"===t.mode&&("bootbox"in window||a.error("MissingLibrary",'Bootbox is required to use "filter-description" plugin. Get it here: http://bootboxjs.com'),this.on("afterUpdateRuleFilter afterUpdateRuleOperator",function(r,n){var i=n.$el.find("button.filter-description"),a=r.builder.getFilterDescription(n.filter,n);a?(0===i.length?(i=e('<button type="button" class="btn btn-xs btn-info filter-description" data-toggle="bootbox"><i class="'+t.icon+'"></i></button>'),i.prependTo(n.$el.find(o.selectors.rule_actions)),i.on("click",function(){bootbox.alert(i.data("description"))})):i.css("display",""),i.data("description",a)):i.hide()}))},{icon:"glyphicon glyphicon-info-sign",mode:"popover"}),o.extend({getFilterDescription:function(e,t){return e?"function"==typeof e.description?e.description.call(this,t):e.description:void 0}}),o.define("invert",function(t){var r=this,n=o.selectors;this.on("afterInit",function(){r.$el.on("click.queryBuilder","[data-invert=group]",function(){var i=e(this).closest(n.group_container);r.invert(r.getModel(i),t)}),t.display_rules_button&&t.invert_rules&&r.$el.on("click.queryBuilder","[data-invert=rule]",function(){var i=e(this).closest(n.rule_container);r.invert(r.getModel(i),t)})}),t.disable_template||(this.on("getGroupTemplate.filter",function(i){var o=e(i.value);o.find(n.condition_container).after('<button type="button" class="btn btn-xs btn-default" data-invert="group"><i class="'+t.icon+'"></i> '+r.translate("invert")+"</button>"),i.value=o.prop("outerHTML")}),t.display_rules_button&&t.invert_rules&&this.on("getRuleTemplate.filter",function(i){var o=e(i.value);o.find(n.rule_actions).prepend('<button type="button" class="btn btn-xs btn-default" data-invert="rule"><i class="'+t.icon+'"></i> '+r.translate("invert")+"</button>"),i.value=o.prop("outerHTML")}))},{icon:"glyphicon glyphicon-random",recursive:!0,invert_rules:!0,display_rules_button:!1,silent_fail:!1,disable_template:!1}),o.defaults({operatorOpposites:{equal:"not_equal",not_equal:"equal",in:"not_in",not_in:"in",less:"greater_or_equal",less_or_equal:"greater",greater:"less_or_equal",greater_or_equal:"less",between:"not_between",not_between:"between",begins_with:"not_begins_with",not_begins_with:"begins_with",contains:"not_contains",not_contains:"contains",ends_with:"not_ends_with",not_ends_with:"ends_with",is_empty:"is_not_empty",is_not_empty:"is_empty",is_null:"is_not_null",is_not_null:"is_null"},conditionOpposites:{AND:"OR",OR:"AND"}}),o.extend({invert:function(t,r){if(!(t instanceof s)){if(!this.model.root)return;r=t,t=this.model.root}if("object"!=typeof r&&(r={}),void 0===r.recursive&&(r.recursive=!0),void 0===r.invert_rules&&(r.invert_rules=!0),void 0===r.silent_fail&&(r.silent_fail=!1),void 0===r.trigger&&(r.trigger=!0),t instanceof l){if(this.settings.conditionOpposites[t.condition]?t.condition=this.settings.conditionOpposites[t.condition]:r.silent_fail||a.error("InvertCondition",'Unknown inverse of condition "{0}"',t.condition),r.recursive){var n=e.extend({},r,{trigger:!1});t.each(function(e){r.invert_rules&&this.invert(e,n)},function(e){this.invert(e,n)},this)}}else if(t instanceof u&&t.operator&&!t.filter.no_invert)if(this.settings.operatorOpposites[t.operator.type]){var i=this.settings.operatorOpposites[t.operator.type];t.filter.operators&&-1==t.filter.operators.indexOf(i)||(t.operator=this.getOperatorByType(i))}else r.silent_fail||a.error("InvertOperator",'Unknown inverse of operator "{0}"',t.operator.type);r.trigger&&(this.trigger("afterInvert",t,r),this.trigger("rulesChanged"))}}),o.defaults({mongoOperators:{equal:function(e){return e[0]},not_equal:function(e){return{$ne:e[0]}},in:function(e){return{$in:e}},not_in:function(e){return{$nin:e}},less:function(e){return{$lt:e[0]}},less_or_equal:function(e){return{$lte:e[0]}},greater:function(e){return{$gt:e[0]}},greater_or_equal:function(e){return{$gte:e[0]}},between:function(e){return{$gte:e[0],$lte:e[1]}},not_between:function(e){return{$lt:e[0],$gt:e[1]}},begins_with:function(e){return{$regex:"^"+a.escapeRegExp(e[0])}},not_begins_with:function(e){return{$regex:"^(?!"+a.escapeRegExp(e[0])+")"}},contains:function(e){return{$regex:a.escapeRegExp(e[0])}},not_contains:function(e){return{$regex:"^((?!"+a.escapeRegExp(e[0])+").)*$",$options:"s"}},ends_with:function(e){return{$regex:a.escapeRegExp(e[0])+"$"}},not_ends_with:function(e){return{$regex:"(?<!"+a.escapeRegExp(e[0])+")$"}},is_empty:function(e){return""},is_not_empty:function(e){return{$ne:""}},is_null:function(e){return null},is_not_null:function(e){return{$ne:null}}},mongoRuleOperators:{$eq:function(e){return{val:e,op:null===e?"is_null":""===e?"is_empty":"equal"}},$ne:function(e){return e=e.$ne,{val:e,op:null===e?"is_not_null":""===e?"is_not_empty":"not_equal"}},$regex:function(e){return e=e.$regex,"^(?!"==e.slice(0,4)&&")"==e.slice(-1)?{val:e.slice(4,-1),op:"not_begins_with"}:"^((?!"==e.slice(0,5)&&").)*$"==e.slice(-5)?{val:e.slice(5,-5),op:"not_contains"}:"(?<!"==e.slice(0,4)&&")$"==e.slice(-2)?{val:e.slice(4,-2),op:"not_ends_with"}:"$"==e.slice(-1)?{val:e.slice(0,-1),op:"ends_with"}:"^"==e.slice(0,1)?{val:e.slice(1),op:"begins_with"}:{val:e,op:"contains"}},between:function(e){return{val:[e.$gte,e.$lte],op:"between"}},not_between:function(e){return{val:[e.$lt,e.$gt],op:"not_between"}},$in:function(e){return{val:e.$in,op:"in"}},$nin:function(e){return{val:e.$nin,op:"not_in"}},$lt:function(e){return{val:e.$lt,op:"less"}},$lte:function(e){return{val:e.$lte,op:"less_or_equal"}},$gt:function(e){return{val:e.$gt,op:"greater"}},$gte:function(e){return{val:e.$gte,op:"greater_or_equal"}}}}),o.extend({getMongo:function(e){if(!(e=void 0===e?this.getRules():e))return null;var t=this;return function e(r){if(r.condition||(r.condition=t.settings.default_condition),-1===["AND","OR"].indexOf(r.condition.toUpperCase())&&a.error("UndefinedMongoCondition",'Unable to build MongoDB query with condition "{0}"',r.condition),!r.rules)return{};var n=[];r.rules.forEach(function(r){if(r.rules&&r.rules.length>0)n.push(e(r));else{var i=t.settings.mongoOperators[r.operator],o=t.getOperatorByType(r.operator);void 0===i&&a.error("UndefinedMongoOperator",'Unknown MongoDB operation for operator "{0}"',r.operator),0!==o.nb_inputs&&(r.value instanceof Array||(r.value=[r.value]));var s=t.change("getMongoDBField",r.field,r),l={};l[s]=i.call(t,r.value),n.push(t.change("ruleToMongo",l,r,r.value,i))}});var i={};return i["$"+r.condition.toLowerCase()]=n,t.change("groupToMongo",i,r)}(e)},getRulesFromMongo:function(e){if(void 0===e||null===e)return null;var t=this;if("rules"in(e=t.change("parseMongoNode",e))&&"condition"in e)return e;if("id"in e&&"operator"in e&&"value"in e)return{condition:this.settings.default_condition,rules:[e]};var r=t.getMongoCondition(e);return r||a.error("MongoParse","Invalid MongoDB query format"),function e(r,n){var i=r[n],o=[];return i.forEach(function(r){if("rules"in(r=t.change("parseMongoNode",r))&&"condition"in r)return void o.push(r);if("id"in r&&"operator"in r&&"value"in r)return void o.push(r);var n=t.getMongoCondition(r);if(n)o.push(e(r,n));else{var i=Object.keys(r)[0],s=r[i],l=t.getMongoOperator(s);void 0===l&&a.error("MongoParse","Invalid MongoDB query format");var u=t.settings.mongoRuleOperators[l];void 0===u&&a.error("UndefinedMongoOperator",'JSON Rule operation unknown for operator "{0}"',l);var p=u.call(t,s),c=t.getMongoDBFieldID(i,s),d=t.change("mongoToRule",{id:c,field:i,operator:p.op,value:p.val},r);o.push(d)}}),t.change("mongoToGroup",{condition:n.replace("$","").toUpperCase(),rules:o},r)}(e,r)},setRulesFromMongo:function(e){this.setRules(this.getRulesFromMongo(e))},getMongoDBFieldID:function(e,t){var r=this.filters.filter(function(t){return t.field===e});return 1===r.length?r[0].id:this.change("getMongoDBFieldID",e,t)},getMongoOperator:function(e){if(null===e||"object"!=typeof e)return"$eq";if(void 0!==e.$gte&&void 0!==e.$lte)return"between";if(void 0!==e.$lt&&void 0!==e.$gt)return"not_between";var t=Object.keys(e).filter(function(e){return!!this.settings.mongoRuleOperators[e]}.bind(this));return 1===t.length?t[0]:void 0},getMongoCondition:function(e){for(var t=Object.keys(e),r=0,n=t.length;r<n;r++)if("$or"===t[r].toLowerCase()||"$and"===t[r].toLowerCase())return t[r]}}),o.define("not-group",function(t){var r=this;this.on("afterInit",function(){r.$el.on("click.queryBuilder","[data-not=group]",function(){var t=e(this).closest(o.selectors.group_container),n=r.getModel(t);n.not=!n.not}),r.model.on("update",function(e,t,n){t instanceof l&&"not"===n&&r.updateGroupNot(t)})}),this.on("afterAddGroup",function(e,t){t.__.not=!1}),t.disable_template||this.on("getGroupTemplate.filter",function(n){var i=e(n.value);i.find(o.selectors.condition_container).prepend('<button type="button" class="btn btn-xs btn-default" data-not="group"><i class="'+t.icon_unchecked+'"></i> '+r.translate("NOT")+"</button>"),n.value=i.prop("outerHTML")}),this.on("groupToJson.filter",function(e,t){e.value.not=t.not}),this.on("jsonToGroup.filter",function(e,t){e.value.not=!!t.not}),this.on("groupToSQL.filter",function(e,t){t.not&&(e.value="NOT ( "+e.value+" )")}),this.on("parseSQLNode.filter",function(e){e.value.name&&"NOT"==e.value.name.toUpperCase()&&(e.value=e.value.arguments.value[0],-1===["AND","OR"].indexOf(e.value.operation.toUpperCase())&&(e.value=new SQLParser.nodes.Op(r.settings.default_condition,e.value,null)),e.value.not=!0)}),this.on("sqlGroupsDistinct.filter",function(e,t,r,n){r.not&&n>0&&(e.value=!0)}),this.on("sqlToGroup.filter",function(e,t){e.value.not=!!t.not}),this.on("groupToMongo.filter",function(e,t){var r="$"+t.condition.toLowerCase();t.not&&e.value[r]&&(e.value={$nor:[e.value]})}),this.on("parseMongoNode.filter",function(e){var t=Object.keys(e.value);"$nor"==t[0]&&(e.value=e.value[t[0]][0],e.value.not=!0)}),this.on("mongoToGroup.filter",function(e,t){e.value.not=!!t.not})},{icon_unchecked:"glyphicon glyphicon-unchecked",icon_checked:"glyphicon glyphicon-check",disable_template:!1}),a.defineModelProperties(l,["not"]),o.selectors.group_not=o.selectors.group_header+" [data-not=group]",o.extend({updateGroupNot:function(e){var t=this.plugins["not-group"];e.$el.find(">"+o.selectors.group_not).toggleClass("active",e.not).find("i").attr("class",e.not?t.icon_checked:t.icon_unchecked),this.trigger("afterUpdateGroupNot",e),this.trigger("rulesChanged")}}),o.define("sortable",function(t){"interact"in window||a.error("MissingLibrary",'interact.js is required to use "sortable" plugin. Get it here: http://interactjs.io'),void 0!==t.default_no_sortable&&(a.error(!1,"Config",'Sortable plugin : "default_no_sortable" options is deprecated, use standard "default_rule_flags" and "default_group_flags" instead'),this.settings.default_rule_flags.no_sortable=this.settings.default_group_flags.no_sortable=t.default_no_sortable),interact.dynamicDrop(!0),interact.pointerMoveTolerance(10);var r,i,s,u;this.on("afterAddRule afterAddGroup",function(a,p){if(p!=r){var c=a.builder;t.inherit_no_sortable&&p.parent&&p.parent.flags.no_sortable&&(p.flags.no_sortable=!0),t.inherit_no_drop&&p.parent&&p.parent.flags.no_drop&&(p.flags.no_drop=!0),p.flags.no_sortable||interact(p.$el[0]).draggable({allowFrom:o.selectors.drag_handle,onstart:function(t){u=!1,s=c.getModel(t.target),i=s.$el.clone().appendTo(s.$el.parent()).width(s.$el.outerWidth()).addClass("dragging");var n=e('<div class="rule-placeholder">&nbsp;</div>').height(s.$el.outerHeight());r=s.parent.addRule(n,s.getPos()),s.$el.hide()},onmove:function(e){i[0].style.top=e.clientY-15+"px",i[0].style.left=e.clientX-15+"px"},onend:function(t){t.dropzone&&(n(s,e(t.relatedTarget),c),u=!0),i.remove(),i=void 0,r.drop(),r=void 0,s.$el.css("display",""),c.trigger("afterMove",s),c.trigger("rulesChanged")}}),p.flags.no_drop||(interact(p.$el[0]).dropzone({accept:o.selectors.rule_and_group_containers,ondragenter:function(t){n(r,e(t.target),c)},ondrop:function(t){u||n(s,e(t.target),c)}}),p instanceof l&&interact(p.$el.find(o.selectors.group_header)[0]).dropzone({accept:o.selectors.rule_and_group_containers,ondragenter:function(t){n(r,e(t.target),c)},ondrop:function(t){u||n(s,e(t.target),c)}}))}}),this.on("beforeDeleteRule beforeDeleteGroup",function(e,t){e.isDefaultPrevented()||(interact(t.$el[0]).unset(),t instanceof l&&interact(t.$el.find(o.selectors.group_header)[0]).unset())}),this.on("afterApplyRuleFlags afterApplyGroupFlags",function(e,t){t.flags.no_sortable&&t.$el.find(".drag-handle").remove()}),t.disable_template||(this.on("getGroupTemplate.filter",function(r,n){if(n>1){var i=e(r.value);i.find(o.selectors.condition_container).after('<div class="drag-handle"><i class="'+t.icon+'"></i></div>'),r.value=i.prop("outerHTML")}}),this.on("getRuleTemplate.filter",function(r){var n=e(r.value);n.find(o.selectors.rule_header).after('<div class="drag-handle"><i class="'+t.icon+'"></i></div>'),r.value=n.prop("outerHTML")}))},{inherit_no_sortable:!0,inherit_no_drop:!0,icon:"glyphicon glyphicon-sort",disable_template:!1}),o.selectors.rule_and_group_containers=o.selectors.rule_container+", "+o.selectors.group_container,o.selectors.drag_handle=".drag-handle",o.defaults({default_rule_flags:{no_sortable:!1,no_drop:!1},default_group_flags:{no_sortable:!1,no_drop:!1}}),o.define("sql-support",function(e){},{boolean_as_integer:!0}),o.defaults({
sqlOperators:{equal:{op:"= ?"},not_equal:{op:"!= ?"},in:{op:"IN(?)",sep:", "},not_in:{op:"NOT IN(?)",sep:", "},less:{op:"< ?"},less_or_equal:{op:"<= ?"},greater:{op:"> ?"},greater_or_equal:{op:">= ?"},between:{op:"BETWEEN ?",sep:" AND "},not_between:{op:"NOT BETWEEN ?",sep:" AND "},begins_with:{op:"LIKE(?)",mod:"{0}%"},not_begins_with:{op:"NOT LIKE(?)",mod:"{0}%"},contains:{op:"LIKE(?)",mod:"%{0}%"},not_contains:{op:"NOT LIKE(?)",mod:"%{0}%"},ends_with:{op:"LIKE(?)",mod:"%{0}"},not_ends_with:{op:"NOT LIKE(?)",mod:"%{0}"},is_empty:{op:"= ''"},is_not_empty:{op:"!= ''"},is_null:{op:"IS NULL"},is_not_null:{op:"IS NOT NULL"}},sqlRuleOperator:{"=":function(e){return{val:e,op:""===e?"is_empty":"equal"}},"!=":function(e){return{val:e,op:""===e?"is_not_empty":"not_equal"}},LIKE:function(e){return"%"==e.slice(0,1)&&"%"==e.slice(-1)?{val:e.slice(1,-1),op:"contains"}:"%"==e.slice(0,1)?{val:e.slice(1),op:"ends_with"}:"%"==e.slice(-1)?{val:e.slice(0,-1),op:"begins_with"}:void a.error("SQLParse",'Invalid value for LIKE operator "{0}"',e)},"NOT LIKE":function(e){return"%"==e.slice(0,1)&&"%"==e.slice(-1)?{val:e.slice(1,-1),op:"not_contains"}:"%"==e.slice(0,1)?{val:e.slice(1),op:"not_ends_with"}:"%"==e.slice(-1)?{val:e.slice(0,-1),op:"not_begins_with"}:void a.error("SQLParse",'Invalid value for NOT LIKE operator "{0}"',e)},IN:function(e){return{val:e,op:"in"}},"NOT IN":function(e){return{val:e,op:"not_in"}},"<":function(e){return{val:e,op:"less"}},"<=":function(e){return{val:e,op:"less_or_equal"}},">":function(e){return{val:e,op:"greater"}},">=":function(e){return{val:e,op:"greater_or_equal"}},BETWEEN:function(e){return{val:e,op:"between"}},"NOT BETWEEN":function(e){return{val:e,op:"not_between"}},IS:function(e){return null!==e&&a.error("SQLParse","Invalid value for IS operator"),{val:null,op:"is_null"}},"IS NOT":function(e){return null!==e&&a.error("SQLParse","Invalid value for IS operator"),{val:null,op:"is_not_null"}}},sqlStatements:{question_mark:function(){var e=[];return{add:function(t,r){return e.push(r),"?"},run:function(){return e}}},numbered:function(e){(!e||e.length>1)&&(e="$");var t=0,r=[];return{add:function(n,i){return r.push(i),t++,e+t},run:function(){return r}}},named:function(e){(!e||e.length>1)&&(e=":");var t={},r={};return{add:function(n,i){t[n.field]||(t[n.field]=1);var o=n.field+"_"+t[n.field]++;return r[o]=i,e+o},run:function(){return r}}}},sqlRuleStatement:{question_mark:function(e){var t=0;return{parse:function(r){return"?"==r?e[t++]:r},esc:function(e){return e.replace(/\?/g,"'?'")}}},numbered:function(e,t){(!t||t.length>1)&&(t="$");var r=new RegExp("^\\"+t+"[0-9]+$"),n=new RegExp("\\"+t+"([0-9]+)","g");return{parse:function(t){return r.test(t)?e[t.slice(1)-1]:t},esc:function(e){return e.replace(n,"'"+("$"==t?"$$":t)+"$1'")}}},named:function(e,t){(!t||t.length>1)&&(t=":");var r=new RegExp("^\\"+t),n=new RegExp("\\"+t+"("+Object.keys(e).join("|")+")","g");return{parse:function(t){return r.test(t)?e[t.slice(1)]:t},esc:function(e){return e.replace(n,"'"+("$"==t?"$$":t)+"$1'")}}}}}),o.extend({getSQL:function(e,t,r){if(!(r=void 0===r?this.getRules():r))return null;t=t?"\n":" ";var n=this.getPluginOptions("sql-support","boolean_as_integer");if(!0===e&&(e="question_mark"),"string"==typeof e){var o=i(e);e=this.settings.sqlStatements[o[1]](o[2])}var s=this,l=function r(i){if(i.condition||(i.condition=s.settings.default_condition),-1===["AND","OR"].indexOf(i.condition.toUpperCase())&&a.error("UndefinedSQLCondition",'Unable to build SQL query with condition "{0}"',i.condition),!i.rules)return"";var o=[];i.rules.forEach(function(i){if(i.rules&&i.rules.length>0)o.push("("+t+r(i)+t+")"+t);else{var l=s.settings.sqlOperators[i.operator],u=s.getOperatorByType(i.operator),p="";void 0===l&&a.error("UndefinedSQLOperator",'Unknown SQL operation for operator "{0}"',i.operator),0!==u.nb_inputs&&(i.value instanceof Array||(i.value=[i.value]),i.value.forEach(function(t,r){r>0&&(p+=l.sep),"boolean"==i.type&&n?t=t?1:0:e||"integer"===i.type||"double"===i.type||"boolean"===i.type||(t=a.escapeString(t)),l.mod&&(t=a.fmt(l.mod,t)),e?p+=e.add(i,t):("string"==typeof t&&(t="'"+t+"'"),p+=t)}));var c=function(e){return l.op.replace("?",function(){return e})},d=s.change("getSQLField",i.field,i),f=d+" "+c(p);o.push(s.change("ruleToSQL",f,i,p,c))}});var l=o.join(" "+i.condition+t);return s.change("groupToSQL",l,i)}(r);return e?{sql:l,params:e.run()}:{sql:l}},getRulesFromSQL:function(t,r){"SQLParser"in window||a.error("MissingLibrary","SQLParser is required to parse SQL queries. Get it here https://github.com/mistic100/sql-parser");var n=this;if("string"==typeof t&&(t={sql:t}),!0===r&&(r="question_mark"),"string"==typeof r){var o=i(r);r=this.settings.sqlRuleStatement[o[1]](t.params,o[2])}r&&(t.sql=r.esc(t.sql)),0!==t.sql.toUpperCase().indexOf("SELECT")&&(t.sql="SELECT * FROM table WHERE "+t.sql);var s=SQLParser.parse(t.sql);s.where||a.error("SQLParse","No WHERE clause found");var l=n.change("parseSQLNode",s.where.conditions);if("rules"in l&&"condition"in l)return l;if("id"in l&&"operator"in l&&"value"in l)return{condition:this.settings.default_condition,rules:[l]};var u=n.change("sqlToGroup",{condition:this.settings.default_condition,rules:[]},l),p=u;return function t(i,o){if(null!==i){if("rules"in(i=n.change("parseSQLNode",i))&&"condition"in i)return void p.rules.push(i);if("id"in i&&"operator"in i&&"value"in i)return void p.rules.push(i);if("left"in i&&"right"in i&&"operation"in i||a.error("SQLParse","Unable to parse WHERE clause"),-1!==["AND","OR"].indexOf(i.operation.toUpperCase())){if(n.change("sqlGroupsDistinct",o>0&&p.condition!=i.operation.toUpperCase(),p,i,o)){var s=n.change("sqlToGroup",{condition:n.settings.default_condition,rules:[]},i);p.rules.push(s),p=s}p.condition=i.operation.toUpperCase(),o++;var l=p;t(i.left,o),p=l,t(i.right,o)}else{e.isPlainObject(i.right.value)&&a.error("SQLParse","Value format not supported for {0}.",i.left.value);var u;u=e.isArray(i.right.value)?i.right.value.map(function(e){return e.value}):i.right.value,r&&(u=e.isArray(u)?u.map(r.parse):r.parse(u));var c=i.operation.toUpperCase();"<>"==c&&(c="!=");var d=n.settings.sqlRuleOperator[c];void 0===d&&a.error("UndefinedSQLOperator",'Invalid SQL operation "{0}".',i.operation);var f,g=d.call(this,u,i.operation);"values"in i.left?f=i.left.values.join("."):"value"in i.left?f=i.left.value:a.error("SQLParse","Cannot find field name in {0}",JSON.stringify(i.left));var h=n.getSQLFieldID(f,u),v=n.change("sqlToRule",{id:h,field:f,operator:g.op,value:g.val},i);p.rules.push(v)}}}(l,0),u},setRulesFromSQL:function(e,t){this.setRules(this.getRulesFromSQL(e,t))},getSQLFieldID:function(e,t){var r=this.filters.filter(function(t){return t.field.toLowerCase()===e.toLowerCase()});return 1===r.length?r[0].id:this.change("getSQLFieldID",e,t)}}),o.define("unique-filter",function(){this.status.used_filters={},this.on("afterUpdateRuleFilter",this.updateDisabledFilters),this.on("afterDeleteRule",this.updateDisabledFilters),this.on("afterCreateRuleFilters",this.applyDisabledFilters),this.on("afterReset",this.clearDisabledFilters),this.on("afterClear",this.clearDisabledFilters),this.on("getDefaultFilter.filter",function(e,t){var r=e.builder;if(r.updateDisabledFilters(),e.value.id in r.status.used_filters){r.filters.some(function(n){if(!(n.id in r.status.used_filters)||r.status.used_filters[n.id].length>0&&-1===r.status.used_filters[n.id].indexOf(t.parent))return e.value=n,!0})||(a.error(!1,"UniqueFilter","No more non-unique filters available"),e.value=void 0)}})}),o.extend({updateDisabledFilters:function(e){var t=e?e.builder:this;t.status.used_filters={},t.model&&(!function e(r){r.each(function(e){e.filter&&e.filter.unique&&(t.status.used_filters[e.filter.id]||(t.status.used_filters[e.filter.id]=[]),"group"==e.filter.unique&&t.status.used_filters[e.filter.id].push(e.parent))},function(t){e(t)})}(t.model.root),t.applyDisabledFilters(e))},clearDisabledFilters:function(e){var t=e?e.builder:this;t.status.used_filters={},t.applyDisabledFilters(e)},applyDisabledFilters:function(t){var r=t?t.builder:this;r.$el.find(o.selectors.filter_container+" option").prop("disabled",!1),e.each(r.status.used_filters,function(e,t){0===t.length?r.$el.find(o.selectors.filter_container+' option[value="'+e+'"]:not(:selected)').prop("disabled",!0):t.forEach(function(t){t.each(function(t){t.$el.find(o.selectors.filter_container+' option[value="'+e+'"]:not(:selected)').prop("disabled",!0)})})}),r.settings.plugins&&r.settings.plugins["bt-selectpicker"]&&r.$el.find(o.selectors.rule_filter).selectpicker("render")}}),o.regional.en={__locale:"English (en)",__author:'Damien "Mistic" Sorel, http://www.strangeplanet.fr',add_rule:"Add rule",add_group:"Add group",delete_rule:"Delete",delete_group:"Delete",conditions:{AND:"AND",OR:"OR"},operators:{equal:"equal",not_equal:"not equal",in:"in",not_in:"not in",less:"less",less_or_equal:"less or equal",greater:"greater",greater_or_equal:"greater or equal",between:"between",not_between:"not between",begins_with:"begins with",not_begins_with:"doesn't begin with",contains:"contains",not_contains:"doesn't contain",ends_with:"ends with",not_ends_with:"doesn't end with",is_empty:"is empty",is_not_empty:"is not empty",is_null:"is null",is_not_null:"is not null"},errors:{no_filter:"No filter selected",empty_group:"The group is empty",radio_empty:"No value selected",checkbox_empty:"No value selected",select_empty:"No value selected",string_empty:"Empty value",string_exceed_min_length:"Must contain at least {0} characters",string_exceed_max_length:"Must not contain more than {0} characters",string_invalid_format:"Invalid format ({0})",number_nan:"Not a number",number_not_integer:"Not an integer",number_not_double:"Not a real number",number_exceed_min:"Must be greater than {0}",number_exceed_max:"Must be lower than {0}",number_wrong_step:"Must be a multiple of {0}",number_between_invalid:"Invalid values, {0} is greater than {1}",datetime_empty:"Empty value",datetime_invalid:"Invalid date format ({0})",datetime_exceed_min:"Must be after {0}",datetime_exceed_max:"Must be before {0}",datetime_between_invalid:"Invalid values, {0} is greater than {1}",boolean_not_valid:"Not a boolean",operator_not_multiple:'Operator "{1}" cannot accept multiple values'},invert:"Invert",NOT:"NOT"},o.defaults({lang_code:"en"}),o}),function(e,t){"function"==typeof define&&define.amd?define(["jquery","query-builder"],t):t(e.jQuery)}(this,function(e){"use strict";e.fn.queryBuilder.define("bt-selectpicker-values",function(t){e.fn.selectpicker&&e.fn.selectpicker.Constructor||Utils.error("MissingLibrary",'Bootstrap Select is required to use "bt-selectpicker" plugin. Get it here: http://silviomoreto.github.io/bootstrap-select'),this.on("afterCreateRuleInput",function(e,r){r.$el.find(".rule-value-container").find("select").removeClass("form-control").selectpicker(t)}),this.on("afterUpdateRuleValue",function(e,t){t.$el.find(".rule-value-container").find("select").selectpicker("render")})},{container:"body",style:"btn-inverse btn-xs",width:"auto"})}),$._getComputedStyle=function(e,t){return(window.parent?window.parent.getComputedStyle(e,""):window.getComputedStyle(e,""))[t]},$.hasTransition=function(e){var t=$._getComputedStyle(e,Modernizr.prefixed("transitionProperty"));return t&&""!=t&&"none"!=t},$.hasAnimation=function(e){var t=$._getComputedStyle(e,Modernizr.prefixed("animationName"));return t&&""!=t&&"none"!=t},$.prototype.onTransitionEndOnce=function(e){return this.each(function(t,r){$(r).onTransitionEnd(function(){$(r).unbindTransitionEnd(),e()})}),this};var animationListeners="transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd animationend webkitAnimationEnd MSAnimationEnd oanimationend oAnimationEnd";$.prototype.unbindTransitionEnd=function(){return this.each(function(e,t){$(t).unbind(animationListeners)}),this},$.prototype.onTransitionEnd=function(e){return this.each(function(t,r){console.log($.hasTransition(r)),$.hasTransition(r)||$.hasAnimation(r)?(console.log(1),$(r).bind(animationListeners,e)):(console.log(0),e())}),this},function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,r){return void 0===r&&(r="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(r),r}:e(jQuery)}(function(e){"use strict";function t(t){var r=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(t.target).closest("form").ajaxSubmit(r))}function r(t){var r=t.target,n=e(r);if(!n.is("[type=submit],[type=image]")){var i=n.closest("[type=submit]");if(0===i.length)return;r=i[0]}var o=r.form;if(o.clk=r,"image"===r.type)if(void 0!==t.offsetX)o.clk_x=t.offsetX,o.clk_y=t.offsetY;else if("function"==typeof e.fn.offset){var a=n.offset();o.clk_x=t.pageX-a.left,o.clk_y=t.pageY-a.top}else o.clk_x=t.pageX-r.offsetLeft,o.clk_y=t.pageY-r.offsetTop;setTimeout(function(){o.clk=o.clk_x=o.clk_y=null},100)}function n(){if(e.fn.ajaxSubmit.debug){var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}}var i=/\r?\n/g,o={};o.fileapi=void 0!==e('<input type="file">').get(0).files,o.formdata=void 0!==window.FormData;var a=!!e.fn.prop;e.fn.attr2=function(){if(!a)return this.attr.apply(this,arguments);var e=this.prop.apply(this,arguments);return e&&e.jquery||"string"==typeof e?e:this.attr.apply(this,arguments)},e.fn.ajaxSubmit=function(t,r,i,s){function l(r){var n,i,o=e.param(r,t.traditional).split("&"),a=o.length,s=[];for(n=0;n<a;n++)o[n]=o[n].replace(/\+/g," "),i=o[n].split("="),s.push([decodeURIComponent(i[0]),decodeURIComponent(i[1])]);return s}function u(r){function i(e){var t=null;try{e.contentWindow&&(t=e.contentWindow.document)}catch(e){n("cannot get iframe.contentWindow document: "+e)}if(t)return t;try{t=e.contentDocument?e.contentDocument:e.document}catch(r){n("cannot get iframe.contentDocument: "+r),t=e.document}return t}function o(){function t(){try{var e=i(v).readyState;n("state = "+e),e&&"uninitialized"===e.toLowerCase()&&setTimeout(t,50)}catch(e){n("Server abort: ",e," (",e.name,")"),s(q),w&&clearTimeout(w),w=void 0}}var r=f.attr2("target"),o=f.attr2("action"),a=f.attr("enctype")||f.attr("encoding")||"multipart/form-data";$.setAttribute("target",g),p&&!/post/i.test(p)||$.setAttribute("method","POST"),o!==c.url&&$.setAttribute("action",c.url),c.skipEncodingOverride||p&&!/post/i.test(p)||f.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),c.timeout&&(w=setTimeout(function(){x=!0,s(O)},c.timeout));var l=[];try{if(c.extraData)for(var u in c.extraData)c.extraData.hasOwnProperty(u)&&(e.isPlainObject(c.extraData[u])&&c.extraData[u].hasOwnProperty("name")&&c.extraData[u].hasOwnProperty("value")?l.push(e('<input type="hidden" name="'+c.extraData[u].name+'">',k).val(c.extraData[u].value).appendTo($)[0]):l.push(e('<input type="hidden" name="'+u+'">',k).val(c.extraData[u]).appendTo($)[0]));c.iframeTarget||h.appendTo(T),v.attachEvent?v.attachEvent("onload",s):v.addEventListener("load",s,!1),setTimeout(t,15);try{$.submit()}catch(e){document.createElement("form").submit.apply($)}}finally{$.setAttribute("action",o),$.setAttribute("enctype",a),r?$.setAttribute("target",r):f.removeAttr("target"),e(l).remove()}}function s(t){if(!m.aborted&&!M){if((C=i(v))||(n("cannot access response document"),t=q),t===O&&m)return m.abort("timeout"),void R.reject(m,"timeout");if(t===q&&m)return m.abort("server abort"),void R.reject(m,"error","server abort");if(C&&C.location.href!==c.iframeSrc||x){v.detachEvent?v.detachEvent("onload",s):v.removeEventListener("load",s,!1);var r,o="success";try{if(x)throw"timeout";var a="xml"===c.dataType||C.XMLDocument||e.isXMLDoc(C);if(n("isXml="+a),!a&&window.opera&&(null===C.body||!C.body.innerHTML)&&--D)return n("requeing onLoad callback, DOM not available"),void setTimeout(s,250);var l=C.body?C.body:C.documentElement;m.responseText=l?l.innerHTML:null,m.responseXML=C.XMLDocument?C.XMLDocument:C,a&&(c.dataType="xml"),m.getResponseHeader=function(e){return{"content-type":c.dataType}[e.toLowerCase()]},l&&(m.status=Number(l.getAttribute("status"))||m.status,m.statusText=l.getAttribute("statusText")||m.statusText);var u=(c.dataType||"").toLowerCase(),p=/(json|script|text)/.test(u);if(p||c.textarea){var f=C.getElementsByTagName("textarea")[0];if(f)m.responseText=f.value,m.status=Number(f.getAttribute("status"))||m.status,m.statusText=f.getAttribute("statusText")||m.statusText;else if(p){var g=C.getElementsByTagName("pre")[0],_=C.getElementsByTagName("body")[0];g?m.responseText=g.textContent?g.textContent:g.innerText:_&&(m.responseText=_.textContent?_.textContent:_.innerText)}}else"xml"===u&&!m.responseXML&&m.responseText&&(m.responseXML=A(m.responseText));try{F=L(m,u,c)}catch(e){o="parsererror",m.error=r=e||o}}catch(e){n("error caught: ",e),o="error",m.error=r=e||o}m.aborted&&(n("upload aborted"),o=null),m.status&&(o=m.status>=200&&m.status<300||304===m.status?"success":"error"),"success"===o?(c.success&&c.success.call(c.context,F,"success",m),R.resolve(m.responseText,"success",m),d&&e.event.trigger("ajaxSuccess",[m,c])):o&&(void 0===r&&(r=m.statusText),c.error&&c.error.call(c.context,m,o,r),R.reject(m,"error",r),d&&e.event.trigger("ajaxError",[m,c,r])),d&&e.event.trigger("ajaxComplete",[m,c]),d&&!--e.active&&e.event.trigger("ajaxStop"),c.complete&&c.complete.call(c.context,m,o),M=!0,c.timeout&&clearTimeout(w),setTimeout(function(){c.iframeTarget?h.attr("src",c.iframeSrc):h.remove(),m.responseXML=null},100)}}}var l,u,c,d,g,h,v,m,y,b,x,w,$=f[0],R=e.Deferred();if(R.abort=function(e){m.abort(e)},r)for(u=0;u<_.length;u++)l=e(_[u]),a?l.prop("disabled",!1):l.removeAttr("disabled");(c=e.extend(!0,{},e.ajaxSettings,t)).context=c.context||c,g="jqFormIO"+(new Date).getTime();var k=$.ownerDocument,T=f.closest("body");if(c.iframeTarget?(b=(h=e(c.iframeTarget,k)).attr2("name"))?g=b:h.attr2("name",g):(h=e('<iframe name="'+g+'" src="'+c.iframeSrc+'" />',k)).css({position:"absolute",top:"-1000px",left:"-1000px"}),v=h[0],m={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var r="timeout"===t?"timeout":"aborted";n("aborting upload... "+r),this.aborted=1;try{v.contentWindow.document.execCommand&&v.contentWindow.document.execCommand("Stop")}catch(e){}h.attr("src",c.iframeSrc),m.error=r,c.error&&c.error.call(c.context,m,r,t),d&&e.event.trigger("ajaxError",[m,c,r]),c.complete&&c.complete.call(c.context,m,r)}},(d=c.global)&&0==e.active++&&e.event.trigger("ajaxStart"),d&&e.event.trigger("ajaxSend",[m,c]),c.beforeSend&&!1===c.beforeSend.call(c.context,m,c))return c.global&&e.active--,R.reject(),R;if(m.aborted)return R.reject(),R;(y=$.clk)&&(b=y.name)&&!y.disabled&&(c.extraData=c.extraData||{},c.extraData[b]=y.value,"image"===y.type&&(c.extraData[b+".x"]=$.clk_x,c.extraData[b+".y"]=$.clk_y));var O=1,q=2,S=e("meta[name=csrf-token]").attr("content"),E=e("meta[name=csrf-param]").attr("content");E&&S&&(c.extraData=c.extraData||{},c.extraData[E]=S),c.forceSync?o():setTimeout(o,10);var F,C,M,D=50,A=e.parseXML||function(e,t){return window.ActiveXObject?((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!==t.documentElement.nodeName?t:null},j=e.parseJSON||function(e){return window.eval("("+e+")")},L=function(t,r,n){var i=t.getResponseHeader("content-type")||"",o=("xml"===r||!r)&&i.indexOf("xml")>=0,a=o?t.responseXML:t.responseText;return o&&"parsererror"===a.documentElement.nodeName&&e.error&&e.error("parsererror"),n&&n.dataFilter&&(a=n.dataFilter(a,r)),"string"==typeof a&&(("json"===r||!r)&&i.indexOf("json")>=0?a=j(a):("script"===r||!r)&&i.indexOf("javascript")>=0&&e.globalEval(a)),a};return R}if(!this.length)return n("ajaxSubmit: skipping submit process - no element selected"),this;var p,c,d,f=this;"function"==typeof t?t={success:t}:"string"==typeof t||!1===t&&arguments.length>0?(t={url:t,data:r,dataType:i},"function"==typeof s&&(t.success=s)):void 0===t&&(t={}),p=t.method||t.type||this.attr2("method"),(d=(d="string"==typeof(c=t.url||this.attr2("action"))?e.trim(c):"")||window.location.href||"")&&(d=(d.match(/^([^#]+)/)||[])[1]),t=e.extend(!0,{url:d,success:e.ajaxSettings.success,type:p||e.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},t);var g={};if(this.trigger("form-pre-serialize",[this,t,g]),g.veto)return n("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(t.beforeSerialize&&!1===t.beforeSerialize(this,t))return n("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var h=t.traditional;void 0===h&&(h=e.ajaxSettings.traditional);var v,_=[],m=this.formToArray(t.semantic,_,t.filtering);if(t.data){var y=e.isFunction(t.data)?t.data(m):t.data;t.extraData=y,v=e.param(y,h)}if(t.beforeSubmit&&!1===t.beforeSubmit(m,this,t))return n("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[m,this,t,g]),g.veto)return n("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var b=e.param(m,h);v&&(b=b?b+"&"+v:v),"GET"===t.type.toUpperCase()?(t.url+=(t.url.indexOf("?")>=0?"&":"?")+b,t.data=null):t.data=b;var x=[];if(t.resetForm&&x.push(function(){f.resetForm()}),t.clearForm&&x.push(function(){f.clearForm(t.includeHidden)}),!t.dataType&&t.target){var w=t.success||function(){};x.push(function(r,n,i){var o=arguments,a=t.replaceTarget?"replaceWith":"html";e(t.target)[a](r).each(function(){w.apply(this,o)})})}else t.success&&(e.isArray(t.success)?e.merge(x,t.success):x.push(t.success));if(t.success=function(e,r,n){for(var i=t.context||this,o=0,a=x.length;o<a;o++)x[o].apply(i,[e,r,n||f,f])},t.error){var $=t.error;t.error=function(e,r,n){var i=t.context||this;$.apply(i,[e,r,n,f])}}if(t.complete){var R=t.complete;t.complete=function(e,r){var n=t.context||this;R.apply(n,[e,r,f])}}var k=e("input[type=file]:enabled",this).filter(function(){return""!==e(this).val()}).length>0,T="multipart/form-data",O=f.attr("enctype")===T||f.attr("encoding")===T,q=o.fileapi&&o.formdata;n("fileAPI :"+q);var S,E=(k||O)&&!q;!1!==t.iframe&&(t.iframe||E)?t.closeKeepAlive?e.get(t.closeKeepAlive,function(){S=u(m)}):S=u(m):S=(k||O)&&q?function(r){for(var n=new FormData,i=0;i<r.length;i++)n.append(r[i].name,r[i].value);if(t.extraData){var o=l(t.extraData);for(i=0;i<o.length;i++)o[i]&&n.append(o[i][0],o[i][1])}t.data=null;var a=e.extend(!0,{},e.ajaxSettings,t,{contentType:!1,processData:!1,cache:!1,type:p||"POST"});t.uploadProgress&&(a.xhr=function(){var r=e.ajaxSettings.xhr();return r.upload&&r.upload.addEventListener("progress",function(e){var r=0,n=e.loaded||e.position,i=e.total;e.lengthComputable&&(r=Math.ceil(n/i*100)),t.uploadProgress(e,n,i,r)},!1),r}),a.data=null;var s=a.beforeSend;return a.beforeSend=function(e,r){t.formData?r.data=t.formData:r.data=n,s&&s.call(this,e,r)},e.ajax(a)}(m):e.ajax(t),f.removeData("jqxhr").data("jqxhr",S);for(var F=0;F<_.length;F++)_[F]=null;return this.trigger("form-submit-notify",[this,t]),this},e.fn.ajaxForm=function(i,o,a,s){if(("string"==typeof i||!1===i&&arguments.length>0)&&(i={url:i,data:o,dataType:a},"function"==typeof s&&(i.success=s)),i=i||{},i.delegation=i.delegation&&e.isFunction(e.fn.on),!i.delegation&&0===this.length){var l={s:this.selector,c:this.context};return!e.isReady&&l.s?(n("DOM not ready, queuing ajaxForm"),e(function(){e(l.s,l.c).ajaxForm(i)}),this):(n("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return i.delegation?(e(document).off("submit.form-plugin",this.selector,t).off("click.form-plugin",this.selector,r).on("submit.form-plugin",this.selector,i,t).on("click.form-plugin",this.selector,i,r),this):this.ajaxFormUnbind().on("submit.form-plugin",i,t).on("click.form-plugin",i,r)},e.fn.ajaxFormUnbind=function(){return this.off("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(t,r,n){var i=[];if(0===this.length)return i;var a,s=this[0],l=this.attr("id"),u=t||void 0===s.elements?s.getElementsByTagName("*"):s.elements;if(u&&(u=e.makeArray(u)),l&&(t||/(Edge|Trident)\//.test(navigator.userAgent))&&(a=e(':input[form="'+l+'"]').get()).length&&(u=(u||[]).concat(a)),!u||!u.length)return i;e.isFunction(n)&&(u=e.map(u,n));var p,c,d,f,g,h,v;for(p=0,h=u.length;p<h;p++)if(g=u[p],(d=g.name)&&!g.disabled)if(t&&s.clk&&"image"===g.type)s.clk===g&&(i.push({name:d,value:e(g).val(),type:g.type}),i.push({name:d+".x",value:s.clk_x},{name:d+".y",value:s.clk_y}));else if((f=e.fieldValue(g,!0))&&f.constructor===Array)for(r&&r.push(g),c=0,v=f.length;c<v;c++)i.push({name:d,value:f[c]});else if(o.fileapi&&"file"===g.type){r&&r.push(g);var _=g.files;if(_.length)for(c=0;c<_.length;c++)i.push({name:d,value:_[c],type:g.type});else i.push({name:d,value:"",type:g.type})}else null!==f&&void 0!==f&&(r&&r.push(g),i.push({name:d,value:f,type:g.type,required:g.required}));if(!t&&s.clk){var m=e(s.clk),y=m[0];(d=y.name)&&!y.disabled&&"image"===y.type&&(i.push({name:d,value:m.val()}),i.push({name:d+".x",value:s.clk_x},{name:d+".y",value:s.clk_y}))}return i},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var r=[];return this.each(function(){var n=this.name;if(n){var i=e.fieldValue(this,t);if(i&&i.constructor===Array)for(var o=0,a=i.length;o<a;o++)r.push({name:n,value:i[o]});else null!==i&&void 0!==i&&r.push({name:this.name,value:i})}}),e.param(r)},e.fn.fieldValue=function(t){for(var r=[],n=0,i=this.length;n<i;n++){var o=this[n],a=e.fieldValue(o,t);null===a||void 0===a||a.constructor===Array&&!a.length||(a.constructor===Array?e.merge(r,a):r.push(a))}return r},e.fieldValue=function(t,r){var n=t.name,o=t.type,a=t.tagName.toLowerCase();if(void 0===r&&(r=!0),r&&(!n||t.disabled||"reset"===o||"button"===o||("checkbox"===o||"radio"===o)&&!t.checked||("submit"===o||"image"===o)&&t.form&&t.form.clk!==t||"select"===a&&-1===t.selectedIndex))return null;if("select"===a){var s=t.selectedIndex;if(s<0)return null;for(var l=[],u=t.options,p="select-one"===o,c=p?s+1:u.length,d=p?s:0;d<c;d++){var f=u[d];if(f.selected&&!f.disabled){var g=f.value;if(g||(g=f.attributes&&f.attributes.value&&!f.attributes.value.specified?f.text:f.value),p)return g;l.push(g)}}return l}return e(t).val().replace(i,"\r\n")},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var r=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var n=this.type,i=this.tagName.toLowerCase();r.test(n)||"textarea"===i?this.value="":"checkbox"===n||"radio"===n?this.checked=!1:"select"===i?this.selectedIndex=-1:"file"===n?/MSIE/.test(navigator.userAgent)?e(this).replaceWith(e(this).clone(!0)):e(this).val(""):t&&(!0===t&&/hidden/.test(n)||"string"==typeof t&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){var t=e(this),r=this.tagName.toLowerCase();switch(r){case"input":this.checked=this.defaultChecked;case"textarea":return this.value=this.defaultValue,!0;case"option":case"optgroup":var n=t.parents("select");return n.length&&n[0].multiple?"option"===r?this.selected=this.defaultSelected:t.find("option").resetForm():n.resetForm(),!0;case"select":return t.find("option").each(function(e){if(this.selected=this.defaultSelected,this.defaultSelected&&!t[0].multiple)return t[0].selectedIndex=e,!1}),!0;case"label":var i=e(t.attr("for")),o=t.find("input,select,textarea");return i[0]&&o.unshift(i[0]),o.resetForm(),!0;case"form":return("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset(),!0;default:return t.find("form,input,label,select,textarea").resetForm(),!0}})},e.fn.enable=function(e){return void 0===e&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return void 0===t&&(t=!0),this.each(function(){var r=this.type;if("checkbox"===r||"radio"===r)this.checked=t;else if("option"===this.tagName.toLowerCase()){var n=e(this).parent("select");t&&n[0]&&"select-one"===n[0].type&&n.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1});
